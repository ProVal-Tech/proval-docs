"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[52417],{756302:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"powershell/ps-install-automateagentgpo","title":"Install-AutomateAgentGPO","description":"Documentation for the Install-AutomateAgentGPO command to create a ConnectWise Automate Agent Deployment group policy object.","source":"@site/docs/powershell/Install-AutomateAgentGPO.md","sourceDirName":"powershell","slug":"/powershell/ps-install-automateagentgpo","permalink":"/docs/powershell/ps-install-automateagentgpo","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/powershell/Install-AutomateAgentGPO.md","tags":[{"inline":false,"label":"Active Directory","permalink":"/docs/tags/active-directory","description":"Documents related to Active Directory services and management"},{"inline":false,"label":"Setup","permalink":"/docs/tags/setup","description":"Documents on setting up software and hardware configurations"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"ps-install-automateagentgpo","title":"Install-AutomateAgentGPO","title_meta":"Install-AutomateAgentGPO","keywords":["install","automate","agent","gpo"],"description":"Documentation for the Install-AutomateAgentGPO command to create a ConnectWise Automate Agent Deployment group policy object.","tags":["active-directory","setup","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Initialize-VsaAgentFields","permalink":"/docs/powershell/ps-initialize-vsaagentfields"},"next":{"title":"Install-CiscoSecureClient","permalink":"/docs/powershell/ps-install-ciscosecureclient"}}');var i=n(474848),r=n(28453);const l={id:"ps-install-automateagentgpo",title:"Install-AutomateAgentGPO",title_meta:"Install-AutomateAgentGPO",keywords:["install","automate","agent","gpo"],description:"Documentation for the Install-AutomateAgentGPO command to create a ConnectWise Automate Agent Deployment group policy object.",tags:["active-directory","setup","windows"],draft:!1,unlisted:!1},a=void 0,o={},d=[{value:"Description",id:"description",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Usage",id:"usage",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Output",id:"output",level:2},{value:"FAQ",id:"faq",level:4}];function c(e){const t={br:"br",code:"code",h2:"h2",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"description",children:"Description"}),"\n",(0,i.jsx)(t.p,{children:"This script creates a ConnectWise Automate Agent Deployment group policy object that will create a startup script (or a Scheduled Task) policy and apply that policy to the root forest in group policy management."}),"\n",(0,i.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"PowerShell v5+"}),"\n",(0,i.jsx)(t.li,{children:"Internet access"}),"\n",(0,i.jsx)(t.li,{children:"Target domain controller"}),"\n",(0,i.jsx)(t.li,{children:"Active Directory"}),"\n",(0,i.jsx)(t.li,{children:"Group Policy management set up properly"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Set Up the Environment:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Sets the security protocol."}),"\n",(0,i.jsx)(t.li,{children:"Installs or updates the Strapper module."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Create the PowerShell Script:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The New-ScriptFile function generates a PowerShell script for Automate deployment."}),"\n",(0,i.jsxs)(t.li,{children:["This script:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Configures execution policy."}),"\n",(0,i.jsx)(t.li,{children:"Defines functions to install and uninstall the Automate agent."}),"\n",(0,i.jsx)(t.li,{children:"Checks the connection and status of the existing Automate agent."}),"\n",(0,i.jsx)(t.li,{children:"Installs or repairs the agent based on its status and server address."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Create Scheduled Task XML (if required):"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The New-ScheduledTaskXml function generates an XML file for a scheduled task."}),"\n",(0,i.jsx)(t.li,{children:"The scheduled task runs the PowerShell script to deploy or repair the Automate agent."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Apply the Group Policy Object:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Checks if the GPO already exists."}),"\n",(0,i.jsxs)(t.li,{children:["If it does not exist:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Creates the GPO."}),"\n",(0,i.jsx)(t.li,{children:"Links the GPO to the domain."}),"\n",(0,i.jsx)(t.li,{children:"Copies the necessary files to the SYSVOL folder."}),"\n",(0,i.jsx)(t.li,{children:"If the ScheduledTaskGPO switch is used, creates the scheduled task XML and sets up the task."}),"\n",(0,i.jsx)(t.li,{children:"Otherwise, sets up a startup script."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["If the GPO already exists:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Checks if the token matches."}),"\n",(0,i.jsx)(t.li,{children:"If the token does not match, updates the script and GPO with the new token."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-powershell",children:".\\Install-AutomateAgent-GPO.ps1 -Server https://something/somewhere -Token 78907gfdg890879fd7g98 -LocationID 2\n"})}),"\n",(0,i.jsx)(t.p,{children:"Creates a Group Policy Object to run a script that installs the Automate agent if it is missing or repairs it if it is malfunctioning."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-powershell",children:".\\Install-AutomateAgent-GPO.ps1 -Server https://something/somewhere -Token 78907gfdg890879fd7g98 -ScheduledTaskGPO -LocationID 2\n"})}),"\n",(0,i.jsx)(t.p,{children:"Creates a Group Policy Object to run a scheduled task that will immediately run a script that installs the Automate agent if it is missing or repairs it if it is malfunctioning."}),"\n",(0,i.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Parameter"}),(0,i.jsx)(t.th,{children:"Alias"}),(0,i.jsx)(t.th,{children:"Required"}),(0,i.jsx)(t.th,{children:"Default"}),(0,i.jsx)(t.th,{children:"Type"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"Server"})}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"True"}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"String"}),(0,i.jsx)(t.td,{children:"The web address for the Automate instance."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"Token"})}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"True"}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"String"}),(0,i.jsx)(t.td,{children:"The token assigned for the download of the agent installer."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"LocationID"})}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"True"}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"Int"}),(0,i.jsx)(t.td,{children:"The location to assign the computers to when installing."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ScheduledTaskGPO"})}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"False"}),(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"Switch"}),(0,i.jsx)(t.td,{children:"Switch to indicate whether the GPO should create a scheduled task instead of a startup script."})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:".\\Install-AutomateAgentGPO-log.txt"}),"\n",(0,i.jsx)(t.li,{children:"C:\\ProgramData_automation\\Automate-Deploy\\Automate-Deploy.ps1"}),"\n",(0,i.jsx)(t.li,{children:"Group Policy ('Automate-Deploy' or 'Automate-Deploy Scheduled Task')"}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"1. What GPO settings are applied with this policy?"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Startup Script:"}),(0,i.jsx)(t.br,{}),"\n","Windows Settings\\Scripts\\Startup - value: ",(0,i.jsx)(t.code,{children:"Automate-Deploy.ps1"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Logon Script Delay:"}),(0,i.jsx)(t.br,{}),"\n","Administrative Settings\\System\\Group Policy\\Configure Logon Script Delay - values: Enabled, set to 5 minutes."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"2. What is the process for the installation of the agent on a domain-joined computer?"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"If the Automate registry value exists, and the last success state is current, and the server name matches the provided value:"}),(0,i.jsx)(t.br,{}),"\n","No changes are made, and the script exits."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"If the Automate registry value exists, and the last success state is current, but the server name does not match the provided value:"}),(0,i.jsx)(t.br,{}),"\n","The current Automate agent is uninstalled, and the agent is reinstalled with the proper settings."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"If the Automate registry value exists, and the last success state is not current:"}),(0,i.jsx)(t.br,{}),"\n","The current Automate agent is uninstalled, and the agent is reinstalled with the proper settings."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"If the registry value for Automate does not exist:"}),(0,i.jsx)(t.br,{}),"\n","The agent is installed with the provided settings."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"3. What is the process when running this script recurrently on a domain controller?"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"If the Automate-Deploy GPO exists and the token in the deployment script matches the token provided:"}),(0,i.jsx)(t.br,{}),"\n","No changes are made, and the script exits."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"If the Automate-Deploy GPO exists, but the provided token does not match the token in the deployment script:"}),(0,i.jsx)(t.br,{}),"\n","The deployment script is rewritten with the new token."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"If the Automate-Deploy GPO does not exist:"}),(0,i.jsx)(t.br,{}),"\n","The GPO is created, all GPO properties are applied, and the GPO is linked to the root forest."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"4. The Automate-Deployment startup script was removed from the SYSVOL folder; is there a copy anywhere else?"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Yes, a copy of the SYSVOL-written startup script can be found at ",(0,i.jsx)(t.code,{children:"C:\\ProgramData\\_automation\\Automate-Deploy\\Automate-Deploy.ps1"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"5. What new feature has been added regarding ScheduledTaskGPO?"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["A new parameter, ",(0,i.jsx)(t.code,{children:"-ScheduledTaskGPO"}),", has been added to the script. This feature allows the creation of a scheduled task to run the ",(0,i.jsx)(t.code,{children:"Automate-Deploy"})," script. When this parameter is specified:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"An XML file for the scheduled task is created."}),"\n",(0,i.jsx)(t.li,{children:"The XML file and deployment script are copied to the appropriate locations in the SYSVOL folder."}),"\n",(0,i.jsx)(t.li,{children:"The GPO is configured to use the scheduled task instead of a startup script."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"6. What GPO settings are applied with the ScheduledTaskGPO feature?"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Scheduled Task:"}),(0,i.jsx)(t.br,{}),"\n","The GPO will execute the deployment script (",(0,i.jsx)(t.code,{children:"Automate-Deploy.ps1"}),") immediately on the end machines with the help of a scheduled task."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Deployment Script:"}),(0,i.jsx)(t.br,{}),"\n","The deployment script is placed in the NETLOGON folder."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var s=n(296540);const i={},r=s.createContext(i);function l(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);