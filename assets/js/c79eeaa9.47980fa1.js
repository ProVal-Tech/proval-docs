"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[97895],{418215:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"cwa/scripts/dedb8564-bb1a-47b8-9525-61fc9e690cae","title":"Out of Date Cumulative Updates Autofix","description":"This document provides an overview of the Autofix script designed to automate the installation of the latest available Cumulative Update on computers. It includes troubleshooting steps, rescheduling logic for offline machines, and email alert options, ensuring a smooth patch installation process.","source":"@site/docs/cwa/scripts/Out of Date Cumulative Updates Autofix.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/dedb8564-bb1a-47b8-9525-61fc9e690cae","permalink":"/docs/cwa/scripts/dedb8564-bb1a-47b8-9525-61fc9e690cae","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/Out of Date Cumulative Updates Autofix.md","tags":[{"inline":false,"label":"Email","permalink":"/docs/tags/email","description":"Documents about email systems and their management"},{"inline":false,"label":"Ticketing","permalink":"/docs/tags/ticketing","description":"Documents related to ticketing systems and IT support management"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"dedb8564-bb1a-47b8-9525-61fc9e690cae","title":"Out of Date Cumulative Updates Autofix","title_meta":"Out of Date Cumulative Updates Autofix","keywords":["autofix","cumulative","update","installation","script","troubleshooting"],"description":"This document provides an overview of the Autofix script designed to automate the installation of the latest available Cumulative Update on computers. It includes troubleshooting steps, rescheduling logic for offline machines, and email alert options, ensuring a smooth patch installation process.","tags":["email","ticketing","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Out of Date Cumulative Updates Autofix without Ticketing","permalink":"/docs/cwa/scripts/5e2c781f-761a-42f8-8d0a-d2866c2318b5"},"next":{"title":"Outlook - Office Address Book Removal","permalink":"/docs/cwa/scripts/a0367fce-be4b-474d-8ea1-259d81a33858"}}');var n=i(474848),a=i(28453);const r={id:"dedb8564-bb1a-47b8-9525-61fc9e690cae",title:"Out of Date Cumulative Updates Autofix",title_meta:"Out of Date Cumulative Updates Autofix",keywords:["autofix","cumulative","update","installation","script","troubleshooting"],description:"This document provides an overview of the Autofix script designed to automate the installation of the latest available Cumulative Update on computers. It includes troubleshooting steps, rescheduling logic for offline machines, and email alert options, ensuring a smooth patch installation process.",tags:["email","ticketing","windows"],draft:!1,unlisted:!1},o=void 0,l={},c=[{value:"Summary",id:"summary",level:2},{value:"Bug Fix: 04/19/2024",id:"bug-fix-04192024",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"System Properties",id:"system-properties",level:2},{value:"Script States",id:"script-states",level:2},{value:"Output",id:"output",level:2},{value:"Ticketing",id:"ticketing",level:2},{value:"Ticket Category",id:"ticket-category",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,n.jsxs)(t.p,{children:["This Autofix script is designed to initiate the installation of the latest available Cumulative Update on computers identified by the ",(0,n.jsx)(t.a,{href:"/docs/cwa/monitors/a835c448-fd00-4807-a3b2-8f1066e1a682",children:"Internal Monitor - Last Cumulative Update > 75 Days ago"}),". The script includes basic troubleshooting steps to ensure a smooth patch installation process."]}),"\n",(0,n.jsx)(t.p,{children:"Here's an overview of the script's functionalities:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"The script generates an initial ticket, conducts fundamental troubleshooting for initial patching, validates patch manager WUA settings, attempts to install the most recent Cumulative Update, and logs the outcome in the ticket."}),"\n",(0,n.jsx)(t.li,{children:"If the computer goes offline while the script attempts to install the latest available Cumulative Update and the PowerShell script fails, the Autofix script will automatically reschedule itself to run again after 4 hours."}),"\n",(0,n.jsx)(t.li,{children:"If successful, the ticket is closed; otherwise, a failure comment is added."}),"\n",(0,n.jsxs)(t.li,{children:["The ",(0,n.jsx)(t.code,{children:"Out_of_Date_CU-Autofix_for_Servers"})," system property can extend the Autofix section to servers if set to ",(0,n.jsx)(t.code,{children:"1"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["The script does not force a computer to restart but recommends it. For environments with the ",(0,n.jsx)(t.a,{href:"/docs/solutions/32d2254e-c2a4-4f2d-a029-b74f6d3c8b1a",children:"Solution - User Prompt for Reboot"}),", it marks the ",(0,n.jsx)(t.code,{children:"Pending Reboot"})," EDF to prompt users for a restart and closes the initial ticket upon successful reboot."]}),"\n",(0,n.jsx)(t.li,{children:"If the solution is not in place, the script adds a comment in the initial ticket to prompt a restart at the earliest convenience."}),"\n",(0,n.jsx)(t.li,{children:"The script tracks post-reboot installations, rescheduling itself every 12 hours to monitor system uptime. If a Cumulative Update is installed within 45 days, it closes the ticket; otherwise, it adds a failure comment or creates a new ticket."}),"\n",(0,n.jsx)(t.li,{children:"The script handles offline machines, rescheduling itself based on offline duration (4 hours, 12 hours, or terminating after 30 days)."}),"\n",(0,n.jsx)(t.li,{children:"It accommodates machines in maintenance mode, rescheduling an hour after the maintenance window ends or terminating future schedules if the maintenance mode lasts more than 30 days."}),"\n",(0,n.jsxs)(t.li,{children:["Optionally, email alerts can be enabled by setting the value of the system property ",(0,n.jsx)(t.code,{children:"Out_of_Date_CU-EmailAlerts"})," to ",(0,n.jsx)(t.code,{children:"1"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"This script comprehensively manages Cumulative Update installations, ensuring efficient handling of various scenarios, including offline status, maintenance mode, and appropriate alerts for non-integrated partners."}),"\n",(0,n.jsx)(t.h2,{id:"bug-fix-04192024",children:"Bug Fix: 04/19/2024"}),"\n",(0,n.jsx)(t.p,{children:"The script has been adjusted to specifically target the installation of Cumulative Updates from the monthly channel. Previously, it was picking up other Cumulative Updates, such as those for SQL and Exchange."}),"\n",(0,n.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,n.jsxs)(t.p,{children:["This Autofix script is intended for implementation through the ",(0,n.jsx)(t.a,{href:"/docs/cwa/monitors/a835c448-fd00-4807-a3b2-8f1066e1a682",children:"CWM - Automate - Internal Monitor - Patches Not Installing > 60 Days"})," monitor set, using the ",(0,n.jsx)(t.code,{children:"\u25b3 Custom - Autofix - Out Of Date Cumulative Updates"})," alert template. However, it can also be manually executed simultaneously."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Sample Run",src:i(592696).A+"",width:"1000",height:"825"})}),"\n",(0,n.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Import the script from the ",(0,n.jsx)(t.code,{children:"ProSync Client"})," plugin."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["During the initial execution, run the script against a Windows computer with the script parameter ",(0,n.jsx)(t.code,{children:"Set_Environment"})," configured as ",(0,n.jsx)(t.code,{children:"1"}),". This action will import the necessary system properties required for solution management."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Execution",src:i(388307).A+"",width:"1000",height:"820"})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Configure the necessary values within the system properties, as elaborated in the System Properties section of the document."}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://proval.itglue.com/DOC-5078775-12849478",children:"EPM - Windows Update - Script - Get Latest Installed Cumulative Update"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/docs/cwa/monitors/a835c448-fd00-4807-a3b2-8f1066e1a682",children:"CWM - Automate - Internal Monitor - Patches Not Installing > 60 Days"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/docs/solutions/32d2254e-c2a4-4f2d-a029-b74f6d3c8b1a",children:"EPM - Windows Configuration - Solution - User Prompt for Reboot"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/docs/powershell/ps-repair-windowsupdate",children:"SEC - Windows Update - Agnostic - Repair-WindowsUpdate"})}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"system-properties",children:"System Properties"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Default"}),(0,n.jsx)(t.th,{children:"Required"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Out_of_Date_CU-EmailAlerts"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"Configure it to 1 to activate email alerts in conjunction with the tickets."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Out_of_Date_CU-Autofix_for_Servers"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"Assign a value of 1 to enable Autofix for servers; by default, the script will only generate a ticket for servers."})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"script-states",children:"Script States"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Example"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsx)(t.tbody,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Out_of_Date_CU_Stage"}),(0,n.jsx)(t.td,{children:"Validation"}),(0,n.jsxs)(t.td,{children:["To monitor the progress of the validation on the computer, the script state is also utilized in the ",(0,n.jsx)(t.a,{href:"/docs/cwa/monitors/a835c448-fd00-4807-a3b2-8f1066e1a682",children:"Internal Monitor - Last Cumulative Update > 75 Days ago"})," monitor set. This helps prevent duplicate executions of the script for the same computers."]})]})})]}),"\n",(0,n.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Script Log"}),"\n",(0,n.jsx)(t.li,{children:"Ticket"}),"\n",(0,n.jsx)(t.li,{children:"Email (if enabled)"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"ticketing",children:"Ticketing"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Subject:"}),"  ",(0,n.jsx)(t.code,{children:"UPDATES - \\\\<Days Since the Latest Installed CU was Released>+ Days Since Last CU Installed on \\\\<Computer Name>"})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Example:"}),"  ",(0,n.jsx)(t.code,{children:"UPDATES - 90+ Days Since Last CU Installed on DEV-Win10-1"})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Possible Ticket Summary/Comment:"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Initial Summary/Comment for the servers when Autofix is disabled:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"The machine %COMPUTERNAME% is currently reporting it is on the OS Build: @OSBuild@, which indicates the machine is running the @MoYr@ Cumulative update. While other patches may have been installed, the Cumulative update is by far the most important.\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\r\nThe last update(s) seen to have been installed are as follows:\r\n- OSBuild: @OSBuild@\r\n- Cumulative Update (CU): @CU@\r\nThe Autofix feature is turned off for servers. Please manually verify the machine.\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Initial Summary/Comment for all machines when Autofix is enabled for the servers as well:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"The machine %COMPUTERNAME% is currently reporting it is on the OS Build: @OSBuild@, which indicates the machine is running the @MoYr@ Cumulative update. While other patches may have been installed, the Cumulative update is by far the most important.\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\r\nThe last update(s) seen to have been installed are as follows:\r\n- OSBuild: @OSBuild@\r\n- Cumulative Update (CU): @CU@\r\nPost Autofix Attempt Comment: \r\n@Reason@\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"After attempting to install the Cumulative Update:"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"If CU is not detected on the computer:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Automate tried to conduct basic troubleshooting, but it still doesn't display any Cumulative Update for installation. The most recent CU installed on the machine was @CU@.\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\r\nPlease manually inspect the computer.\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"If CU installation fails for some reason:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Automated troubleshooting was initiated in an attempt to install the latest Cumulative Update (@AvailableCU@) for the computer. However, the installation process failed.\r\nOutput of the installation command:\r\n@CUInstallResult@\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\r\nManual inspection of the computer is required to address the issue.\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsxs)(t.strong,{children:["If CU is successfully installed but the ",(0,n.jsx)(t.a,{href:"/docs/solutions/32d2254e-c2a4-4f2d-a029-b74f6d3c8b1a",children:"User Prompt for Reboot"})," solution is not configured:"]})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"The computer has successfully received and installed the latest Cumulative Update (@AvailableCU@) through the automated process. However, it's essential to be aware that the Automate environment currently does not have the `Reboot Pending [Prompt]` solution installed (<../../solutions/User Prompt for Reboot.md>). To ensure the finalization of the Cumulative Update installation, it is advised to manually restart the computer at your earliest convenience.\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\r\nAutomate will actively monitor the machine and will send an email alert if the patch installation does not complete successfully after the computer restarts. This monitoring will persist for a period of 30 days, after which it will automatically cease. Therefore, it is crucial to restart the computer within this timeframe to guarantee the proper completion of the update process.\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsxs)(t.strong,{children:["The ticket will be finished if the CU is successfully installed, and the environment has the ",(0,n.jsx)(t.a,{href:"/docs/solutions/32d2254e-c2a4-4f2d-a029-b74f6d3c8b1a",children:"User Prompt for Reboot"})," solution configured:"]})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"The server has successfully received and installed the latest Cumulative Update (@AvailableCU@) through the automated process. To ensure the finalization of the Cumulative Update installation, it is advised to restart the server at your earliest convenience.\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\r\nAutomate will actively monitor the machine and will send an email alert if the patch installation does not complete successfully after the computer restarts. This monitoring will persist for a period of 30 days, after which it will automatically cease. Therefore, it is crucial to restart the server within this timeframe to guarantee the proper completion of the update process.\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Validation Stage:"})}),"\n",(0,n.jsx)(t.p,{children:"If the initial ticket was closed, a new ticket will be generated for the failure; otherwise, a comment will be appended to the existing ticket:"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Subject:"}),"  ",(0,n.jsx)(t.code,{children:"UPDATES - \\\\<Days Since the Latest Installed CU was Released>+ Days Since Last CU Installed on \\\\<Computer Name>"})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Failed to deploy the Cumulative Update:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"The machine %COMPUTERNAME% is currently reporting it is on the OS Build: @OSBuild@, which indicates the machine is running the @MoYr@ Cumulative update. While other patches may have been installed, the Cumulative update is by far the most important.\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\r\nThe last update(s) seen to have been installed are as follows:\r\n- OSBuild: @OSBuild@\r\n- Cumulative Update (CU): @CU@\r\nDespite a post-Cumulative Update installation restart, the computer still lacks the latest available Cumulative Update. Please conduct a manual check on the computer.\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Ticket Finish Comment for Successful Installation:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"The computer has been updated, and the most recent Cumulative Update installed is @CU@.\r\nThe WUA Settings validation has been performed too. The results are:\r\n@ScriptResult@\n"})}),"\n",(0,n.jsx)(t.h2,{id:"ticket-category",children:"Ticket Category"}),"\n",(0,n.jsx)(t.p,{children:"The ticket category for the tickets generated by the script can be set at the following levels:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["At the group level. The ticket category can be set from the groups where the internal monitor ",(0,n.jsx)(t.a,{href:"/docs/cwa/monitors/a835c448-fd00-4807-a3b2-8f1066e1a682",children:"CWM - Automate - Internal Monitor - Patches Not Installing > 60 Days"})," is enabled. This feature provides the flexibility to move the tickets into different boards based on their Operating System and Service Plans."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["On the global monitor set. The ticket category can be selected at the monitor set (",(0,n.jsx)(t.a,{href:"/docs/cwa/monitors/a835c448-fd00-4807-a3b2-8f1066e1a682",children:"CWM - Automate - Internal Monitor - Patches Not Installing > 60 Days"}),"). This ticket category will only be picked if the group-level ticket category is not defined."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"If the ticket category is not set from any of the above places, then the ticket will be generated under the default ticket category."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},592696:(e,t,i)=>{i.d(t,{A:()=>s});const s=i.p+"assets/images/image_1-add0bd8db19db59375adeab91802b32c.png"},388307:(e,t,i)=>{i.d(t,{A:()=>s});const s=i.p+"assets/images/image_2-9a934675785686f0b6d74765ab04e7d2.png"},28453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>o});var s=i(296540);const n={},a=s.createContext(n);function r(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);