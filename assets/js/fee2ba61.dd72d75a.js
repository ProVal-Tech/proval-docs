"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[54633],{148711:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"cwa/monitors/5099131e-bdc7-470a-8bd1-011dfc54ef4e","title":"Security - Possible Brute Force Attack","description":"This document outlines the steps to manage the ProVal - Production - Security - Possible Brute Force Attack monitor in your environment, including the removal of existing instances, refreshing group status, executing SQL queries for monitor setup, and implementing alert templates for effective monitoring.","source":"@site/docs/cwa/monitors/Security - Possible Brute Force Attack.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/5099131e-bdc7-470a-8bd1-011dfc54ef4e","permalink":"/proval-docs/docs/cwa/monitors/5099131e-bdc7-470a-8bd1-011dfc54ef4e","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/Security - Possible Brute Force Attack.md","tags":[{"inline":false,"label":"Database","permalink":"/proval-docs/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Security","permalink":"/proval-docs/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Setup","permalink":"/proval-docs/docs/tags/setup","description":"Documents on setting up software and hardware configurations"}],"version":"current","frontMatter":{"id":"5099131e-bdc7-470a-8bd1-011dfc54ef4e","title":"Security - Possible Brute Force Attack","title_meta":"Security - Possible Brute Force Attack","keywords":["proval","security","brute","force","monitor","alert"],"description":"This document outlines the steps to manage the ProVal - Production - Security - Possible Brute Force Attack monitor in your environment, including the removal of existing instances, refreshing group status, executing SQL queries for monitor setup, and implementing alert templates for effective monitoring.","tags":["database","security","setup"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Scripting Engine Hung","permalink":"/proval-docs/docs/cwa/monitors/9292f135-cca4-4eba-97ff-cd4276ab62e9"},"next":{"title":"Security - Potential MimiKatz Vulnerable System","permalink":"/proval-docs/docs/cwa/monitors/1f0cc77f-4d58-4486-a99a-0c276e40b117"}}');var o=r(474848),s=r(28453);const a={id:"5099131e-bdc7-470a-8bd1-011dfc54ef4e",title:"Security - Possible Brute Force Attack",title_meta:"Security - Possible Brute Force Attack",keywords:["proval","security","brute","force","monitor","alert"],description:"This document outlines the steps to manage the ProVal - Production - Security - Possible Brute Force Attack monitor in your environment, including the removal of existing instances, refreshing group status, executing SQL queries for monitor setup, and implementing alert templates for effective monitoring.",tags:["database","security","setup"],draft:!1,unlisted:!1},i=void 0,c={},d=[{value:"Step 1",id:"step-1",level:2},{value:"Step 2",id:"step-2",level:2},{value:"Step 3",id:"step-3",level:2},{value:"Step 4",id:"step-4",level:2},{value:"Step 5",id:"step-5",level:2},{value:"Step 6",id:"step-6",level:2}];function l(e){const t={code:"code",h2:"h2",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"step-1",children:"Step 1"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Skip this step for new installations."})}),"\n",(0,o.jsxs)(t.p,{children:["Remove the existing ",(0,o.jsx)(t.code,{children:"ProVal - Production - Security - Possible Brute Force Attack"})," remote monitor from the environment. This should only be installed on the Domain Controllers group, which you can verify using the SQL query below:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sql",children:"SELECT * FROM groupagents WHERE `Name` = 'ProVal - Production - Security - Possible Brute Force Attack';\n"})}),"\n",(0,o.jsx)(t.p,{children:"Then you can delete them using the SQL queries below:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sql",children:"DELETE FROM groupagents WHERE `Name` = 'ProVal - Production - Security - Possible Brute Force Attack';\r\nDELETE FROM agents WHERE `Name` = 'ProVal - Production - Security - Possible Brute Force Attack' AND computerid > 0;\n"})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"step-2",children:"Step 2"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Skip this step for new installations."})}),"\n",(0,o.jsxs)(t.p,{children:["Navigate to ",(0,o.jsx)(t.code,{children:"Help"})," > ",(0,o.jsx)(t.code,{children:"Server Status"})," and select ",(0,o.jsx)(t.code,{children:"Do Group Refresh"}),"."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Image 1",src:r(351247).A+"",width:"285",height:"475"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Image 2",src:r(428788).A+"",width:"542",height:"601"})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"step-3",children:"Step 3"}),"\n",(0,o.jsx)(t.p,{children:"Execute the SQL query from a RAWSQL monitor set to import the monitor set."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sql",children:"SET @searchId = (SELECT MIN(sensID) FROM sensorchecks WHERE GUID = '430a4640-9c97-4344-bfe8-7a786b110729' OR `Name` = 'Server Role - AD - Infrastructure Master');\r\nSET @groupid = (SELECT MIN(groupid) FROM mastergroups WHERE GUID = '3ac455da-f1fb-11e1-b4ec-1231391d2d19' OR FullName = 'Service Plans.Windows Servers.Server Roles.Windows Servers Core Services.Domain Controllers');\r\nINSERT INTO groupagents\r\nSELECT '' AS `AgentID`,\r\n`groupid` AS `GroupID`,\r\n@searchId AS `SearchID`,\r\n'ProVal - Production - Security - Possible Brute Force Attack' AS `Name`,\r\n'6' AS `CheckAction`,\r\n'1' AS `AlertAction`,\r\n'Possible Brute Force Attack on %COMPUTERNAME%~~~There are no potential brute force or logon failures detected in the last hour on %CLIENTNAME%////%COMPUTERNAME% at %LOCATIONNAME%!!!Possible Brute Force Attack on %COMPUTERNAME%~~~A possible brute force attack has been detected on %CLIENTNAME%////%COMPUTERNAME% at %LOCATIONNAME%. //r//n//r//nHere is a breakdown of the logon attempts that failed over the past hour.//r//n//r//n%RESULT%//r//n//r//nLogon Type Reference Table: //r//n//r//n2: Interactive//r//n3: Network//r//n4: Batch//r//n5: Service//r//n7: Unlock//r//n8: NetworkCleartext//r//n9: NewCredentials//r//n10: RemoteInteractive//r//n11: CachedInteractive//r//n//r//nFailure Reason Reference Table: //r//n//r//n0XC000005E: There are currently no logon servers available to service the logon request.//r//n0xC0000064: User logon with misspelled or bad user account.//r//n0xC000006A: User logon with misspelled or bad password for critical accounts or service accounts.//r//n0XC000006D: This is either due to a bad username or authentication information for critical accounts or service accounts.//r//n0xC000006F: User logon outside authorized hours.//r//n0xC0000070: User logon from unauthorized workstation.//r//n0xC0000072: User logon to account disabled by administrator.//r//n0XC000015B: The user has not been granted the requested logon type (aka logon right) at this machine.//r//n0XC0000192: An attempt was made to log on, but the Netlogon service was not started.//r//n0xC0000193: User logon with expired account.//r//n0XC0000413: Logon Failure: The machine you are logging onto is protected by an authentication firewall. The specified account is not allowed to authenticate to the machine.//r//n//r//nNote: Compare FailureSubStatus (or FailureStatus if FailureSubStatus is not available) with the reference table mentioned above to identify the failure reason.//r//n//r//nFor more detailed information: [Event 4625](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4625)' AS `AlertMessage`,\r\n'0' AS `ContactID`,\r\n'3600' AS `interval`,\r\n'127.0.0.1' AS `Where`,\r\n'7' AS `What`,\r\n'C:////Windows////System32////WindowsPowerShell////v1.0////powershell.exe -ExecutionPolicy Bypass -Command /\"$ErroractionPreference= //'SilentlyContinue//';$th = 10;$hours = 1;$StartTime = (Get-date).Addhours(-$hours);$filter = @{LogName = //'Security//'; ID = 4625; StartTime = $StartTime };$events = Get-WinEvent -FilterHashtable $filter;$filteredEvents = $events | Where-Object { $_.Message -notmatch //'Logon Type:////s+4//' -and $_.Message -notmatch //'Logon Type:////s+5//' };$total = ($filteredEvents | Measure-Object).count;if ($total -ge $th) {Write-output /////\"$n$total failed logon event logs detected in the past $hours hour(s).`n/////\";$groupedEvents = $filteredEvents | Where-Object { $_.Properties.Value -match //'////S//' } | Group-Object  @{ Expression = { $_.Properties.Value } }, @{ Expression = { $_.Properties.Value } };$output = @();foreach ($group in $groupedEvents) { $ex = ([xml]$groupedEvents.Group[-1].ToXml()).Event;$time = ([DateTime]$ex.System.TimeCreated.SystemTime).ToString(//'yyyy-MM-dd HH:mm:ss//');$data = $ex.eventdata.data;$e = [Ordered]@{};$data | ForEach-Object { $e[$_.Name] = $_.'#Text' };$procid = [Convert]::ToInt64($e.ProcessId, 16);$processStatus = if ($procid -gt 0 -and (Get-Process -Id $procid)) { //'Running//' } else { //'Not Running//' };$op = [pscustomObject]@{UserName = $e.TargetUserName;UserSid = $e.TargetUserSid;Domain = $e.TargetDomainName;LogonType = $e.LogonType;WorkstationName = $e.WorkstationName;SourceIpAddress = $e.IpAddress;SourceIpPort = $e.IpPort;FailureStatus = $e.Status;FailureSubStatus = $e.SubStatus;callerProcessId = $procid;CallerProcessName = $e.ProcessName;CallerProcessStatus = $processStatus;LogonProcess = $e.LogonProcessName;AuthenticationPackage = $e.AuthenticationPackageName;TransmittedServices = $e.TransmittedServices;NTLMPackageName = $e.LmPackageName;KeyLength = $e.KeyLength;Occurrences = $group.Count;MostRecentDetection = $time };$output += $op}return $output}/\"' AS `DataOut`,\r\n'16' AS `Comparor`,\r\n'10|((^((OK){0,}(////r////n){0,}[////r////n]{0,}////s{0,})$)%7C(^$))|11|((^((OK){0,}(////r////n){0,}[////r////n]{0,}////s{0,})$)%7C(^$))%7C(^((////r////n){0,}[////r////n]{0,}////s{0,})[0-9]{1,} failed logon event logs detected in the past [0-9]{1,} hour////(s////)////.)|10|^((////r////n){0,}[////r////n]{0,}////s{0,})[0-9]{1,} failed logon event logs detected in the past [0-9]{1,} hour////(s////)////.' AS `DataIn`,\r\n'' AS `IDField`,\r\n'0' AS `AlertStyle`,\r\n'0' AS `ScriptID`,\r\n'' AS `datacollector`,\r\n'21' AS `Category`,\r\n'0' AS `TicketCategory`,\r\n'1' AS `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) AS `GUID`,\r\n'root' AS `UpdatedBy`,\r\n(NOW()) AS `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (@groupid)\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Security - Possible Brute Force Attack');\n"})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"step-4",children:"Step 4"}),"\n",(0,o.jsxs)(t.p,{children:["Locate your remote monitor by navigating to the ",(0,o.jsx)(t.code,{children:"Domain Controller"}),"."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Image",src:r(166269).A+"",width:"578",height:"277"})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"step-5",children:"Step 5"}),"\n",(0,o.jsxs)(t.p,{children:["Ensure that the monitor set is limited to the ",(0,o.jsx)(t.code,{children:"Server Role - AD - Infrastructure Master"})," search."]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Image",src:r(957122).A+"",width:"1000",height:"452"})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"step-6",children:"Step 6"}),"\n",(0,o.jsx)(t.p,{children:"Implement the appropriate alert template for alerting."}),"\n",(0,o.jsxs)(t.p,{children:["Suggested alert template: ",(0,o.jsx)(t.code,{children:"\u25b3 Custom - Ticket Creation Computer - Failures Only"})]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},351247:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/image_1-93d5493383f0026a9f45584b15be18f1.png"},428788:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/image_2-30bd63207681758eab6c50fa3bec75ed.png"},166269:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/image_3-d0487654d78917ad3eef03d2f46759d4.png"},957122:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/image_4-8af7d24053fe4ab7c4684bae640e49e1.png"},28453:(e,t,r)=>{r.d(t,{R:()=>a,x:()=>i});var n=r(296540);const o={},s=n.createContext(o);function a(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);