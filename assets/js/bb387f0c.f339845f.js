"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[67062],{151358:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"vsa/procedures/c7103d81-4170-443a-b460-7522ac99e279","title":"User Profile Removal","description":"This document provides a detailed overview of a script that removes a user profile from an endpoint. It includes prompts for user confirmation and the username to remove, along with an example agent procedure log demonstrating the script in action.","source":"@site/docs/vsa/procedures/User Profile Removal.md","sourceDirName":"vsa/procedures","slug":"/vsa/procedures/c7103d81-4170-443a-b460-7522ac99e279","permalink":"/docs/vsa/procedures/c7103d81-4170-443a-b460-7522ac99e279","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/vsa/procedures/User Profile Removal.md","tags":[{"inline":false,"label":"Security","permalink":"/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Software","permalink":"/docs/tags/software","description":"Documents related to software applications and their lifecycle management"},{"inline":false,"label":"Uninstallation","permalink":"/docs/tags/uninstallation","description":"Documents related to software removal and uninstallation processes"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"c7103d81-4170-443a-b460-7522ac99e279","title":"User Profile Removal","title_meta":"User Profile Removal","keywords":["user","profile","removal","endpoint","script"],"description":"This document provides a detailed overview of a script that removes a user profile from an endpoint. It includes prompts for user confirmation and the username to remove, along with an example agent procedure log demonstrating the script in action.","tags":["security","software","uninstallation","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"UpdateHostFile","permalink":"/docs/vsa/procedures/bd441da7-fe79-4ee5-afbf-d2fd46978885"},"next":{"title":"UserFolderRestore","permalink":"/docs/vsa/procedures/aa3b4c39-2f50-4954-b1de-ec2c16ea3f45"}}');var n=t(474848),d=t(28453);const i={id:"c7103d81-4170-443a-b460-7522ac99e279",title:"User Profile Removal",title_meta:"User Profile Removal",keywords:["user","profile","removal","endpoint","script"],description:"This document provides a detailed overview of a script that removes a user profile from an endpoint. It includes prompts for user confirmation and the username to remove, along with an example agent procedure log demonstrating the script in action.",tags:["security","software","uninstallation","windows"],draft:!1,unlisted:!1},o=void 0,a={},l=[{value:"Summary",id:"summary",level:2},{value:"Example Agent Procedure Log",id:"example-agent-procedure-log",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Output",id:"output",level:2}];function c(e){const r={a:"a",h2:"h2",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,n.jsx)(r.p,{children:"This script removes a user profile from an endpoint. It prompts the user for confirmation (y or n) and requests the username to be removed. Note that the script cannot remove the user profile of a currently logged-in user. (See the Agent Procedure Log below for an example of this.)"}),"\n",(0,n.jsx)(r.h2,{id:"example-agent-procedure-log",children:"Example Agent Procedure Log"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Time"}),(0,n.jsx)(r.th,{children:"Action"}),(0,n.jsx)(r.th,{children:"Result"}),(0,n.jsx)(r.th,{children:"User"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:43 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"User Profile Removal"}),(0,n.jsx)(r.td,{children:"Success THEN"}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:43 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"User Profile Removal-0004"}),(0,n.jsx)(r.td,{children:"ERROR: 2023-03-01 08:41:41 An error occurred when attempting to remove the user profile. Error: The process cannot access the file because it is being used by another process."}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:43 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"User Profile Removal-0002"}),(0,n.jsx)(r.td,{children:"Log: 2023-03-01 08:41:33 INIT ----------------------------------------------- 2023-03-01 08:41:33 INIT Remove-UserProfile 2023-03-01 08:41:33 INIT System: DEV 2023-03-01 08:41:33 INIT User: DEV$ 2023-03-01 08:41:33 INIT OS Bitness: AMD64 2023-03-01 08:41:33 INIT PowerShell Bitness: 64 2023-03-01 08:41:33 INIT PowerShell Version: 5 2023-03-01 08:41:33 INIT ----------------------------------------------- 2023-03-01 08:41:33 LOG Checking if 'DEV//test1' is a local account. 2023-03-01 08:41:35 LOG Local account: True 2023-03-01 08:41:35 LOG Gathering profile data. 2023-03-01 08:41:35 LOG Removing local user account 'test1' 2023-03-01 08:41:35 LOG Removed local user account 'test1' 2023-03-01 08:41:35 LOG Beginning processing of profile 'C://Users//test1'. 2023-03-01 08:41:40 LOG Checking for profile CIM instance. 2023-03-01 08:41:41 LOG Removing profile CIM instance. 2023-03-01 08:41:41 ..."}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:42 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"User Profile Removal"}),(0,n.jsx)(r.td,{children:"Raw PS1 Data:"}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:42 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command (64-bit, Run As System)"}),(0,n.jsx)(r.td,{children:"Success THEN"}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:42 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command (64-bit, Run As System)-0016"}),(0,n.jsxs)(r.td,{children:["Powershell command complete. Results returned to global variable #global",":psresult","# and saved in Agent's Documents tab of server."]}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:28 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command (64-bit, Run As System)-0011"}),(0,n.jsx)(r.td,{children:'Executing 64-bit Powershell command as System: "" -command "%ProgramData%//_automation//AgentProcedure//UserProfileRemoval//Remove-UserProfile.ps1 -Username test1" >"c://kworking//psoutputtmp.txt"'}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:28 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command (64-bit, Run As System)-0013"}),(0,n.jsx)(r.td,{children:"Sending output to global variable."}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:28 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command (64-bit, Run As System)-0008"}),(0,n.jsx)(r.td,{children:"Custom commands detected as %ProgramData%//_automation//AgentProcedure//UserProfileRemoval//Remove-UserProfile.ps1 -Username test1"}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:28 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command (64-bit, Run As System)-0003"}),(0,n.jsx)(r.td,{children:"No Powershell file variable detected."}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:22 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command (64-bit, Run As System)-0002"}),(0,n.jsx)(r.td,{children:"Powershell is present."}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:12 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command"}),(0,n.jsx)(r.td,{children:"Success THEN"}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:12 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command-0011"}),(0,n.jsx)(r.td,{children:"Powershell command completed!"}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:09 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command-0011"}),(0,n.jsxs)(r.td,{children:['Executing powershell "" -Command "New-Item -Type Directory -Path $env',":ProgramData",'//_automation//AgentProcedure -name UserProfileRemoval" ""']}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:09 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command-0010"}),(0,n.jsx)(r.td,{children:"Not sending output to variable."}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:09 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command-0008"}),(0,n.jsxs)(r.td,{children:['New command variable is: -Command "New-Item -Type Directory -Path $env',":ProgramData",'//_automation//AgentProcedure -name UserProfileRemoval"']}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:09 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command-0008"}),(0,n.jsxs)(r.td,{children:["Custom commands detected as New-Item -Type Directory -Path $env",":ProgramData","//_automation//AgentProcedure -name UserProfileRemoval"]}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:41:03 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Execute Powershell Command-0002"}),(0,n.jsx)(r.td,{children:"Powershell is present."}),(0,n.jsx)(r.td,{children:"dan.hicks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"8:40:55 am 1-Mar-23"}),(0,n.jsx)(r.td,{children:"Run Now - User Profile Removal"}),(0,n.jsx)(r.td,{children:"Admin dan.hicks scheduled procedure Run Now - User Profile Removal to run at Mar 1 2023 8:40AM"}),(0,n.jsx)(r.td,{})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"/docs/powershell/ps-remove-userprofile",children:"EPM - Accounts - Agnostic - Remove-UserProfile"})}),"\n",(0,n.jsx)(r.h2,{id:"output",children:"Output"}),"\n",(0,n.jsx)(r.p,{children:"AP Log"})]})}function h(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>i,x:()=>o});var s=t(296540);const n={},d=s.createContext(n);function i(e){const r=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),s.createElement(d.Provider,{value:r},e.children)}}}]);