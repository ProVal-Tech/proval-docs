"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[42250],{75724:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"cwa/scripts/a2b7d882-f8a5-4273-b237-cabe1662f195","title":"ESXi - Snapshot Create Param","description":"This document outlines a script for creating snapshots of virtual machines hosted on an ESXi server using the VMware PowerCLI module. It includes prerequisites, dependencies, user parameters, and alerting mechanisms for successful and failed executions.","source":"@site/docs/cwa/scripts/ESXi - Snapshot Create Param.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/a2b7d882-f8a5-4273-b237-cabe1662f195","permalink":"/docs/cwa/scripts/a2b7d882-f8a5-4273-b237-cabe1662f195","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/ESXi - Snapshot Create Param.md","tags":[{"inline":false,"label":"Backup","permalink":"/docs/tags/backup","description":"Documents detailing backup solutions and data protection strategies"},{"inline":false,"label":"Security","permalink":"/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Virtualization","permalink":"/docs/tags/virtualization","description":"Documents covering virtualization technologies and their applications"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"a2b7d882-f8a5-4273-b237-cabe1662f195","title":"ESXi - Snapshot Create Param","title_meta":"ESXi - Snapshot Create Param","keywords":["esxi","snapshot","vmware","powercli","automation"],"description":"This document outlines a script for creating snapshots of virtual machines hosted on an ESXi server using the VMware PowerCLI module. It includes prerequisites, dependencies, user parameters, and alerting mechanisms for successful and failed executions.","tags":["backup","security","virtualization","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"ESXI Credential Check - Location","permalink":"/docs/cwa/scripts/48e22d95-37d4-453d-a7a4-d816bd9950f9"},"next":{"title":"Edge-Sidebar - EnableDisable","permalink":"/docs/cwa/scripts/f1cc450a-82dd-49f9-b720-22983f7b696c"}}');var n=s(474848),i=s(28453);const a={id:"a2b7d882-f8a5-4273-b237-cabe1662f195",title:"ESXi - Snapshot Create Param",title_meta:"ESXi - Snapshot Create Param",keywords:["esxi","snapshot","vmware","powercli","automation"],description:"This document outlines a script for creating snapshots of virtual machines hosted on an ESXi server using the VMware PowerCLI module. It includes prerequisites, dependencies, user parameters, and alerting mechanisms for successful and failed executions.",tags:["backup","security","virtualization","windows"],draft:!1,unlisted:!1},o=void 0,l={},d=[{value:"Summary",id:"summary",level:2},{value:"Notes",id:"notes",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Variables",id:"variables",level:2},{value:"User Parameters",id:"user-parameters",level:3},{value:"Output",id:"output",level:2},{value:"Alerting",id:"alerting",level:2}];function c(e){const t={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,n.jsxs)(t.p,{children:["This script can be used to create a snapshot of a machine hosted on an ESXi host server. It utilizes the ",(0,n.jsx)(t.a,{href:"https://www.powershellgallery.com/packages/VMware.PowerCLI/12.0.0.15947286",children:"PowerCLI Module"})," to perform the required action."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Snapshot Name: SELECT CONCAT('CW-Automate-Temp-Snapshot_', DATE_FORMAT(NOW(), '%Y%m%d_%H%i%s'))\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Example:  CW-Automate-Temp-Snapshot_20230501_081958\n"})}),"\n",(0,n.jsx)(t.h3,{id:"notes",children:"Notes"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The script must be executed from a machine that is reachable to the ESXi Host."}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"/docs/cwa/scripts/830beb63-113a-406e-aef2-046403de9cb9",children:"CWM - Automate - ESXi - Snapshot Delete [Param]"})," will be called to remove the generated snapshot after the hours specified in the ",(0,n.jsx)(t.code,{children:"@Hours_To_Keep@"})," user parameter. The schedule depends on the computer's status in Automate. For example, if ",(0,n.jsx)(t.code,{children:"@Hours_To_Keep@"})," is set to 24, then Automate will schedule the deletion script to run on the same machine after 24 hours. However, the deletion script will not work if the machine is offline after that period."]}),"\n",(0,n.jsx)(t.li,{children:"It is suggested to execute the script against servers that are mostly online."}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:".NET Framework 4.7.2+ (Release: 461808)"}),"\n",(0,n.jsx)(t.li,{children:"PowerShell v5.1+"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Create a credential entry on the client's password tab to connect with the ESXi Host. It must be an admin/root-level credential."}),"\n",(0,n.jsxs)(t.li,{children:["Add either the public or private IP address of the ESXi Host in the URL section of the entry. Do not use HTTP or HTTPS along with the IP address.",(0,n.jsx)(t.br,{}),"\n","e.g.,","\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"http://10.0.0.4/io ==> Incorrect  \r\n10.0.0.4 ==> Correct\n"})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["Sample Screenshot:",(0,n.jsx)(t.br,{}),"\n",(0,n.jsx)(t.img,{src:s(923456).A+"",width:"1000",height:"671"})]}),"\n",(0,n.jsxs)(t.li,{children:["Add proper parameters while executing the script.",(0,n.jsx)(t.br,{}),"\n",(0,n.jsx)(t.img,{src:s(821019).A+"",width:"488",height:"509"}),(0,n.jsx)(t.br,{}),"\n","The ",(0,n.jsx)(t.code,{children:"Password_Title"})," should be the title of the password entry created in the first step. In the above example, the script will attempt to create a snapshot for the virtual machine ",(0,n.jsx)(t.code,{children:"Test_VM 1"})," and will attempt to remove that snapshot after 24 hours. It will not generate any alerts on failure."]}),"\n",(0,n.jsxs)(t.li,{children:["For alerting on failure:",(0,n.jsx)(t.br,{}),"\n",(0,n.jsx)(t.img,{src:s(499474).A+"",width:"494",height:"514"}),(0,n.jsx)(t.br,{}),"\n","In this example, the script will attempt to create a snapshot for the virtual machine ",(0,n.jsx)(t.code,{children:"Test_VM 1"})," and will attempt to remove that snapshot after 24 hours. Additionally, the script will create a ticket if it fails to deliver the desired results and will send a failure email to the user running/scheduling the script. Either or both of the alerting options can be used."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"/docs/cwa/scripts/830beb63-113a-406e-aef2-046403de9cb9",children:"CWM - Automate - ESXi - Snapshot Delete [Param]"})}),"\n",(0,n.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"ProjectName"}),(0,n.jsx)(t.td,{children:"ESXi_Snapshot"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"WorkingDirectory"}),(0,n.jsx)(t.td,{children:"C:/ProgramData/_automation/script/ESXi_Snapshot"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"ESXiHost"}),(0,n.jsx)(t.td,{children:"IP Address of ESXi Host, fetched from the password entry"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"UserName"}),(0,n.jsx)(t.td,{children:"Username to use to connect with the ESXi Host, fetched from the password entry"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Password"}),(0,n.jsx)(t.td,{children:"Password to use to connect with the ESXi Host, fetched from the password entry"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"psout"}),(0,n.jsx)(t.td,{children:"Output of the PowerShell script creating the Snapshot"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"SnapshotName"}),(0,n.jsx)(t.td,{children:"Name of the Snapshot to create"})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"user-parameters",children:"User Parameters"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Example"}),(0,n.jsx)(t.th,{children:"Required"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"VMName"}),(0,n.jsx)(t.td,{children:"WIN-10-TEST1"}),(0,n.jsx)(t.td,{children:"True"}),(0,n.jsx)(t.td,{children:"The name of the virtual machine to create a snapshot of."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Password_Title"}),(0,n.jsx)(t.td,{children:"ESXi_Host"}),(0,n.jsx)(t.td,{children:"True"}),(0,n.jsx)(t.td,{children:"Title of the password entry to use to connect with the ESXi Host"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Hours_To_Keep"}),(0,n.jsx)(t.td,{children:"24"}),(0,n.jsx)(t.td,{children:"True"}),(0,n.jsx)(t.td,{children:"Number of hours to keep the generated snapshot. Leaving it blank or passing 0 will not initiate the removal."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Ticket_On_Failure"}),(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"1 to enable ticketing for the script's failure."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Email_On_Failure"}),(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"1 to enable email alert for the script's failure. The email will be sent to the user running/scheduling the script."})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Script Logs"}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Sample Output:\r\n\r\nName                           Port  User                          \r\n----                           ----  ----                          \r\n10.0.0.25                   443   admin\r\nWARNING: The 'Quiesced' property of Snapshot type is deprecated and will be removed in a future release.\r\nWARNING: The 'Parent' property of Snapshot type is deprecated. Use the 'ParentSnapshot' property instead.\r\n\r\nDescription       : Snapshot created by PowerShell script\r\nCreated           : 2023-04-04 3:36:10 AM\r\nQuiesced          : False\r\nPowerState        : PoweredOff\r\nVM                : DEV-WIN10TEST\r\nVMId              : VirtualMachine-138\r\nParent            : \r\nParentSnapshotId  : \r\nParentSnapshot    : \r\nChildren          : \r\nSizeMB            : 23.03101253509521484375\r\nSizeGB            : 0.0224912231788039207458496094\r\nIsCurrent         : True\r\nIsReplaySupported : False\r\nExtensionData     : VMware.Vim.VirtualMachineSnapshotTree\r\nId                : VirtualMachineSnapshot-138-snapshot-1\r\nName              : CW-Automate-Temp-Snapshot_20230404_033857\r\nUid               : /VIServer=root@10.0.0.25:443/Snapshot=VirtualMachineSnapshot-138-snapshot-1/\r\n\r\nSnapshot created successfully for virtual machine 'DEV-WIN10TEST'\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Ticket (If Enabled)"}),"\n",(0,n.jsx)(t.li,{children:"Email to the user running the script (if Enabled)"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"alerting",children:"Alerting"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Subject:"}),"  ",(0,n.jsx)(t.code,{children:"Snapshot creation failed for the VM @VMName@"})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Body:"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"For Prerequisites Validation Failure:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Automate failed to create a snapshot for the virtual machine @VMName@.\r\nThe prerequisite check failed for %ComputerName% and the `ESXi - SnapShot Create [Param]` script cannot be executed against %ComputerName%. \r\nPlease execute the script against another machine in the network to create the snapshot. \r\nPrerequisite Validation Command Output: %ShellResult%\n"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"For Snapshot Creation Failure:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Automate failed to create a snapshot for the virtual machine @VMName@. Please review manually. \r\nPowerShell script result: @psout@\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},923456:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/image_1-38432f8ef90297b8f71217b712797eaa.png"},821019:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/image_2-2f0cadb54ebe95ae9863e36c78aa5447.png"},499474:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/image_3-4046f4ff90044622045da6e025517a74.png"},28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>o});var r=s(296540);const n={},i=r.createContext(n);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);