"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[25183],{306561:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"cwa/monitors/226dd436-7d87-428c-a9ca-5309f5ad6c2f","title":"New Domain Admin","description":"This document outlines the implementation steps for importing an alert template and executing SQL queries to set up monitoring for Domain Controllers. It includes detailed instructions for validating scripts, configuring monitors, and ensuring alert templates are correctly set up.","source":"@site/docs/cwa/monitors/New Domain Admin.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/226dd436-7d87-428c-a9ca-5309f5ad6c2f","permalink":"/proval-docs/docs/cwa/monitors/226dd436-7d87-428c-a9ca-5309f5ad6c2f","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/New Domain Admin.md","tags":[{"inline":false,"label":"Database","permalink":"/proval-docs/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Windows","permalink":"/proval-docs/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"226dd436-7d87-428c-a9ca-5309f5ad6c2f","title":"New Domain Admin","title_meta":"New Domain Admin","keywords":["alert","sql","monitor","template","configuration","domain","controller"],"description":"This document outlines the implementation steps for importing an alert template and executing SQL queries to set up monitoring for Domain Controllers. It includes detailed instructions for validating scripts, configuring monitors, and ensuring alert templates are correctly set up.","tags":["database","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"New Account Detection","permalink":"/proval-docs/docs/cwa/monitors/75f8c13f-04d5-45fd-b650-3b010353a8c0"},"next":{"title":"New Local Admin","permalink":"/proval-docs/docs/cwa/monitors/cce172ca-7bb4-44ff-ada3-77ffd6fc216e"}}');var a=n(474848),i=n(28453);const o={id:"226dd436-7d87-428c-a9ca-5309f5ad6c2f",title:"New Domain Admin",title_meta:"New Domain Admin",keywords:["alert","sql","monitor","template","configuration","domain","controller"],description:"This document outlines the implementation steps for importing an alert template and executing SQL queries to set up monitoring for Domain Controllers. It includes detailed instructions for validating scripts, configuring monitors, and ensuring alert templates are correctly set up.",tags:["database","windows"],draft:!1,unlisted:!1},s=void 0,c={},d=[{value:"Implementation Steps",id:"implementation-steps",level:2}];function l(e){const t={a:"a",br:"br",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"implementation-steps",children:"Implementation Steps"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Import the Alert Template '\u25b3 Custom - Ticket Creation Computer - Failures Only'"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Validate that the ",(0,a.jsx)(t.a,{href:"/proval-docs/docs/cwa/scripts/e14bf501-f10d-44d7-a19a-2284fd5c5cc9",children:"CWM - Automate - Script - Ticket Creation - Computer [Failures Only]"})," script was imported as well."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Run this SQL query from a RAWSQL monitor set to import the required search."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"INSERT INTO `sensorchecks`\r\nSELECT \r\n'' as `SensID`,\r\n'Distinct Domain Controller Per Client' as `Name`,\r\n'Select DISTINCT Computers.ComputerID, Clients.Name as `Client Name`, Computers.Name as `Computer Name`, Computers.Domain, Computers.UserName as `Username`, Computers.ComputerID\r\nFrom Computers, Clients\r\nWhere Computers.ClientID = Clients.ClientID\r\nand ((Computers.ComputerID in (SELECT c1.computerid FROM Computers c1 WHERE c1.domain LIKE 'DC:%' AND c1.lastcontact > NOW() - INTERVAL 10 MINUTE AND c1.computerid = ( SELECT MAX(c2.computerid) FROM Computers c2 WHERE c2.domain = c1.domain AND c2.clientid = c1.clientid AND c2.lastcontact > NOW() - INTERVAL 10 MINUTE ))))' as `SQL`,\r\n'4' as `QueryType`,\r\n'Computer ID||\\\\<=|*(SELECT c1.computerid FROM Computers c1 WHERE c1.domain LIKE 'DC:%' AND c1.lastcontact > NOW() - INTERVAL 10 MINUTE AND c1.computerid = ( SELECT MAX(c2.computerid) FROM Computers c2 WHERE c2.domain = c1.domain AND c2.clientid = c1.clientid AND c2.lastcontact > NOW() - INTERVAL 10 MINUTE ))|=||=|^' as `ListData`,\r\n'0' as `FolderID`,\r\n'13211dbf-74ba-4334-95d6-10a88d15ea46' as `GUID`,\r\n'' as `SearchXML`,\r\n(NULL) as `UpdatedBy`,\r\n(NULL) as `UpdateDate`\r\nFROM (SELECT MIN(computerid) FROM computers) a\r\nWhere (SELECT count(*) From SensorChecks where `GUID` = '13211dbf-74ba-4334-95d6-10a88d15ea46') = 0 ;\n"})}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Run this SQL query from a RAWSQL monitor set to create and set up the remote monitor on the Domain Controllers group."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",children:"SET @Groupid= (SELECT Groupid FROM mastergroups WHERE `GUID` = '3ac455da-f1fb-11e1-b4ec-1231391d2d19');\r\nSET @Searchid= (SELECT sensid FROM sensorchecks WHERE `GUID` = '13211dbf-74ba-4334-95d6-10a88d15ea46');\r\nSET @Alertaction= (SELECT alertactionid FROM alerttemplate WHERE `GUID` = 'f2fe531c-3116-4afa-85b6-bdb3f5c84a39');\r\n\r\nINSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n@Searchid as `SearchID`,\r\n'ProVal - Production - New Domain Admin' as `Name`,\r\n'6' as `CheckAction`,\r\n@Alertaction as `AlertAction`,\r\n'New Domain Admin Detected at %domain%~~~New Domain Admin Not Detected!!!New Domain Admin Detected at %domain%~~~New Domain Admin(s) Detected at %domain% for %clientname%. %RESULT%' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'3600' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \"[Net.ServicePointManager]::SecurityProtocol = [enum]::ToObject([Net.SecurityProtocolType], 3072); $ProjectName = ''Get-NewDomainAdmin''; $WorkingDirectory = ''C://ProgramData//_Automation//Script//$ProjectName//''; $scriptpath = ''$($WorkingDirectory)$($ProjectName).ps1''; $scripturl = ''https://file.provaltech.com/repo/script/Get-NewDomainAdmin.ps1''; if( !(Test-Path $WorkingDirectory) ) {mkdir $WorkingDirectory | Out-Null}; (New-Object System.Net.WebClient).DownloadFile($scripturl,$scriptpath); & $scriptpath\"' as `DataOut`,\r\n'16' as `Comparor`,\r\n'10|^(()%7C %7C(OK)%7C(//r//n))$|11|(^(()%7C %7C(OK)%7C(//r//n))$)%7C(distinguishedName)|10|distinguishedName' as `DataIn`,\r\n'0' as `IDField`,\r\n'0' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'0' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid = @Groupid\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - New Domain Admin') ;\n"})}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Check the ",(0,a.jsx)(t.code,{children:"Domain Controllers"})," group and ensure that the monitor set is created and configured with the correct search and alert template.",(0,a.jsx)(t.br,{}),"\n","Limit To: Distinct Domain Controller Per Client",(0,a.jsx)(t.br,{}),"\n","Alert Template: \u25b3 Custom - Ticket Creation Computer - Failures Only",(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.img,{alt:"Image",src:n(945216).A+"",width:"1000",height:"442"})]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Click ",(0,a.jsx)(t.code,{children:"Edit the Alerts"})," and ensure that the alert template is using the correct script, ",(0,a.jsx)(t.a,{href:"/proval-docs/docs/cwa/scripts/e14bf501-f10d-44d7-a19a-2284fd5c5cc9",children:"CWM - Automate - Script - Ticket Creation - Computer [Failures Only]"}),(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.img,{alt:"Image",src:n(723547).A+"",width:"1000",height:"168"})]}),"\n"]}),"\n"]})]})}function m(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},945216:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/image_1-1665b1e69284745a3a6953e230c05861.png"},723547:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/image_2-4c3abe5b253ad987e1fde07ec304341e.png"},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>s});var r=n(296540);const a={},i=r.createContext(a);function o(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);