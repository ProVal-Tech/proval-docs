"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[50048],{955527:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"cwa/scripts/8eb03817-eae4-4ac4-b1c6-d7a629d32ecf","title":"EPM - Disk - Disk Space Monitoring Process - Client Specific","description":"This document describes a script designed to check disk space against predefined thresholds in a ConnectWise Automate instance, perform disk cleanup on Windows machines, and create a support ticket if necessary. It includes user parameters, system properties, and a detailed process flow for effective disk management.","source":"@site/docs/cwa/scripts/EPM - Disk - Disk Space Monitoring Process - Client Specific.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/8eb03817-eae4-4ac4-b1c6-d7a629d32ecf","permalink":"/proval-docs/docs/cwa/scripts/8eb03817-eae4-4ac4-b1c6-d7a629d32ecf","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/EPM - Disk - Disk Space Monitoring Process - Client Specific.md","tags":[{"inline":false,"label":"Cleanup","permalink":"/proval-docs/docs/tags/cleanup","description":"Documents on system cleanup processes and tools to free up resources"},{"inline":false,"label":"Disk","permalink":"/proval-docs/docs/tags/disk","description":"Documents related to disk management and performance"},{"inline":false,"label":"Windows","permalink":"/proval-docs/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"8eb03817-eae4-4ac4-b1c6-d7a629d32ecf","title":"EPM - Disk - Disk Space Monitoring Process - Client Specific","title_meta":"EPM - Disk - Disk Space Monitoring Process - Client Specific","keywords":["disk","cleanup","threshold","ticket","monitor"],"description":"This document describes a script designed to check disk space against predefined thresholds in a ConnectWise Automate instance, perform disk cleanup on Windows machines, and create a support ticket if necessary. It includes user parameters, system properties, and a detailed process flow for effective disk management.","tags":["cleanup","disk","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"EPM - Data Collection - Automate - Script Get - Battery Report","permalink":"/proval-docs/docs/cwa/scripts/59738aa7-5495-4e4d-a36a-cc8af2643865"},"next":{"title":"EPM - Network - Internal Network - Execute Script - Get - DNS Assignments","permalink":"/proval-docs/docs/cwa/scripts/c3e9e7df-9e35-46ab-bca6-a182331ca211"}}');var r=s(474848),n=s(28453);const c={id:"8eb03817-eae4-4ac4-b1c6-d7a629d32ecf",title:"EPM - Disk - Disk Space Monitoring Process - Client Specific",title_meta:"EPM - Disk - Disk Space Monitoring Process - Client Specific",keywords:["disk","cleanup","threshold","ticket","monitor"],description:"This document describes a script designed to check disk space against predefined thresholds in a ConnectWise Automate instance, perform disk cleanup on Windows machines, and create a support ticket if necessary. It includes user parameters, system properties, and a detailed process flow for effective disk management.",tags:["cleanup","disk","windows"],draft:!1,unlisted:!1},d=void 0,a={},o=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"User Parameters",id:"user-parameters",level:4},{value:"System Properties",id:"system-properties",level:4},{value:"Script States",id:"script-states",level:4},{value:"Process",id:"process",level:2},{value:"Output",id:"output",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(t.p,{children:"This script checks the disk space against thresholds defined in the properties of an Automate instance, runs a disk cleanup, and creates a ticket if necessary."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"https://proval.itglue.com/DOC-5078775-7604247",children:"How to Add/Edit System Properties in ConnectWise Automate"})}),"\n",(0,r.jsxs)(t.p,{children:["Disk cleanup will only run against Windows machines. When run as an auto-fix from a monitor, the monitor should pass the single drive letter (e.g., C) into the ",(0,r.jsx)(t.code,{children:"@fieldname@"})," variable."]}),"\n",(0,r.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Sample Run",src:s(498542).A+"",width:"481",height:"392"})}),"\n",(0,r.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"../../unsorted/EPM%20-%20Disk%20-%20Agent%20-%20Drive%20Space%20Check%20-%20Client%20Specific.md",children:"Agent - Drive Space Check - Client Specific"})}),"\n",(0,r.jsx)(t.h4,{id:"user-parameters",children:"User Parameters"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Example"}),(0,r.jsx)(t.th,{children:"Required"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"DriveLetter"}),(0,r.jsx)(t.td,{children:"C"}),(0,r.jsx)(t.td,{children:"True (False when running via a monitor)"}),(0,r.jsx)(t.td,{children:"The drive letter that should have its drive space checked."})]})})]}),"\n",(0,r.jsx)(t.h4,{id:"system-properties",children:"System Properties"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Example"}),(0,r.jsx)(t.th,{children:"Required"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proval_DiskThreshold16-300"}),(0,r.jsx)(t.td,{children:"10 (means 10%)"}),(0,r.jsx)(t.td,{children:"True (auto-generated)"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.strong,{children:"percentage"})," threshold for disk space on drives that are greater than or equal to 16GB and less than 300GB."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proval_DiskThreshold300-1024"}),(0,r.jsx)(t.td,{children:"30 (means 25GB)"}),(0,r.jsx)(t.td,{children:"True (auto-generated)"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.strong,{children:"gigabyte"})," threshold for disk space on drives that are greater than or equal to 300GB and less than 1TB."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proval_DiskThreshold1024+"}),(0,r.jsx)(t.td,{children:"100 (means 100GB)"}),(0,r.jsx)(t.td,{children:"True (auto-generated)"}),(0,r.jsxs)(t.td,{children:["The ",(0,r.jsx)(t.strong,{children:"gigabyte"})," threshold for disk space on drives that are greater than or equal to 1TB."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proval_DiskTicketCategory"}),(0,r.jsx)(t.td,{children:"102"}),(0,r.jsx)(t.td,{children:"True"}),(0,r.jsx)(t.td,{children:"The ticket category under which tickets will be created."})]})]})]}),"\n",(0,r.jsx)(t.h4,{id:"script-states",children:"Script States"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Example"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsxs)(t.td,{children:["TicketNumber",(0,r.jsx)(t.code,{children:"@DriveLetter@"})]}),(0,r.jsx)(t.td,{children:"123456"}),(0,r.jsx)(t.td,{children:"A dynamically named state holding the ticket number for the target ComputerID and Drive."})]})})]}),"\n",(0,r.jsx)(t.h2,{id:"process",children:"Process"}),"\n",(0,r.jsx)(t.p,{children:"The following steps are performed:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["Determine if the context of the script run was from a monitor or not, and set the ",(0,r.jsx)(t.code,{children:"@driveletter@"})," variable as necessary."]}),"\n",(0,r.jsxs)(t.li,{children:["Create the threshold properties if they do not exist, and set the variables ",(0,r.jsx)(t.code,{children:"@threshold16-300@"}),", ",(0,r.jsx)(t.code,{children:"@threshold300-1024@"}),", and ",(0,r.jsx)(t.code,{children:"@threshold1024+@"})," from the content of the properties."]}),"\n",(0,r.jsxs)(t.li,{children:["Using the script state ",(0,r.jsx)(t.code,{children:"TicketNumber@DriveLetter@"}),", determine if the script has been run against this machine previously and if a ticket has already been created. If there is an existing ticket that is currently open, jump to the ",(0,r.jsx)(t.code,{children:":TicketOpen"})," label. Otherwise, start the initial check of the drive. (Note: The ",(0,r.jsx)(t.code,{children:":TicketOpen"})," label follows the same process as step 5, but instead comments on the existing ticket or closes it if the threshold is not exceeded.)"]}),"\n",(0,r.jsxs)(t.li,{children:["Gather information about the total size of the drive and the current free space of the drive. If ",(0,r.jsx)(t.code,{children:"@driveletter@"})," is the system drive (",(0,r.jsx)(t.code,{children:"@windowsdirectory@ == @driveletter@:/Windows"}),"), then the subscript ",(0,r.jsx)(t.code,{children:"Windows Disk Cleanup"})," will be run."]}),"\n",(0,r.jsx)(t.li,{children:"Check if the current disk space (after cleanup) is below the threshold for the respective drive size. If so, generate a report of the largest file sizes for the drive and create a ticket with the report attached. If the space is not below the threshold, then the script will exit."}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,r.jsx)(t.p,{children:"The script logs all messages to the script log."})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},498542:(e,t,s)=>{s.d(t,{A:()=>i});const i=s.p+"assets/images/image_1-da0d41734cd54ee659d68913912c640c.png"},28453:(e,t,s)=>{s.d(t,{R:()=>c,x:()=>d});var i=s(296540);const r={},n=i.createContext(r);function c(e){const t=i.useContext(n);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);