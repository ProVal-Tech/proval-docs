"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[27970],{744526:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"cwa/scripts/f6426cb7-b51d-4acb-a602-8fb620474a97","title":"Workaround - Windows Search Protocol Vulnerability","description":"This document provides a detailed overview of a script that backs up, removes, or restores the registry key HKEY_CLASSES_ROOT/search-ms. It outlines the script\u2019s functionality, dependencies, and processes involved in executing the script, including options for manual execution and ticket creation for failures.","source":"@site/docs/cwa/scripts/Workaround - Windows Search Protocol Vulnerability.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/f6426cb7-b51d-4acb-a602-8fb620474a97","permalink":"/docs/cwa/scripts/f6426cb7-b51d-4acb-a602-8fb620474a97","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/Workaround - Windows Search Protocol Vulnerability.md","tags":[{"inline":false,"label":"Backup","permalink":"/docs/tags/backup","description":"Documents detailing backup solutions and data protection strategies"},{"inline":false,"label":"Registry","permalink":"/docs/tags/registry","description":"Documents concerning system registry management and troubleshooting"},{"inline":false,"label":"Vulnerability","permalink":"/docs/tags/vulnerability","description":"Documents about system vulnerabilities and methods for their mitigation"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"f6426cb7-b51d-4acb-a602-8fb620474a97","title":"Workaround - Windows Search Protocol Vulnerability","title_meta":"Workaround - Windows Search Protocol Vulnerability","keywords":["backup","restore","registry","windows","search","vulnerability"],"description":"This document provides a detailed overview of a script that backs up, removes, or restores the registry key HKEY_CLASSES_ROOT/search-ms. It outlines the script\u2019s functionality, dependencies, and processes involved in executing the script, including options for manual execution and ticket creation for failures.","tags":["backup","registry","vulnerability","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Workaround - Microsoft Support Diagnostic Tool Vulnerability","permalink":"/docs/cwa/scripts/af9266ed-a796-49b5-b497-944836e23b8c"},"next":{"title":"Group Policy - Audit","permalink":"/docs/cwa/scripts/2e5f5f2b-7c81-4aec-a76a-623a465f959a"}}');var i=r(474848),n=r(28453);const a={id:"f6426cb7-b51d-4acb-a602-8fb620474a97",title:"Workaround - Windows Search Protocol Vulnerability",title_meta:"Workaround - Windows Search Protocol Vulnerability",keywords:["backup","restore","registry","windows","search","vulnerability"],description:"This document provides a detailed overview of a script that backs up, removes, or restores the registry key HKEY_CLASSES_ROOT/search-ms. It outlines the script\u2019s functionality, dependencies, and processes involved in executing the script, including options for manual execution and ticket creation for failures.",tags:["backup","registry","vulnerability","windows"],draft:!1,unlisted:!1},o=void 0,c={},l=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Variables",id:"variables",level:2},{value:"Global Parameters",id:"global-parameters",level:4},{value:"User Parameters",id:"user-parameters",level:4},{value:"Script States",id:"script-states",level:4},{value:"Process",id:"process",level:2},{value:"For Backup and Restore.",id:"for-backup-and-restore",level:3},{value:"For Restore.",id:"for-restore",level:3},{value:"Output",id:"output",level:2}];function d(e){const t={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(t.p,{children:["This script backs up and removes or restores the following registry key:",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"HKEY_CLASSES_ROOT/search-ms"}),(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Key backup location:"}),(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.code,{children:"C:/Windows/LTSvc/Packages/SearchMSRegDirectory"})]}),"\n",(0,i.jsxs)(t.p,{children:["This script is automatically executed by the \u201c",(0,i.jsx)(t.a,{href:"/docs/cwa/monitors/d097987d-79c7-4a2f-a57a-ed959c676b20",children:"ProVal - Development - Workaround - Windows Search Protocol Vulnerability [G]"}),"\u201d Monitor."]}),"\n",(0,i.jsx)(t.p,{children:'This script can also be run manually. It will give you the option to pass the value for the parameter "Restore" if you run it manually. The "HKEY_CLASSES_ROOT/search-ms" key will be restored if the argument is set to 1. The script\'s default behavior is to attempt to export and delete the registry file. The script can create a ticket for failure as well, but to enable the ticketing feature, you need to update the value of the Global Variable Ticket to 1. The script\'s default behavior is to not generate any ticket.'}),"\n",(0,i.jsxs)(t.p,{children:['Apart from this, it saves the final result to a script state, "Search-MS Registry Status," to display the data in the \u201c',(0,i.jsx)(t.a,{href:"/docs/cwa/dataviews/838ecfa5-0526-4c5d-845a-be4f21898c86",children:"Windows Search Protocol Registry Key Audit [Script][Role]"}),"\u201d dataview."]}),"\n",(0,i.jsx)(t.p,{children:"Additionally, the script will import all the contents of the solution for its first run."}),"\n",(0,i.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,i.jsxs)(t.p,{children:["Leave the Restore field blank to remove the registry key:",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.img,{alt:"Remove Registry Key",src:r(531688).A+"",width:"606",height:"529"})]}),"\n",(0,i.jsxs)(t.p,{children:["Set the Restore to 1 for restoring the registry keys:",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.img,{alt:"Restore Registry Key",src:r(393667).A+"",width:"605",height:"533"})]}),"\n",(0,i.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/cwa/roles/174939f4-d7d5-4c92-9813-308db2c2b0c3",children:"Search-MS Registry Key"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/cwa/monitors/d097987d-79c7-4a2f-a57a-ed959c676b20",children:"ProVal - Development - Workaround - Windows Search Protocol Vulnerability [G]"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/solutions/4af66a7d-ddf7-485c-b284-b73a2a5d2de1",children:"Windows Search Protocol Vulnerability - Workarounds"})}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Name"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"OutCome"}),(0,i.jsx)(t.td,{children:"Store the output of the PowerShell scripts being executed to perform the necessary action."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Tickid"}),(0,i.jsx)(t.td,{children:"Variable for retrieving and storing the ticket ID of an existing failure ticket."})]})]})]}),"\n",(0,i.jsx)(t.h4,{id:"global-parameters",children:"Global Parameters"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Name"}),(0,i.jsx)(t.th,{children:"Example"}),(0,i.jsx)(t.th,{children:"Required"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsx)(t.tbody,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Ticketid"}),(0,i.jsx)(t.td,{children:"1 or 0"}),(0,i.jsx)(t.td,{children:"False"}),(0,i.jsx)(t.td,{children:"Set it to 1 to make the script create tickets for the failures."})]})})]}),"\n",(0,i.jsx)(t.h4,{id:"user-parameters",children:"User Parameters"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Name"}),(0,i.jsx)(t.th,{children:"Example"}),(0,i.jsx)(t.th,{children:"Required"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsx)(t.tbody,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Restore"}),(0,i.jsx)(t.td,{children:"1 or leave it blank"}),(0,i.jsx)(t.td,{children:"False"}),(0,i.jsx)(t.td,{children:"1 to use the script to restore the key"})]})})]}),"\n",(0,i.jsx)(t.h4,{id:"script-states",children:"Script States"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Name"}),(0,i.jsx)(t.th,{children:"Example"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsx)(t.tbody,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"search-ms Registry Status"}),(0,i.jsx)(t.td,{children:"Backed Up And Removed, Failed to Remove, Restored, Failed to Restore"}),(0,i.jsx)(t.td,{children:"Outcome of the recent operation performed"})]})})]}),"\n",(0,i.jsx)(t.h2,{id:"process",children:"Process"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Step 1:"})," Imports all the parts to the solution.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 2:"})," Checks if it is called to restore or to remove the registry key."]}),"\n",(0,i.jsx)(t.h3,{id:"for-backup-and-restore",children:"For Backup and Restore."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Step 1:"}),' Clears the script state, "Search-MS Registry Status."',(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 2:"})," Executes the PowerShell script to take the backup of the registry key and to remove the key.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 3:"})," Verifies the outcome of the PowerShell and proceeds accordingly.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 4:"}),' For success, it will set the script state as "Backed Up And Removed," and exit.',(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 5:"}),' For failure, it will set the script state as "Failed to Remove," and check whether ticket creation is enabled or not.',(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 6:"})," If ticket creation is enabled, it will look for the already existing ticket and add a comment to that; otherwise, it will create a ticket if the ticket does not exist.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 7:"})," Exit with success for success and exit with failure for any failures."]}),"\n",(0,i.jsx)(t.h3,{id:"for-restore",children:"For Restore."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Step 1:"}),' Clears the script state, "Search-MS Registry Status."',(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 2:"})," Executes the PowerShell script to restore the key.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 3:"})," Verifies the outcome of the PowerShell and proceeds accordingly.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 4:"}),' For success, it will set the script state as "Restored" and exit.',(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 5:"}),' For failure, it will set the script state as "Failed to Restore," and check whether ticket creation is enabled or not.',(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 6:"})," If ticket creation is enabled, it will look for the already existing ticket and add a comment to that; otherwise, it will create a ticket if the ticket does not exist.",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.strong,{children:"Step 7:"})," Exit with success for success and exit with failure for any failures."]}),"\n",(0,i.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Script log"}),"\n",(0,i.jsx)(t.li,{children:"Script state"}),"\n",(0,i.jsx)(t.li,{children:"Ticket"}),"\n",(0,i.jsx)(t.li,{children:"Dataview"}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},531688:(e,t,r)=>{r.d(t,{A:()=>s});const s=r.p+"assets/images/image_1-493ec9ca1fdb3fe4856d33310751e1a3.png"},393667:(e,t,r)=>{r.d(t,{A:()=>s});const s=r.p+"assets/images/image_2-87cce556f5e0bacfe760b628b528a203.png"},28453:(e,t,r)=>{r.d(t,{R:()=>a,x:()=>o});var s=r(296540);const i={},n=s.createContext(i);function a(e){const t=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);