"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[8431],{844251:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"vsa/procedures/d0694f70-303e-4518-b47c-a796ca73d905","title":"SQL","description":"This document provides a detailed guide on how to clear a specific patch from the Failed Patches list in Kaseya VSA using SQL queries. It includes steps for backing up the database, modifying the SQL query with the appropriate KB number, and executing the query on KSubscribers.","source":"@site/docs/vsa/procedures/SQL.md","sourceDirName":"vsa/procedures","slug":"/vsa/procedures/d0694f70-303e-4518-b47c-a796ca73d905","permalink":"/docs/vsa/procedures/d0694f70-303e-4518-b47c-a796ca73d905","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/vsa/procedures/SQL.md","tags":[{"inline":false,"label":"Backup","permalink":"/docs/tags/backup","description":"Documents detailing backup solutions and data protection strategies"},{"inline":false,"label":"Database","permalink":"/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"SQL","permalink":"/docs/tags/sql","description":"Documents discussing Structured Query Language and database interactions"},{"inline":false,"label":"Update","permalink":"/docs/tags/update","description":"Documents discussing software and system updates and their management"}],"version":"current","frontMatter":{"id":"d0694f70-303e-4518-b47c-a796ca73d905","title":"SQL","title_meta":"SQL","keywords":["patch","sql","kb","database","vsa"],"description":"This document provides a detailed guide on how to clear a specific patch from the Failed Patches list in Kaseya VSA using SQL queries. It includes steps for backing up the database, modifying the SQL query with the appropriate KB number, and executing the query on KSubscribers.","tags":["backup","database","sql","update"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"SNMP & Community Configuration","permalink":"/docs/vsa/procedures/975ed6e2-5fb1-49f5-808a-672a42ccd56b"},"next":{"title":"SQLHarvest","permalink":"/docs/vsa/procedures/cc9eea15-c829-44a4-b507-23efeb8dcaff"}}');var n=a(474848),i=a(28453);const r={id:"d0694f70-303e-4518-b47c-a796ca73d905",title:"SQL",title_meta:"SQL",keywords:["patch","sql","kb","database","vsa"],description:"This document provides a detailed guide on how to clear a specific patch from the Failed Patches list in Kaseya VSA using SQL queries. It includes steps for backing up the database, modifying the SQL query with the appropriate KB number, and executing the query on KSubscribers.",tags:["backup","database","sql","update"],draft:!1,unlisted:!1},d=void 0,c={},o=[{value:"Purpose",id:"purpose",level:2},{value:"Associated Content",id:"associated-content",level:2},{value:"Implementation",id:"implementation",level:2}];function l(e){const t={br:"br",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"purpose",children:"Purpose"}),"\n",(0,n.jsx)(t.p,{children:"This document allows you to clear a patch from the Failed Patches list with the help of SQL."}),"\n",(0,n.jsx)(t.h2,{id:"associated-content",children:"Associated Content"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:(0,n.jsx)(t.strong,{children:"Content"})}),(0,n.jsx)(t.th,{children:(0,n.jsx)(t.strong,{children:"Type"})}),(0,n.jsx)(t.th,{children:(0,n.jsx)(t.strong,{children:"Function"})})]})}),(0,n.jsx)(t.tbody,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"SQL - clearFailedPatchesByKB"}),(0,n.jsx)(t.td,{children:"SQL Query"}),(0,n.jsx)(t.td,{children:"Removes a specific patch from failed patches."})]})})]}),"\n",(0,n.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Take a Backup of the VSA Database."}),(0,n.jsx)(t.br,{}),"\n",(0,n.jsx)(t.img,{src:a(388058).A+"",width:"1000",height:"558"})]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Update the KB Number in the SQL Query Below."}),(0,n.jsx)(t.br,{}),"\n",(0,n.jsx)(t.img,{src:a(835350).A+"",width:"548",height:"503"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"-- clears \"failed\" patches on all agents for a specific KB article ID\r\nDECLARE @kbArticleId AS VARCHAR(10) = '5034441', -- enter KB article ID here\r\n@agentGuid AS NUMERIC(26)\r\n\r\nSELECT @agentGuid = MIN(agentguid)\r\nFROM patchStatus s\r\nJOIN patchData d ON s.patchDataId = d.patchDataId AND d.kbArticleId = @kbArticleId\r\nWHERE s.patchState = 0\r\nAND s.schedTogether IN (2,3,8)\r\n\r\nWHILE @agentGuid IS NOT NULL\r\nBEGIN\r\n    UPDATE patchStatus SET schedTogether = 0\r\n    FROM patchStatus s\r\n    JOIN patchData d ON s.patchDataId = d.patchDataId AND d.kbArticleId = @kbArticleId\r\n    WHERE patchState = 0\r\n    AND schedTogether IN (2,3,8)\r\n    AND agentGuid = @agentGuid\r\n\r\n    EXEC updatePatchStatusTotals @agentGuid\r\n\r\n    SELECT @agentGuid = MIN(agentguid)\r\n    FROM patchStatus s\r\n    JOIN patchData d ON s.patchDataId = d.patchDataId AND d.kbArticleId = @kbArticleId\r\n    WHERE s.patchState = 0\r\n    AND s.schedTogether IN (2,3,8)\r\nEND\n"})}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Run this Query on KSubscribers on SQL Server."}),(0,n.jsx)(t.br,{}),"\n",(0,n.jsx)(t.img,{src:a(248639).A+"",width:"1000",height:"555"})]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},388058:(e,t,a)=>{a.d(t,{A:()=>s});const s=a.p+"assets/images/image_1-e2eb97a6dfa6d17b247ce5687ef53516.png"},835350:(e,t,a)=>{a.d(t,{A:()=>s});const s=a.p+"assets/images/image_2-7ed2c320b6e62db22e4cc4177fbc4e08.png"},248639:(e,t,a)=>{a.d(t,{A:()=>s});const s=a.p+"assets/images/image_3-ab6482e71644b1cfa5d5d71581778bc0.png"},28453:(e,t,a)=>{a.d(t,{R:()=>r,x:()=>d});var s=a(296540);const n={},i=s.createContext(n);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);