"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[96682],{935242:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>i,contentTitle:()=>c,default:()=>S,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"cwa/monitors/95f64d6e-cb10-4c2c-9d40-c55941a7d7bc","title":"Windows Update Orchestrator","description":"This document outlines the steps to apply a remote monitor in ConnectWise Automate, including obtaining group IDs, running SQL queries, and setting up alerts for monitoring Windows Update Orchestrator services.","source":"@site/docs/cwa/monitors/Windows Update Orchestrator.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/95f64d6e-cb10-4c2c-9d40-c55941a7d7bc","permalink":"/docs/cwa/monitors/95f64d6e-cb10-4c2c-9d40-c55941a7d7bc","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/Windows Update Orchestrator.md","tags":[{"inline":false,"label":"Database","permalink":"/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"95f64d6e-cb10-4c2c-9d40-c55941a7d7bc","title":"Windows Update Orchestrator","title_meta":"Windows Update Orchestrator","keywords":["remote","monitor","sql","query","update","orchestrator"],"description":"This document outlines the steps to apply a remote monitor in ConnectWise Automate, including obtaining group IDs, running SQL queries, and setting up alerts for monitoring Windows Update Orchestrator services.","tags":["database","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Windows Server Backup Failure Detection","permalink":"/docs/cwa/monitors/ef03b1ec-11f8-438e-a21e-b4a2bdcd4c78"},"next":{"title":"Windows Update Report","permalink":"/docs/cwa/monitors/4a1b21f7-1b25-4640-9405-8c07277c54f0"}}');var o=t(474848),a=t(28453);const s={id:"95f64d6e-cb10-4c2c-9d40-c55941a7d7bc",title:"Windows Update Orchestrator",title_meta:"Windows Update Orchestrator",keywords:["remote","monitor","sql","query","update","orchestrator"],description:"This document outlines the steps to apply a remote monitor in ConnectWise Automate, including obtaining group IDs, running SQL queries, and setting up alerts for monitoring Windows Update Orchestrator services.",tags:["database","windows"],draft:!1,unlisted:!1},c=void 0,i={},d=[{value:"Steps to Apply Remote Monitor",id:"steps-to-apply-remote-monitor",level:2},{value:"1.",id:"1",level:3},{value:"2.",id:"2",level:3},{value:"3.",id:"3",level:3},{value:"4.",id:"4",level:3},{value:"5.",id:"5",level:3},{value:"6.",id:"6",level:3}];function R(e){const r={br:"br",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.h2,{id:"steps-to-apply-remote-monitor",children:"Steps to Apply Remote Monitor"}),"\n",(0,o.jsx)(r.h3,{id:"1",children:"1."}),"\n",(0,o.jsx)(r.p,{children:"Obtain the group ID(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"2",children:"2."}),"\n",(0,o.jsx)(r.p,{children:"Run this SQL query from a RAWSQL monitor set to import the required search:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"INSERT INTO `SensorChecks` (\r\n    `Name`, `SQL`, `QueryType`, `ListDATA`,\r\n    `FolderID`, `GUID`, `SearchXML`\r\n)\r\nSELECT\r\n    'Update Orchestrator - UsoSvc' AS `Name`,\r\n    'SELECT \\\\r\\\\n   computers.computerid as `Computer Id`,\\\\r\\\\n   computers.name as `Computer Name`,\\\\r\\\\n   clients.name as `Client Name`,\\\\r\\\\n   computers.domain as `Computer Domain`,\\\\r\\\\n   computers.username as `Computer User`,\\\\r\\\\n   Services.Name as `Computer.Services.Name`\\\\r\\\\nFROM Computers \\\\r\\\\nLEFT JOIN inv_operatingsystem ON (Computers.ComputerId=inv_operatingsystem.ComputerId)\\\\r\\\\nLEFT JOIN Clients ON (Computers.ClientId=Clients.ClientId)\\\\r\\\\nLEFT JOIN Locations ON (Computers.LocationId=Locations.LocationID)\\\\r\\\\nLEFT JOIN Services ON (services.ComputerId = Computers.ComputerId)\\\\r\\\\n WHERE \\\\r\\\\n((Services.Name = \\\\'UsoSvc\\\\'))\\\\r\\\\n' AS `SQL`,\r\n    '4' AS `QueryType`,\r\n    'Select||=||=||=|^Select|||||||^' AS `ListData`,\r\n    '0' AS `FolderID`,\r\n    '04a11d92-3269-4ab1-a634-43d405e37b8b' AS `GUID`,\r\n    '<LabTechAbstractSearch><asn><st>AndNode</st><cn><asn><st>ComparisonNode</st><lon>Computer.Services.Name</lon><lok>Computer.Services.Name</lok><lmo>Equals</lmo><dv>UsoSvc</dv><dk>UsoSvc</dk></asn></cn></asn></LabTechAbstractSearch>' AS `SearchXML`\r\nFROM\r\n    (\r\n        SELECT\r\n            MIN(computerid)\r\n        FROM\r\n            computers\r\n    ) a\r\nWHERE\r\n    (\r\n        SELECT\r\n            COUNT(*)\r\n        FROM\r\n            SensorChecks\r\n        WHERE\r\n            `GUID` = '04a11d92-3269-4ab1-a634-43d405e37b8b'\r\n    ) = 0;\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"3",children:"3."}),"\n",(0,o.jsxs)(r.p,{children:["Copy the following query and replace ",(0,o.jsx)(r.strong,{children:"YOUR COMMA SEPARATED LIST OF GROUPID(S)"})," with the Group ID(s) of the relevant groups:\r\n(The string to replace can be found at the very bottom of the query, right after ",(0,o.jsx)(r.strong,{children:"WHERE"}),")"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"SET @searchid = IFNULL(( SELECT MIN(SensID) From sensorchecks where `GUID` = '04a11d92-3269-4ab1-a634-43d405e37b8b' ), 0);\n"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"INSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n@Searchid as `SearchID`,\r\n'ProVal - Production - Update Orchestrator - Reboot Prevention [Change]' as `Name`,\r\n'6' as `CheckAction`,\r\n'0' as `AlertAction`,\r\n'Windows update Orchestrator Monitor - Failed - %ComputerName%~~~Successfully renamed the reboot file.!!!Windows update Orchestrator Monitor - Failed - %ComputerName%~~~The reboot file at \"C:\\\\Windows\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\UpdateOrchestrator\\\\reboot\" failed to be renamed. The update orchestrator uses this file; it should either be deleted or renamed to prevent the update orchestrator from restarting the computer at any moment.' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'600' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -ExecutionPolicy Bypass -Command \"$ConfirmPreference = \\\\'None\\\\'; if (( Get-Service -Name \\\\'UsoSvc\\\\' ).StartType -ne \\\\'Automatic\\\\' ) { Set-Service -Name \\\\'UsoSvc\\\\' -StartupType \\\\'Automatic\\\\'}; $RebootPath = \\\\\\\\\\\"$env:windir\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\UpdateOrchestrator\\\\reboot\\\\\\\\\\\"; $BakPath = \\\\\\\\\\\"$env:windir\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\UpdateOrchestrator\\\\reboot.bak\\\\\\\\\\\"; if (Test-Path $RebootPath) {Remove-Item -Path $BakPath -Force -ErrorAction SilentlyContinue; try {Move-Item -Path $RebootPath -Destination $BakPath -Force -Confirm:$False -ErrorAction Stop; }catch{return \\\\'Failed to rename the reboot file\\\\'}}\"' as `DataOut`,\r\n'9' as `Comparor`,\r\n'Failed to rename the reboot file' as `DataIn`,\r\n'' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'21' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Update Orchestrator - Reboot Prevention [Change]')\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"4",children:"4."}),"\n",(0,o.jsx)(r.p,{children:"An example of a query with a group ID:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"SET @searchid = IFNULL(( SELECT MIN(SensID) From sensorchecks where `GUID` = '04a11d92-3269-4ab1-a634-43d405e37b8b' ), 0);\n"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"INSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n@Searchid as `SearchID`,\r\n'ProVal - Production - Windows Update Orchestrator' as `Name`,\r\n'6' as `CheckAction`,\r\n'3' as `AlertAction`,\r\n'Windows update Orchestrator Monitor - Failed - %ComputerName%~~~Successfully renamed the reboot file.!!!Windows update Orchestrator Monitor - Failed - %ComputerName%~~~The reboot file at \"C:\\\\Windows\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\UpdateOrchestrator\\\\reboot\" failed to be renamed. The update orchestrator uses this file; it should either be deleted or renamed to prevent the update orchestrator from restarting the computer at any moment.' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'600' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -ExecutionPolicy Bypass -Command \"$ConfirmPreference = \\\\'None\\\\'; if (( Get-Service -Name \\\\'UsoSvc\\\\' ).StartType -ne \\\\'Automatic\\\\' ) { Set-Service -Name \\\\'UsoSvc\\\\' -StartupType \\\\'Automatic\\\\'}; $RebootPath = \\\\\\\\\\\"$env:windir\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\UpdateOrchestrator\\\\reboot\\\\\\\\\\\"; $BakPath = \\\\\\\\\\\"$env:windir\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\UpdateOrchestrator\\\\reboot.bak\\\\\\\\\\\"; if (Test-Path $RebootPath) {Remove-Item -Path $BakPath -Force -ErrorAction SilentlyContinue; try {Move-Item -Path $RebootPath -Destination $BakPath -Force -Confirm:$False -ErrorAction Stop; }catch{return \\\\'Failed to rename the reboot file\\\\'}}\"' as `DataOut`,\r\n'9' as `Comparor`,\r\n'Failed to rename the reboot file' as `DataIn`,\r\n'' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'21' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (2,3,855,856)\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Update Orchestrator - Reboot Prevention [Change]')\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"5",children:"5."}),"\n",(0,o.jsxs)(r.p,{children:["Now execute your query from a RAWSQL monitor set.",(0,o.jsx)(r.br,{}),"\n","Once the query is executed, reload the control center."]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"Control Center",src:t(647653).A+"",width:"309",height:"351"})}),"\n",(0,o.jsxs)(r.p,{children:["Then re-open the group where the monitor is created.",(0,o.jsx)(r.br,{}),"\n","The monitor will come up with the search ",(0,o.jsx)(r.code,{children:"Update Orchestrator - UsoSvc"})," added to the LIMIT."]}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"6",children:"6."}),"\n",(0,o.jsx)(r.p,{children:"Locate your remote monitor by opening the group(s) remote monitors tab, then apply the appropriate alert template."})]})}function S(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(R,{...e})}):R(e)}},647653:(e,r,t)=>{t.d(r,{A:()=>n});const n=t.p+"assets/images/image_1-5299c8ddfd764baa3fde4787aa31c5b8.png"},28453:(e,r,t)=>{t.d(r,{R:()=>s,x:()=>c});var n=t(296540);const o={},a=n.createContext(o);function s(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);