"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[45806],{943982:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"cwrmm/tasks/344a3ab5-d05c-41a5-9303-45fc387ec2e8","title":"CRI Agent Deployment","description":"This document outlines the steps to deploy the Cyrisma Censor Application using a custom task in ConnectWise Automate, including script implementation, scheduling, and logging.","source":"@site/docs/cwrmm/tasks/CRI Agent Deployment.md","sourceDirName":"cwrmm/tasks","slug":"/cwrmm/tasks/344a3ab5-d05c-41a5-9303-45fc387ec2e8","permalink":"/proval-docs/docs/cwrmm/tasks/344a3ab5-d05c-41a5-9303-45fc387ec2e8","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwrmm/tasks/CRI Agent Deployment.md","tags":[{"inline":false,"label":"Deployment","permalink":"/proval-docs/docs/tags/deployment","description":"Documents on deploying software and services in various environments"},{"inline":false,"label":"Installation","permalink":"/proval-docs/docs/tags/installation","description":"Documents on installing software and configuring systems"},{"inline":false,"label":"Windows","permalink":"/proval-docs/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"344a3ab5-d05c-41a5-9303-45fc387ec2e8","title":"CRI Agent Deployment","title_meta":"CRI Agent Deployment","keywords":["cyrisma","deployment","agent","installation","windows"],"description":"This document outlines the steps to deploy the Cyrisma Censor Application using a custom task in ConnectWise Automate, including script implementation, scheduling, and logging.","tags":["deployment","installation","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Bitlocker Recovery Password - AD Backup","permalink":"/proval-docs/docs/cwrmm/tasks/73dab29b-9bca-4840-bab9-309d604f56df"},"next":{"title":"CW RMM - Office Universal Uninstaller","permalink":"/proval-docs/docs/cwrmm/tasks/88ebc856-6e02-41d2-a6b5-af8cbd37e2c6"}}');var i=n(474848),a=n(28453);const c={id:"344a3ab5-d05c-41a5-9303-45fc387ec2e8",title:"CRI Agent Deployment",title_meta:"CRI Agent Deployment",keywords:["cyrisma","deployment","agent","installation","windows"],description:"This document outlines the steps to deploy the Cyrisma Censor Application using a custom task in ConnectWise Automate, including script implementation, scheduling, and logging.",tags:["deployment","installation","windows"],draft:!1,unlisted:!1},o=void 0,r={},l=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Create Task",id:"create-task",level:3},{value:"Script",id:"script",level:3},{value:"Row 1: Function: Set Pre-defined Variable",id:"row-1-function-set-pre-defined-variable",level:3},{value:"Row 2: Function: Set Pre-defined Variable",id:"row-2-function-set-pre-defined-variable",level:3},{value:"Row 3: Function: PowerShell Script",id:"row-3-function-powershell-script",level:3},{value:"Row 4: Function: Script Log",id:"row-4-function-script-log",level:3},{value:"Row 5: Logic: If/Then/Else",id:"row-5-logic-ifthenelse",level:3},{value:"Row 4a: Condition: Output Contains",id:"row-4a-condition-output-contains",level:3},{value:"Row 4b: Function: Set Custom Field",id:"row-4b-function-set-custom-field",level:3},{value:"Row 4c: Function: Set Custom Field",id:"row-4c-function-set-custom-field",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Output",id:"output",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(t.p,{children:"This task is designed to deploy the Cyrisma Censor Application."}),"\n",(0,i.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Sample Run 1",src:n(759141).A+"",width:"401",height:"272"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Sample Run 2",src:n(505134).A+"",width:"1000",height:"658"})}),"\n",(0,i.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,i.jsx)(t.h3,{id:"create-task",children:"Create Task"}),"\n",(0,i.jsx)(t.p,{children:'To implement this script, please create a new "PowerShell" style script in the system.'}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Create Task",src:n(934359).A+"",width:"384",height:"644"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Name:"})," CRI Agent Deployment"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Description:"})," This script installs the CRI Agent on the machines."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"OS Supported:"})," Windows"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Category:"})," Custom"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Task Details",src:n(201720).A+"",width:"632",height:"544"})}),"\n",(0,i.jsx)(t.h3,{id:"script",children:"Script"}),"\n",(0,i.jsx)(t.p,{children:'Start by creating three separate rows. You can do this by clicking the "Add Row" button at the bottom of the script page.'}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Add Row",src:n(422849).A+"",width:"475",height:"212"})}),"\n",(0,i.jsx)(t.h3,{id:"row-1-function-set-pre-defined-variable",children:"Row 1: Function: Set Pre-defined Variable"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 1 Image 1",src:n(392266).A+"",width:"1000",height:"139"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 1 Image 2",src:n(547475).A+"",width:"1000",height:"324"})}),"\n",(0,i.jsxs)(t.p,{children:["This sets the variable ",(0,i.jsx)(t.code,{children:"CryismaAgent_URL"})," with the value of a custom field 'CryismaAgent_URL' ",(0,i.jsx)(t.a,{href:"/proval-docs/docs/cwrmm/custom-fields/2d448750-129b-4cff-aaf1-e73d2a296418",children:"CW RMM - Cyrisma Custom Fields"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"row-2-function-set-pre-defined-variable",children:"Row 2: Function: Set Pre-defined Variable"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 2 Image 1",src:n(252180).A+"",width:"1000",height:"141"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 2 Image 2",src:n(168861).A+"",width:"1000",height:"337"})}),"\n",(0,i.jsxs)(t.p,{children:["This sets the variable ",(0,i.jsx)(t.code,{children:"CryismaAgent_Key"})," with the value of a custom field 'CryismaAgent_Key' ",(0,i.jsx)(t.a,{href:"/proval-docs/docs/cwrmm/custom-fields/2d448750-129b-4cff-aaf1-e73d2a296418",children:"CW RMM - Cyrisma Custom Fields"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"row-3-function-powershell-script",children:"Row 3: Function: PowerShell Script"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 3 Image 1",src:n(247809).A+"",width:"1000",height:"140"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 3 Image 2",src:n(26680).A+"",width:"1000",height:"624"})}),"\n",(0,i.jsxs)(t.p,{children:["Paste the following PowerShell script and set the expected time of script execution to ",(0,i.jsx)(t.code,{children:"1800"})," seconds."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"$InstallerCheck = Get-ChildItem -Path HKLM:/SOFTWARE/Microsoft/Windows/CurrentVersion/Uninstall, HKLM:/SOFTWARE/Wow6432Node/Microsoft/Windows/CurrentVersion/Uninstall | Get-ItemProperty | Where-Object { $_.DisplayName -match 'Cyrisma' } | Select-Object -ExpandProperty DisplayName\r\nif ($InstallerCheck) {\r\n    Write-Output 'The Cyrisma is already installed'\r\n} else {\r\n    $ProjectName = 'Cyrisma_Setup'\r\n    $EXEURL = 'https://dl.cyrisma.com/6167656E7473/Cyrisma_Setup.exe'\r\n    $WorkingDirectory = \"C:/ProgramData/_automation/app/$ProjectName\"\r\n    $EXEPath = \"$WorkingDirectory/$ProjectName.exe\"\r\n    if (!(Test-Path $WorkingDirectory)) {\r\n        try {\r\n            New-Item -Path $WorkingDirectory -ItemType Directory -Force -ErrorAction Stop | Out-Null\r\n        } catch {\r\n            throw \"Failed to Create $WorkingDirectory. Reason: $($Error[0].Exception.Message)\"\r\n        }\r\n    }\r\n    if (-not (((Get-Acl $WorkingDirectory).Access | Where-Object { $_.IdentityReference -Match 'Everyone' }).FileSystemRights -Match 'FullControl')) {\r\n        $ACl = Get-Acl $WorkingDirectory\r\n        $AccessRule = New-Object System.Security.AccessControl.FileSystemAccessRule('Everyone', 'FullControl', 'ContainerInherit, ObjectInherit', 'none', 'Allow')\r\n        $Acl.AddAccessRule($AccessRule)\r\n        Set-Acl $WorkingDirectory $Acl\r\n    }\r\n    Invoke-WebRequest -Uri $EXEURL -UseBasicParsing -OutFile $EXEPath\r\n    if (!(Test-Path -Path $EXEPath)) {\r\n        Write-Output \"No pre-downloaded app exists and the script $EXEURL failed to download. Exiting.\"\r\n        return 1\r\n    }\r\n    cmd.exe /c \"$ExePath /verysilent /key=@CRIAgent_Key@ /url=@CRIAgent_URL@\"\r\n    Start-Sleep -Seconds 180\r\n    $InstallerCheck = Get-ChildItem -Path HKLM:/SOFTWARE/Microsoft/Windows/CurrentVersion/Uninstall, HKLM:/SOFTWARE/Wow6432Node/Microsoft/Windows/CurrentVersion/Uninstall | Get-ItemProperty | Where-Object { $_.DisplayName -match 'Cyrisma' } | Select-Object -ExpandProperty DisplayName\r\n    if ($InstallerCheck) {\r\n        Write-Output 'The Cyrisma is installed successfully'\r\n    } else {\r\n        Write-Output 'The Cyrisma failed to deploy'\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(t.h3,{id:"row-4-function-script-log",children:"Row 4: Function: Script Log"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 4 Image",src:n(372435).A+"",width:"1000",height:"144"})}),"\n",(0,i.jsxs)(t.p,{children:["In the script log message, simply type ",(0,i.jsx)(t.code,{children:"%output%"})," so that the script will send the results of the PowerShell script above to the output on the Automation tab for the target device."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Log Output",src:n(217226).A+"",width:"338",height:"272"})}),"\n",(0,i.jsx)(t.h3,{id:"row-5-logic-ifthenelse",children:"Row 5: Logic: If/Then/Else"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 5 Image 1",src:n(584101).A+"",width:"501",height:"301"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Row 5 Image 2",src:n(17564).A+"",width:"909",height:"205"})}),"\n",(0,i.jsx)(t.h3,{id:"row-4a-condition-output-contains",children:"Row 4a: Condition: Output Contains"}),"\n",(0,i.jsxs)(t.p,{children:["In the IF part, enter ",(0,i.jsx)(t.code,{children:"Installation failed"}),' in the right box of the "Output Contains" section.']}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Condition Image",src:n(759319).A+"",width:"1000",height:"114"})}),"\n",(0,i.jsx)(t.h3,{id:"row-4b-function-set-custom-field",children:"Row 4b: Function: Set Custom Field"}),"\n",(0,i.jsx)(t.p,{children:"Add a new row by clicking on the Add Row button."}),"\n",(0,i.jsxs)(t.p,{children:["Select Function 'Set Custom Field'. When you select ",(0,i.jsx)(t.code,{children:"Set Custom Field"}),", it will open up a new window."]}),"\n",(0,i.jsxs)(t.p,{children:["In this window, search for the ",(0,i.jsx)(t.code,{children:"Cryisma_Status"})," field."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Custom Field:"})," Cryisma_Status"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Value:"})," Success"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Custom Field",src:n(330094).A+"",width:"724",height:"282"})}),"\n",(0,i.jsx)(t.h3,{id:"row-4c-function-set-custom-field",children:"Row 4c: Function: Set Custom Field"}),"\n",(0,i.jsx)(t.p,{children:"Add a new row by clicking on the Add Row button in the ELSE part and select the Script 'Set Custom Field' function again."}),"\n",(0,i.jsx)(t.p,{children:"In this one, set the Custom Field and Value as shown below."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Set Custom Field",src:n(145657).A+"",width:"414",height:"327"})}),"\n",(0,i.jsx)(t.p,{children:"Once all items are added, please save the task. The final task should look like the screenshot below."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Final Task Screenshot",src:n(139408).A+"",width:"1000",height:"636"})}),"\n",(0,i.jsx)(t.h2,{id:"deployment",children:"Deployment"}),"\n",(0,i.jsx)(t.p,{children:'It is suggested to run the Task every 2 hours against the group "Cyrisma Sensor Deployment".'}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Go to ",(0,i.jsx)(t.code,{children:"Automation"})," > ",(0,i.jsx)(t.code,{children:"Tasks."})]}),"\n",(0,i.jsxs)(t.li,{children:["Search for the ",(0,i.jsx)(t.code,{children:"CRI Agent Deployment"})," Task."]}),"\n",(0,i.jsx)(t.li,{children:"Select the concerned task."}),"\n",(0,i.jsxs)(t.li,{children:["Click on the ",(0,i.jsx)(t.code,{children:"Schedule"})," button to schedule the task/script."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"This screen will appear."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Schedule Screen",src:n(304236).A+"",width:"1000",height:"457"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Select the relevant time to run the script and click the Do not repeat button."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Select Time",src:n(387125).A+"",width:"1000",height:"381"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"A pop-up box will appear."}),"\n",(0,i.jsxs)(t.li,{children:["Change the number of hours to ",(0,i.jsx)(t.code,{children:"2"})," and click ",(0,i.jsx)(t.code,{children:"OK"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Change Hours",src:n(785022).A+"",width:"875",height:"440"})}),"\n",(0,i.jsxs)(t.p,{children:["Search for ",(0,i.jsx)(t.code,{children:"Cyrisma Sensor Deployment"})," in the ",(0,i.jsx)(t.code,{children:"Resources*"})," and select it. You can search and select any relevant group you would like to schedule the task against. If the site doesn't have a device group that includes all Windows agents, then create one and schedule the task on it."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Resources Selection",src:n(172711).A+"",width:"1000",height:"484"})}),"\n",(0,i.jsxs)(t.p,{children:["Now click the ",(0,i.jsx)(t.code,{children:"Run"})," button to initiate the task."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Run Task",src:n(897544).A+"",width:"1000",height:"372"})}),"\n",(0,i.jsx)(t.p,{children:"The task will start appearing in the Scheduled Tasks."}),"\n",(0,i.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Script log"}),"\n",(0,i.jsx)(t.li,{children:"Custom field"}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},759141:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_1-b22e0ba1280dd806d433166b868f9a4a.png"},247809:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_10-dc24ca511c3a463db969905b2db12c6f.png"},26680:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_11-cd6df16677e4cc0b9d4bdb5fbb689ccc.png"},372435:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_12-3bea2c2255dc3d9e86a7fab01f1eff2f.png"},217226:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_13-39c2357a125d769e7f35e934d2dd5e61.png"},584101:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_14-0ecc101bb89cb8cda6611dbc06c7e31d.png"},17564:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_15-0b1a4c39cc60d2f51e2e46662384c893.png"},759319:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_16-a810498600ff944b9c99d3159fb61cc7.png"},330094:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_17-e794e2bd27afc09db5442089c3523e05.png"},145657:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_18-5b6d18f2c9d242aa0608a4558765bea7.png"},139408:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_19-a15fd76516d0083b58ee1d03f14055a6.png"},505134:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_2-7a4b7f1c69bc92f0952d426e8a447ba0.png"},304236:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_20-1b062d1820bcb49e13398689b9f3c482.png"},387125:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_21-08485f7a145eeaa03b7235f316b41840.png"},785022:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_22-26ad07b13e96f7f7a7b4c434ff01140f.png"},172711:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_23-28db095fd116dc59e66aef33dff163f7.png"},897544:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_24-f73212f3f4e41da5ff7f0a081979fa10.png"},934359:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_3-50c2bf241a3ac8dc08079c68c51442fa.png"},201720:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_4-37ec487d65ebee55421ddcc2ff1cd737.png"},422849:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_5-e32fc53110844f5a76fb36ae7bc74477.png"},392266:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_6-0e2575d414bd37995013b188c3a2d186.png"},547475:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_7-ed0db9e1e417ae36126b259e7c120e22.png"},252180:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_8-f030d5a242b3fc61f73d8154d8b7d603.png"},168861:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/image_9-4f0e1c0a4afd072979de1ce1d09a216f.png"},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>o});var s=n(296540);const i={},a=s.createContext(i);function c(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);