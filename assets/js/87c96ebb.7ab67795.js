"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[32223],{288421:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"powershell/ps-remove-userprofile","title":"Remove-UserProfile","description":"Documentation for the Remove-UserProfile command to delete a user profile and remove the user account if local.","source":"@site/docs/powershell/Remove-UserProfile.md","sourceDirName":"powershell","slug":"/powershell/ps-remove-userprofile","permalink":"/docs/powershell/ps-remove-userprofile","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/powershell/Remove-UserProfile.md","tags":[{"inline":false,"label":"Security","permalink":"/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"ps-remove-userprofile","title":"Remove-UserProfile","title_meta":"Remove-UserProfile","keywords":["remove","user","profile","local"],"description":"Documentation for the Remove-UserProfile command to delete a user profile and remove the user account if local.","tags":["security","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Remove-Sophos","permalink":"/docs/powershell/ps-remove-sophos"},"next":{"title":"Remove-UserRegistryValue","permalink":"/docs/powershell/ps-remove-userregistryvalue"}}');var t=r(474848),i=r(28453);const l={id:"ps-remove-userprofile",title:"Remove-UserProfile",title_meta:"Remove-UserProfile",keywords:["remove","user","profile","local"],description:"Documentation for the Remove-UserProfile command to delete a user profile and remove the user account if local.",tags:["security","windows"],draft:!1,unlisted:!1},o=void 0,c={},d=[{value:"Description",id:"description",level:2},{value:"<strong>This script is destructive and should only be used after fully understanding the implications.</strong>",id:"this-script-is-destructive-and-should-only-be-used-after-fully-understanding-the-implications",level:4},{value:"Requirements",id:"requirements",level:2},{value:"Usage",id:"usage",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Output",id:"output",level:2}];function a(e){const s={code:"code",h2:"h2",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"description",children:"Description"}),"\n",(0,t.jsx)(s.h4,{id:"this-script-is-destructive-and-should-only-be-used-after-fully-understanding-the-implications",children:(0,t.jsx)(s.strong,{children:"This script is destructive and should only be used after fully understanding the implications."})}),"\n",(0,t.jsx)(s.p,{children:"Deletes a user profile and removes the user account if local."}),"\n",(0,t.jsx)(s.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsx)(s.p,{children:"PowerShell v5"}),"\n",(0,t.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Refactors the user account to ",(0,t.jsx)(s.code,{children:"computername\\\\username"})," if the account passed appears to be a local user (starts with ",(0,t.jsx)(s.code,{children:".\\\\"})," or has no ",(0,t.jsx)(s.code,{children:"\\\\"}),").","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"username"})," becomes ",(0,t.jsx)(s.code,{children:"computername\\\\username"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:".\\\\username"})," becomes ",(0,t.jsx)(s.code,{children:"computername\\\\username"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"domain\\\\username"})," remains as is."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"The account is checked for being a local user."}),"\n",(0,t.jsxs)(s.li,{children:["Attempts to convert the NT Account object of the passed user into a ",(0,t.jsx)(s.code,{children:"System.Security.Principal.SecurityIdentifier"}),".","\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["If the translation fails, then the user account does not exist, and orphaned profiles are searched for possible matches to the user account using the regex ",(0,t.jsx)(s.code,{children:"^$env:SystemDrive\\\\Users\\\\$Username($|(\\\\-|\\\\_)(\\\\w|\\\\-|\\\\.)+)$"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["If a matching profile is found where the SID is ",(0,t.jsx)(s.strong,{children:"not"})," a valid user account, then the script continues under the discovered SID's context."]}),"\n",(0,t.jsx)(s.li,{children:"If a matching profile is not found, then the script exits with an error."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"Profile information is gathered based on the user's SID."}),"\n",(0,t.jsxs)(s.li,{children:["If the user is a local user and the ",(0,t.jsx)(s.code,{children:"-PreserveUser"})," switch was not passed, then the user account is removed.","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"A non-terminating error will be generated if the user account cannot be removed."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["A ",(0,t.jsx)(s.code,{children:"Win32_UserProfile"})," CIM instance is generated for the user profile.","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"CIM Instance Found"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["The ",(0,t.jsx)(s.code,{children:"Remove-CIMInstance"})," cmdlet is run against the profile.","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"If the cmdlet fails, then an error message is generated, and the script exits."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"If the user folder was successfully removed, then the script exits."}),"\n",(0,t.jsx)(s.li,{children:"If the user folder still exists, then an error message is generated, and the script exits."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"CIM Instance Not Found"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["A ",(0,t.jsx)(s.code,{children:"Win32_UserProfile"})," WMI instance is generated for the user profile.","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"WMI Instance Found"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["The ",(0,t.jsx)(s.code,{children:"Remove-WMIObject"})," cmdlet is run against the profile.","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"If the cmdlet fails, then an error message is generated, and the script exits."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"If the user folder was successfully removed, then the script exits."}),"\n",(0,t.jsx)(s.li,{children:"If the user folder still exists, then an error message is generated, and the script exits."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"WMI Instance Not Found"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Ownership of the user folder is taken by the script caller."}),"\n",(0,t.jsx)(s.li,{children:"ACLs are set on the folder and all subfiles/subfolders to grant FullControl to the script caller."}),"\n",(0,t.jsxs)(s.li,{children:["The folder is then deleted by ",(0,t.jsx)(s.code,{children:"Remove-Item"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"If the user folder was successfully removed, then the script removes the associated registry entries and exits."}),"\n",(0,t.jsx)(s.li,{children:"If the user folder still exists, then an error message is generated, and the script exits."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Removes the user profile for the local user 'testing123' and deletes the user account."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-powershell",children:'.\\Remove-UserProfile.ps1 -Username "testing123"\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Removes the user profile for the local user 'testing123'. The user account will not be deleted due to the ",(0,t.jsx)(s.code,{children:"-PreserveUser"})," switch being present."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-powershell",children:'.\\Remove-UserProfile.ps1 -Username "testing123" -PreserveUser\n'})}),"\n",(0,t.jsx)(s.p,{children:"Removes the user profile for the user 'domain\\testing123'. The user account will not be deleted due to the account being a remote domain account."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-powershell",children:'.\\Remove-UserProfile.ps1 -Username "domain\\\\domainuser"\n'})}),"\n",(0,t.jsx)(s.h2,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Parameter"}),(0,t.jsx)(s.th,{children:"Alias"}),(0,t.jsx)(s.th,{children:"Required"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"-Username"})}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{children:"True"}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{children:"String"}),(0,t.jsx)(s.td,{children:"The username of the user to remove the profile for. Validated by the following regex: `^(((\\.\\\\)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"-PreserveUser"})}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{children:"False"}),(0,t.jsx)(s.td,{children:"False"}),(0,t.jsx)(s.td,{children:"Switch (bool)"}),(0,t.jsx)(s.td,{children:"Use this switch to preserve the user account after profile deletion."})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"output",children:"Output"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"./Remove-UserProfile-log.txt"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"./Remove-UserProfile-data.txt"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"./Remove-UserProfile-error.txt"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,s,r)=>{r.d(s,{R:()=>l,x:()=>o});var n=r(296540);const t={},i=n.createContext(t);function l(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);