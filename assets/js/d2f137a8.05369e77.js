"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[34239],{332174:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"cwa/monitors/d0b9c0fa-fe52-412b-a4b9-dee96f9ff58b","title":"Import- Time Sync Compliance","description":"This document outlines the steps required for creating a ticket in ConnectWise Automate, including necessary scripts, obtaining group IDs, and executing SQL queries for remote monitors.","source":"@site/docs/cwa/monitors/Import- Time Sync Compliance.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/d0b9c0fa-fe52-412b-a4b9-dee96f9ff58b","permalink":"/docs/cwa/monitors/d0b9c0fa-fe52-412b-a4b9-dee96f9ff58b","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/Import- Time Sync Compliance.md","tags":[{"inline":false,"label":"Database","permalink":"/docs/tags/database","description":"Documents related to database management systems and operations"}],"version":"current","frontMatter":{"id":"d0b9c0fa-fe52-412b-a4b9-dee96f9ff58b","title":"Import- Time Sync Compliance","title_meta":"Import- Time Sync Compliance","keywords":["ticket","creation","monitor","query","alert","template"],"description":"This document outlines the steps required for creating a ticket in ConnectWise Automate, including necessary scripts, obtaining group IDs, and executing SQL queries for remote monitors.","tags":["database"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Import- TLS Version Check - Server","permalink":"/docs/cwa/monitors/b08343d9-9d4b-4edd-92e2-5941c23d8e43"},"next":{"title":"Import- Unexpected Shutdown","permalink":"/docs/cwa/monitors/9bf4d628-655e-4568-bea6-dfd0544a1a56"}}');var o=r(474848),a=r(28453);const s={id:"d0b9c0fa-fe52-412b-a4b9-dee96f9ff58b",title:"Import- Time Sync Compliance",title_meta:"Import- Time Sync Compliance",keywords:["ticket","creation","monitor","query","alert","template"],description:"This document outlines the steps required for creating a ticket in ConnectWise Automate, including necessary scripts, obtaining group IDs, and executing SQL queries for remote monitors.",tags:["database"],draft:!1,unlisted:!1},i=void 0,c={},l=[{value:"Steps for Ticket Creation",id:"steps-for-ticket-creation",level:2},{value:"1.",id:"1",level:3},{value:"2.",id:"2",level:3},{value:"3.",id:"3",level:3},{value:"4.",id:"4",level:3},{value:"5.",id:"5",level:3},{value:"6.",id:"6",level:3}];function d(e){const t={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"steps-for-ticket-creation",children:"Steps for Ticket Creation"}),"\n",(0,o.jsx)(t.h3,{id:"1",children:"1."}),"\n",(0,o.jsxs)(t.p,{children:["Ensure the presence of the ",(0,o.jsx)(t.a,{href:"/docs/cwa/scripts/63beba3c-f4a6-41a5-98e2-d4e4ce885035",children:"CWM - Automate - Script - Ticket Creation - Computer"})," script and the ",(0,o.jsx)(t.code,{children:"\u25b3 Custom - Ticket Creation - Computer"})," alert template."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h3,{id:"2",children:"2."}),"\n",(0,o.jsx)(t.p,{children:"Obtain the group ID(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h3,{id:"3",children:"3."}),"\n",(0,o.jsxs)(t.p,{children:["Copy the following query and replace ",(0,o.jsx)(t.strong,{children:"YOUR COMMA SEPARATED LIST OF GROUPID(S)"})," with the group ID(s) of the relevant groups:",(0,o.jsx)(t.br,{}),"\n","(The string to replace can be found at the very bottom of the query, right after ",(0,o.jsx)(t.strong,{children:"WHERE"}),")"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sql",children:"INSERT INTO groupagents \r\n  SELECT '' as `AgentID`,\r\n  `groupid` as `GroupID`,\r\n  '0' as `SearchID`,\r\n  'ProVal - Production - Time Sync Compliance' as `Name`,\r\n  '6' as `CheckAction`,\r\n  '1' as `AlertAction`,\r\n  'Time Sync Compliance Failed - %ComputerName%~~~Successfully synced time.!!!Time Sync Compliance Failed - %ComputerName%~~~Time Sync Compliance failed for %ComputerName%. \\r\\n\\r\\nReason: \\r\\n%RESULT%' as `AlertMessage`,\r\n  '0' as `ContactID`,\r\n  '86400' as `interval`,\r\n  '127.0.0.1' as `Where`,\r\n  '7' as `What`,\r\n  'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -ExecutionPolicy Bypass -Command \"$S = \\'W32Time\\';$peerList = \\'us.pool.ntp.org\\';$syncOutput = \\'\\';if ((Get-Service $S).Status -ne \\'Running\\') {Try {Start-Service $S -Confirm:$False -ErrorAction Stop | Out-Null}catch {return \\\\\"Failed to start $S Service. Reason: $($Error.Exception.Message)\\\\\"}};$syncOutput += w32tm /config /manualpeerlist:$peerList;Start-Sleep -Seconds 5;$syncOutput += \\\\\"`n\\\\\" + (W32tm /resync /force);if ($syncOutput -match \\'The computer did not resync\\') {return \\'Failed: The computer did not resync.\\'} else {return \\'Success: The computer resynced successfully.\\'}\"' as `DataOut`,\r\n  '11' as `Comparor`,\r\n  '(The Computer did not resync)|(Failed to start)' as `DataIn`,\r\n  '' as `IDField`,\r\n  '1' as `AlertStyle`,\r\n  '0' as `ScriptID`,\r\n  '' as `datacollector`,\r\n  '21' as `Category`,\r\n  '0' as `TicketCategory`,\r\n  '1' as `ScriptTarget`,\r\n  UUID() as `GUID`,\r\n  'root' as `UpdatedBy`,\r\n  (NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Time Sync Compliance')\n"})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h3,{id:"4",children:"4."}),"\n",(0,o.jsx)(t.p,{children:"An example of a query with a group ID:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-sql",children:"INSERT INTO groupagents \r\n  SELECT '' as `AgentID`,\r\n  `groupid` as `GroupID`,\r\n  '0' as `SearchID`,\r\n  'ProVal - Production - Time Sync Compliance' as `Name`,\r\n  '6' as `CheckAction`,\r\n  '1' as `AlertAction`,\r\n  'Time Sync Compliance Failed - %ComputerName%~~~Successfully synced time.!!!Time Sync Compliance Failed - %ComputerName%~~~Time Sync Compliance failed for %ComputerName%. \\r\\n\\r\\nReason: \\r\\n%RESULT%' as `AlertMessage`,\r\n  '0' as `ContactID`,\r\n  '86400' as `interval`,\r\n  '127.0.0.1' as `Where`,\r\n  '7' as `What`,\r\n  'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -ExecutionPolicy Bypass -Command \"$S = \\'W32Time\\';$peerList = \\'us.pool.ntp.org\\';$syncOutput = \\'\\';if ((Get-Service $S).Status -ne \\'Running\\') {Try {Start-Service $S -Confirm:$False -ErrorAction Stop | Out-Null}catch {return \\\\\"Failed to start $S Service. Reason: $($Error.Exception.Message)\\\\\"}};$syncOutput += w32tm /config /manualpeerlist:$peerList;Start-Sleep -Seconds 5;$syncOutput += \\\\\"`n\\\\\" + (W32tm /resync /force);if ($syncOutput -match \\'The computer did not resync\\') {return \\'Failed: The computer did not resync.\\'} else {return \\'Success: The computer resynced successfully.\\'}\"' as `DataOut`,\r\n  '11' as `Comparor`,\r\n  '(The Computer did not resync)|(Failed to start)' as `DataIn`,\r\n  '' as `IDField`,\r\n  '1' as `AlertStyle`,\r\n  '0' as `ScriptID`,\r\n  '' as `datacollector`,\r\n  '21' as `Category`,\r\n  '0' as `TicketCategory`,\r\n  '1' as `ScriptTarget`,\r\n  UUID() as `GUID`,\r\n  'root' as `UpdatedBy`,\r\n  (NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (1622)\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Time Sync Compliance')\n"})}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h3,{id:"5",children:"5."}),"\n",(0,o.jsx)(t.p,{children:"Now execute your query from a RAWSQL monitor set."}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h3,{id:"6",children:"6."}),"\n",(0,o.jsxs)(t.p,{children:["Locate your remote monitor by opening the group(s) remote monitors tab, then apply the ",(0,o.jsx)(t.code,{children:"\u25b3 Custom - Ticket Creation - Computer"})," alert template."]})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>i});var n=r(296540);const o={},a=n.createContext(o);function s(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);