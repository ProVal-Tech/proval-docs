"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[77781],{763358:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"cwa/monitors/3ccd3348-558b-41c3-8a81-c65fae2cf04e","title":"CWAFileService - Invalid Token","description":"This document outlines a remote monitor that restarts the CWAFileService on the Automate server when it detects an invalid authorization token in the service logs. The monitor checks for specific error messages within the last 15 minutes and triggers a service restart if necessary.","source":"@site/docs/cwa/monitors/CWAFileService - Invalid Token.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/3ccd3348-558b-41c3-8a81-c65fae2cf04e","permalink":"/proval-docs/docs/cwa/monitors/3ccd3348-558b-41c3-8a81-c65fae2cf04e","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/CWAFileService - Invalid Token.md","tags":[],"version":"current","frontMatter":{"id":"3ccd3348-558b-41c3-8a81-c65fae2cf04e","title":"CWAFileService - Invalid Token","title_meta":"CWAFileService - Invalid Token","keywords":["restart","service","authorization","token","monitor"],"description":"This document outlines a remote monitor that restarts the CWAFileService on the Automate server when it detects an invalid authorization token in the service logs. The monitor checks for specific error messages within the last 15 minutes and triggers a service restart if necessary.","tags":[],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"CWA Solution - Windows Server Backup","permalink":"/proval-docs/docs/cwa/monitors/03510207-4f32-44b9-960d-9cad25932e6b"},"next":{"title":"CWM - Automate - Automate - Unsynced Ticket Content","permalink":"/proval-docs/docs/cwa/monitors/6a855fe6-df02-4668-81c3-8cd392595c31"}}');var r=i(474848),s=i(28453);const o={id:"3ccd3348-558b-41c3-8a81-c65fae2cf04e",title:"CWAFileService - Invalid Token",title_meta:"CWAFileService - Invalid Token",keywords:["restart","service","authorization","token","monitor"],description:"This document outlines a remote monitor that restarts the CWAFileService on the Automate server when it detects an invalid authorization token in the service logs. The monitor checks for specific error messages within the last 15 minutes and triggers a service restart if necessary.",tags:[],draft:!1,unlisted:!1},c=void 0,a={},l=[{value:"Summary",id:"summary",level:2},{value:"Details",id:"details",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Target",id:"target",level:2},{value:"Ticketing",id:"ticketing",level:2},{value:"Implementation",id:"implementation",level:2}];function d(e){const t={a:"a",br:"br",h2:"h2",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(t.p,{children:"This remote monitor restarts the service 'CWAFileService' on the Automate server if it detects the file 'C:/Windows/Temp/FileService.log' containing the message 'HttpRequest is missing or has invalid Authorization Token' within the last 15 minutes."}),"\n",(0,r.jsxs)(t.p,{children:["The actual message template is:",(0,r.jsx)(t.br,{}),"\n","FileService v24.0 - 3/10/2024 3:08:12 PM - HttpRequest is missing or has invalid Authorization Token:::"]}),"\n",(0,r.jsx)(t.h2,{id:"details",children:"Details"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Check Action"}),(0,r.jsx)(t.th,{children:"Server Address"}),(0,r.jsx)(t.th,{children:"Check Type"}),(0,r.jsx)(t.th,{children:"Check Value"}),(0,r.jsx)(t.th,{children:"Comparator"}),(0,r.jsx)(t.th,{children:"Interval"}),(0,r.jsx)(t.th,{children:"Result"})]})}),(0,r.jsx)(t.tbody,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"System"}),(0,r.jsx)(t.td,{children:"127.0.0.1"}),(0,r.jsx)(t.td,{children:"Run File"}),(0,r.jsx)(t.td,{children:"C:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe -ExecutionPolicy Bypass -Command \"$threshold = 20;$path = 'C:/Windows/Temp/FileService.log' ;if ( Test-Path $path ) { $content = foreach ( $line in $(Get-Content -path $path"}),(0,r.jsx)(t.td,{children:"Where-Object { $_ -match 'HttpRequest is missing or has invalid Authorization Token' } ) ) { $line };$problems = foreach ($err in $content ) { if ( $err -match '- (([0-9]{1,2}///){2}[0-9]{4} ([0-9]{1,2}:){2}[0-9]{1,2} [AP]M) -' ){ if ([DateTime]$matches[1] -ge (Get-Date).AddMinutes(-15)) {$err} } }if ( $problems.count -ge $threshold ) { Restart-Service -Name 'CWAFileService' -Force -ErrorAction SilentlyContinue -WarningAction SilentlyContinue; return $problems.count} }\""}),(0,r.jsx)(t.td,{children:"Missing"}),(0,r.jsx)(t.td,{children:"900"})]})})]}),"\n",(0,r.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsx)(t.p,{children:"On-Premises client"}),"\n",(0,r.jsx)(t.h2,{id:"target",children:"Target"}),"\n",(0,r.jsx)(t.p,{children:"Labtech Server Group"}),"\n",(0,r.jsx)(t.h2,{id:"ticketing",children:"Ticketing"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Subject"}),(0,r.jsx)(t.br,{}),"\n","CWA - Invalid Authorization Token - %Computername%"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Body"}),(0,r.jsx)(t.br,{}),"\n","The %computername% (Automate) Server is currently reporting %result% occurrences of an Invalid Token Authorization error within the logs C:/Windows/Temp/FileService.log. Typically, restarting the CWAFileService resolves this, but we have attempted to restart the service 4 times, and the errors persist after every restart."]}),"\n",(0,r.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsx)(t.p,{children:"Follow the article below:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/proval-docs/docs/cwa/monitors/3ccd3348-558b-41c3-8a81-c65fae2cf04e",children:"Import - Remote Monitors - CWAFileService - Invalid Token"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>o,x:()=>c});var n=i(296540);const r={},s=n.createContext(r);function o(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);