"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[72522],{608220:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"solutions/5d7a5b18-9aa8-4892-b70a-908dcfbe0fa2","title":"AD Plugin Bug (Dirty Tables)","description":"This document provides a temporary workaround for a bug in the CWA Active Directory plugin, which fails to remove deleted user and computer entries from its tables. It outlines the necessary steps to schedule scripts to maintain accurate data in the plugin until the issue is resolved by ConnectWise.","source":"@site/docs/solutions/AD Plugin Bug (Dirty Tables).md","sourceDirName":"solutions","slug":"/solutions/5d7a5b18-9aa8-4892-b70a-908dcfbe0fa2","permalink":"/proval-docs/docs/solutions/5d7a5b18-9aa8-4892-b70a-908dcfbe0fa2","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/solutions/AD Plugin Bug (Dirty Tables).md","tags":[{"inline":false,"label":"Active Directory","permalink":"/proval-docs/docs/tags/active-directory","description":"Documents related to Active Directory services and management"},{"inline":false,"label":"Cleanup","permalink":"/proval-docs/docs/tags/cleanup","description":"Documents on system cleanup processes and tools to free up resources"},{"inline":false,"label":"ConnectWise","permalink":"/proval-docs/docs/tags/connectwise","description":"Documents on ConnectWise platforms for IT service management"}],"version":"current","frontMatter":{"id":"5d7a5b18-9aa8-4892-b70a-908dcfbe0fa2","title":"AD Plugin Bug (Dirty Tables)","title_meta":"AD Plugin Bug (Dirty Tables)","keywords":["cwa","active-directory","plugin","cleanup","workaround"],"description":"This document provides a temporary workaround for a bug in the CWA Active Directory plugin, which fails to remove deleted user and computer entries from its tables. It outlines the necessary steps to schedule scripts to maintain accurate data in the plugin until the issue is resolved by ConnectWise.","tags":["active-directory","cleanup","connectwise"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Solution Documentation","permalink":"/proval-docs/docs/solutions/"},"next":{"title":"Active Directory & Domain Environment Audit","permalink":"/proval-docs/docs/solutions/dd914cae-33e3-4ac2-8904-c9ef1f4814a3"}}');var i=n(474848),s=n(28453);const a={id:"5d7a5b18-9aa8-4892-b70a-908dcfbe0fa2",title:"AD Plugin Bug (Dirty Tables)",title_meta:"AD Plugin Bug (Dirty Tables)",keywords:["cwa","active-directory","plugin","cleanup","workaround"],description:"This document provides a temporary workaround for a bug in the CWA Active Directory plugin, which fails to remove deleted user and computer entries from its tables. It outlines the necessary steps to schedule scripts to maintain accurate data in the plugin until the issue is resolved by ConnectWise.",tags:["active-directory","cleanup","connectwise"],draft:!1,unlisted:!1},o=void 0,c={},l=[{value:"Purpose",id:"purpose",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Associated Content",id:"associated-content",level:2},{value:"Implementation",id:"implementation",level:2},{value:"FAQ",id:"faq",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"purpose",children:"Purpose"}),"\n",(0,i.jsx)(t.p,{children:"A bug exists in the CWA Active Directory plugin where removed user and computer entries are not deleted from the plugin tables. This leads to tables being inflated with inaccurate data. This solution is a temporary workaround until ConnectWise resolves the issue."}),"\n",(0,i.jsxs)(t.p,{children:["The script ",(0,i.jsx)(t.a,{href:"/proval-docs/docs/cwa/scripts/fc26cfc8-33ff-405d-ba3a-bfad02637607",children:"CWM - Automate - Clean up AD plugin"})," should be scheduled to run once per day as a client script. The 'Run Full Active Directory Sync' script should be executed immediately against all \"Infrastructure Master\" AD domain controllers following the run of ",(0,i.jsx)(t.a,{href:"/proval-docs/docs/cwa/scripts/fc26cfc8-33ff-405d-ba3a-bfad02637607",children:"CWM - Automate - Clean up AD plugin"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The AD plugin must be up to date."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"associated-content",children:"Associated Content"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Content"}),(0,i.jsx)(t.th,{children:"Type"}),(0,i.jsx)(t.th,{children:"Function"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"/proval-docs/docs/cwa/scripts/fc26cfc8-33ff-405d-ba3a-bfad02637607",children:"CWM - Automate - Clean up AD plugin"})}),(0,i.jsx)(t.td,{children:"Script"}),(0,i.jsx)(t.td,{children:"Removes all rows from the following tables:  - plugin_ad_computers  - plugin_ad_memberofxrefs  - plugin_ad_userproxyaddresses  - plugin_ad_users. Removes all rows with ObjectType 1 or 2 from plugin_ad_entries."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Run Full Active Directory Sync"}),(0,i.jsx)(t.td,{children:"Built-in Script from ConnectWise relating to their AD plugin."}),(0,i.jsx)(t.td,{children:"This is the built-in script that initiates the syncing of data from Active Directory to Automate."})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Ensure you have imported the Clean up AD plugin Script into the environment."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Schedule the Run Full Active Directory Sync Script to run on the Managed 24x7 and the Managed 8x5 groups starting at 4:30 AM the next morning."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"SET @SearchID = (SELECT SensID FROM sensorchecks WHERE NAME = 'Server Role - AD - Infrastructure Master');\r\nSET @RFADSID = (SELECT ScriptID FROM lt_scripts WHERE SCRIPTNAME = 'Run Full Active Directory Sync');\r\nSET @MTFSGID = (SELECT GroupID FROM mastergroups WHERE FullName = 'Service [Plans.Windows](http://plans.Windows) Servers.Managed 24x7');\r\nSET @MESGID = (SELECT GroupID FROM mastergroups WHERE FullName = 'Service [Plans.Windows](http://plans.Windows) Servers.Managed 8x5');\r\nSET @TOMORROW = (SELECT STR_TO_Date(CONCAT(DATE(NOW() + INTERVAL 1 DAY),' 04:30:00'), '%Y-%m-%d %H:%i:%S')); \r\nINSERT INTO groupscripts ( `GroupID`, `ScriptID`, `ScriptType`, `RunTime`, `Repeat`, `SearchID`, `Parameters`, `GroupScriptGuid`, `IncludeSubGroups`, `DistributionWindowType`, `DistributionWindowAmount`, `ScheduleType`, `Interval`, `ScheduleWeekofMonth`, `ScheduleDayofWeek`, `RepeatType`, `RepeatAmount`, `RepeatStopAfter`, `SkipOffline`, `OfflineOnly`, `WakeOffline`, `WakeScript`, `DisableTimeZone`, `RunScriptOnProbe`, `Priority`, `Last_User`, `Last_Date`, `EffectiveStartDate` )\r\nVALUES \r\n( @MESGID, @RFADSID, 0, @TOMORROW, 0, @SearchID, '', '82d3a076-b83b-4fcf-ac76-5b2e05034a4c', 1, 2, 0, 4, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 11, 'root@localhost', NOW(), NOW() ),\r\n( @MTFSGID, @RFADSID, 0, @TOMORROW, 0, @SearchID, '', '82d3a076-b83b-4fcf-ac76-5b2e05034a4c', 1, 2, 0, 4, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 11, 'root@localhost', NOW(), NOW() );\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Schedule the Clean up AD plugin Script to run as a client script with no designated client at 4:10 AM starting the next morning."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"SET @TOMORROW = (SELECT STR_TO_Date(CONCAT(DATE(NOW() + INTERVAL 1 DAY), ' 04:10:00'), '%Y-%m-%d %H:%i:%S'));\r\nSET @RFADSID = (SELECT ScriptID FROM lt_scripts WHERE SCRIPTNAME = 'Clean up AD plugin');\r\nSET @FTD = (SELECT DATE_ADD(CURDATE(), INTERVAL 1 DAY));\r\n\r\nINSERT INTO groupscripts ( `GroupID`, `ScriptID`, `ScriptType`, `RunTime`, `Repeat`, `SearchID`, `Parameters`, `GroupScriptGuid`, `IncludeSubGroups`, `DistributionWindowType`, `DistributionWindowAmount`, `ScheduleType`, `Interval`, `ScheduleWeekofMonth`, `ScheduleDayofWeek`, `RepeatType`, `RepeatAmount`, `RepeatStopAfter`, `SkipOffline`, `OfflineOnly`, `WakeOffline`, `WakeScript`, `DisableTimeZone`, `RunScriptOnProbe`, `Priority`, `Last_User`, `Last_Date`, `EffectiveStartDate` )\r\nVALUES \r\n( 0, @RFADSID, 0, @TOMORROW, 0, 0, '', '82d3a076-b83b-4fcf-ac76-5b2e05034a4d', 1, 2, 0, 4, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 11, 'root@localhost', NOW(), NOW() );\r\n\r\nINSERT INTO scheduledscripts ( `ScriptID`, `NextRun`, `Interval`,  `Repeat`,  `Last_User`,  `Last_Date`,  `Exclusions`,  `Parameters`,  `Priority`,  `IncludeSubGroups`, `SearchID`,  `GroupScriptID`,  `Disabled`,  `EffectiveStartDate`,  `EffectiveOccurrences`,  `DistributionWindowType`,  `DistributionWindowAmount`,  `ScheduleType`,  `ScheduleWeekofMonth`,  `ScheduleDayofWeek`,  `RepeatType`,  `RepeatAmount`,  `RepeatStopAfter`,  `SkipOffline`,  `OfflineOnly`,  `WakeOffline`,\r\n    `WakeScript`,\r\n    `DisableTimeZone`,\r\n    `RunScriptOnProbe`,\r\n    `TimeZoneAdd`,\r\n    `Occurrences`,\r\n    `LastSchedule`\r\n) VALUES (\r\n    @RFADSID,\r\n    @TOMORROW,\r\n    1,\r\n    0,\r\n    'root@localhost',\r\n    NOW(),\r\n    '',\r\n    '',\r\n    11,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    @FTD,\r\n    0,\r\n    2,\r\n    0,\r\n    4,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    0.0,\r\n    0,\r\n    NOW()\r\n);\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"No FAQs available at this time."})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var r=n(296540);const i={},s=r.createContext(i);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);