"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[2608],{374378:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"cwa/scripts/ba82a707-a466-4960-95a9-856d5b67b8ed","title":"CWM - Automate - Script -Automate Agent - InstallRepair - For GPO Globals","description":"This document outlines a PowerShell script designed for creating and managing the Automate agent deployment via Group Policy Objects (GPO). It includes steps for installation, repair, and replacement of the agent, ensuring that it remains up-to-date with a new Installation Token. The guide targets Domain Controllers and provides detailed implementation steps, variable definitions, and expected outputs.","source":"@site/docs/cwa/scripts/CWM - Automate - Script -Automate Agent - InstallRepair - For GPO Globals.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/ba82a707-a466-4960-95a9-856d5b67b8ed","permalink":"/docs/cwa/scripts/ba82a707-a466-4960-95a9-856d5b67b8ed","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/CWM - Automate - Script -Automate Agent - InstallRepair - For GPO Globals.md","tags":[{"inline":false,"label":"Deployment","permalink":"/docs/tags/deployment","description":"Documents on deploying software and services in various environments"},{"inline":false,"label":"GPO","permalink":"/docs/tags/gpo","description":"Documents covering Group Policy Objects management and deployment"},{"inline":false,"label":"Installation","permalink":"/docs/tags/installation","description":"Documents on installing software and configuring systems"}],"version":"current","frontMatter":{"id":"ba82a707-a466-4960-95a9-856d5b67b8ed","title":"CWM - Automate - Script -Automate Agent - InstallRepair - For GPO Globals","title_meta":"CWM - Automate - Script -Automate Agent - InstallRepair - For GPO Globals","keywords":["automate","gpo","agent","installation","deployment","token","script"],"description":"This document outlines a PowerShell script designed for creating and managing the Automate agent deployment via Group Policy Objects (GPO). It includes steps for installation, repair, and replacement of the agent, ensuring that it remains up-to-date with a new Installation Token. The guide targets Domain Controllers and provides detailed implementation steps, variable definitions, and expected outputs.","tags":["deployment","gpo","installation"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"CWM - Automate - Script - Auto AAD to Autopilot - Client Specific (IT Synergy)","permalink":"/docs/cwa/scripts/aeaaded2-8468-4c74-8f46-b6e301dca26a"},"next":{"title":"CWM - Automate - Script-  GIS Deed Maintenance","permalink":"/docs/cwa/scripts/e2e93a31-645d-45d7-8616-ed4df6957710"}}');var a=n(474848),s=n(28453);const r={id:"ba82a707-a466-4960-95a9-856d5b67b8ed",title:"CWM - Automate - Script -Automate Agent - InstallRepair - For GPO Globals",title_meta:"CWM - Automate - Script -Automate Agent - InstallRepair - For GPO Globals",keywords:["automate","gpo","agent","installation","deployment","token","script"],description:"This document outlines a PowerShell script designed for creating and managing the Automate agent deployment via Group Policy Objects (GPO). It includes steps for installation, repair, and replacement of the agent, ensuring that it remains up-to-date with a new Installation Token. The guide targets Domain Controllers and provides detailed implementation steps, variable definitions, and expected outputs.",tags:["deployment","gpo","installation"],draft:!1,unlisted:!1},l=void 0,o={},d=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Variables",id:"variables",level:2},{value:"Global Parameters",id:"global-parameters",level:4},{value:"Script States",id:"script-states",level:4},{value:"Process",id:"process",level:2},{value:"Output",id:"output",level:2},{value:"Creating Automate Agent Deployment GPO",id:"creating-automate-agent-deployment-gpo",level:2}];function c(e){const t={code:"code",h2:"h2",h4:"h4",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(t.p,{children:"The purpose of this script is to create a PowerShell script to be used along with the Automate agent deployment GPO. It will also keep the PowerShell script up-to-date with a new Installation Token."}),"\n",(0,a.jsx)(t.p,{children:"The generated PowerShell script will install the agent if it is missing, attempt to repair the agent if it is broken, and rip and replace the agent if another MSP's agent is installed."}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Intended Target:"})," Domain Controllers with Automate agent deployment GPO"]}),"\n",(0,a.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Sample Run",src:n(77820).A+"",width:"482",height:"354"})}),"\n",(0,a.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Step 1:"}),' Create a computer-level EDF "Automate Agent Deployment GPO Enabled."']}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Step 1",src:n(666551).A+"",width:"626",height:"746"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Step 2:"})," Create an Auto-Join Group for the machines where the EDF is checked."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Step 3:"})," Schedule the script to run once per day against the group."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Step 3",src:n(192910).A+"",width:"1000",height:"555"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Step 4:"})," Mark the EDF of the Domain Controllers where you would like to create the Agent Deployment GPO."]}),"\n",(0,a.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Name"}),(0,a.jsx)(t.th,{children:"Description"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"TargetLocationID"}),(0,a.jsx)(t.td,{children:"Location ID to create the Installer Token for. Will use the location ID of the computer."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"ValidityPeriod"}),(0,a.jsx)(t.td,{children:"Age limit for the Installer. 1 Day"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"InstallerTypeID"}),(0,a.jsx)(t.td,{children:"ID of the installer type. 1 represents an .msi agent installer"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"TokenReason"}),(0,a.jsx)(t.td,{children:"Reason behind creating the installer token."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"TokenIngredients"}),(0,a.jsx)(t.td,{children:"Required variables/values to create the Agent token."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"VerificationKey"}),(0,a.jsx)(t.td,{children:"Verification Key for the Agent Installer Token."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"OutCome"}),(0,a.jsx)(t.td,{children:"Output of the PowerShell script used to write/modify the agent installation ps1 file."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"InstallerToken"}),(0,a.jsx)(t.td,{children:"Installer Token generated to be used with the agent reinstall command."})]})]})]}),"\n",(0,a.jsx)(t.h4,{id:"global-parameters",children:"Global Parameters"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Name"}),(0,a.jsx)(t.th,{children:"Example"}),(0,a.jsx)(t.th,{children:"Required"}),(0,a.jsx)(t.th,{children:"Description"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Directory"}),(0,a.jsx)(t.td,{children:"C:/ProgramData/_Automation/Automate Agent"}),(0,a.jsx)(t.td,{children:"True"}),(0,a.jsx)(t.td,{children:"Path to create the .ps1 script"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"FileName"}),(0,a.jsx)(t.td,{children:"Redo-Agent.ps1"}),(0,a.jsx)(t.td,{children:"True"}),(0,a.jsx)(t.td,{children:"Name of the .ps1 script"})]})]})]}),"\n",(0,a.jsx)(t.h4,{id:"script-states",children:"Script States"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Name"}),(0,a.jsx)(t.th,{children:"Example"}),(0,a.jsx)(t.th,{children:"Description"})]})}),(0,a.jsx)(t.tbody,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"GPO Agent Token"}),(0,a.jsx)(t.td,{children:"f9e7246ae89145e98cd8376d93e247aa"}),(0,a.jsx)(t.td,{children:"Used to store the currently generated agent token, so that it can be removed before generating another token"})]})})]}),"\n",(0,a.jsx)(t.h2,{id:"process",children:"Process"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Remove the previously generated token for the computer from the ",(0,a.jsx)(t.code,{children:"installertokens"})," table."]}),"\n",(0,a.jsx)(t.li,{children:"Clear the 'GPO Agent Token' script state."}),"\n",(0,a.jsxs)(t.li,{children:["Create the ",(0,a.jsx)(t.code,{children:"@Directory@"})," if it does not exist."]}),"\n",(0,a.jsx)(t.li,{children:"Generate an Agent Installer Token."}),"\n",(0,a.jsx)(t.li,{children:"Store the token to the Script State."}),"\n",(0,a.jsx)(t.li,{children:"Generate the PowerShell script on the computer."}),"\n",(0,a.jsxs)(t.li,{children:["Verify the presence of the ",(0,a.jsx)(t.code,{children:"@InstallerToken@"})," in the script."]}),"\n",(0,a.jsx)(t.li,{children:"Log the outcome."}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Script State"}),"\n",(0,a.jsx)(t.li,{children:"Script Log"}),"\n",(0,a.jsx)(t.li,{children:"Local File on the computer (C:/ProgramData/_Automation/Automate Agent/Redo-Agent.ps1)"}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"creating-automate-agent-deployment-gpo",children:"Creating Automate Agent Deployment GPO"}),"\n",(0,a.jsx)("iframe",{src:"https://proval.itglue.com/attachments/10110714?preview=1",width:"100%",height:"900px",frameborder:"0"})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},77820:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/image_1-676ea9e22df1f7d855fb42c22c0e6883.png"},666551:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/image_2-325b637f4459e972742abe6e65779424.png"},192910:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/image_3-2c05a83bdfb28b8f2da7f6414f8c7501.png"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>l});var i=n(296540);const a={},s=i.createContext(a);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);