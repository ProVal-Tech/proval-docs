"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[21491],{617235:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"cwa/monitors/faf8b7d6-6685-43be-a223-0c6ce7195147","title":"VM Snapshot older than 3 days","description":"This document outlines the implementation steps for monitoring Hyper-V snapshot age using a SQL query. It provides a detailed SQL command to insert monitoring agents and instructions for applying the alert template in the ConnectWise Automate environment.","source":"@site/docs/cwa/monitors/VM Snapshot older than 3 days.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/faf8b7d6-6685-43be-a223-0c6ce7195147","permalink":"/proval-docs/docs/cwa/monitors/faf8b7d6-6685-43be-a223-0c6ce7195147","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/VM Snapshot older than 3 days.md","tags":[{"inline":false,"label":"Database","permalink":"/proval-docs/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Hyper-V","permalink":"/proval-docs/docs/tags/hyper-v","description":"Documents on Microsoft Hyper-V virtualization and management"}],"version":"current","frontMatter":{"id":"faf8b7d6-6685-43be-a223-0c6ce7195147","title":"VM Snapshot older than 3 days","title_meta":"VM Snapshot older than 3 days","keywords":["hyper-v","snapshot","monitoring","database","alert"],"description":"This document outlines the implementation steps for monitoring Hyper-V snapshot age using a SQL query. It provides a detailed SQL command to insert monitoring agents and instructions for applying the alert template in the ConnectWise Automate environment.","tags":["database","hyper-v"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"VM Host Last Inventory 7 Days Ago","permalink":"/proval-docs/docs/cwa/monitors/cb58d7c6-a83c-4459-b3b1-53871b63d078"},"next":{"title":"Veeam Service Monitor","permalink":"/proval-docs/docs/cwa/monitors/dce82a22-77ba-4133-90d9-78a0a1b88412"}}');var r=t(474848),o=t(28453);const s={id:"faf8b7d6-6685-43be-a223-0c6ce7195147",title:"VM Snapshot older than 3 days",title_meta:"VM Snapshot older than 3 days",keywords:["hyper-v","snapshot","monitoring","database","alert"],description:"This document outlines the implementation steps for monitoring Hyper-V snapshot age using a SQL query. It provides a detailed SQL command to insert monitoring agents and instructions for applying the alert template in the ConnectWise Automate environment.",tags:["database","hyper-v"],draft:!1,unlisted:!1},i=void 0,d={},c=[{value:"Implementation",id:"implementation",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Execute the following query from a ",(0,r.jsx)(n.code,{children:"RAWSQL"})," monitor set."]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n'0' as `SearchID`,\r\n'ProVal - Production - HyperV - Snapshot Age > 3 Days' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'HyperV - Aging Snapshot Detected on %COMPUTERNAME%~~~Aging Snapshots are not detected anymore.!!!HyperV - Aging Snapshot Detected on %COMPUTERNAME%~~~The Hyper-V Host, %COMPUTERNAME%, has detected a VM snapshot that has an age of 3 days or older. It is important to delete unneeded snapshots since they can cause the server to use extra space over time. Please review the details below and remove the snapshot if it is no longer needed.' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'86400' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$X = 3;Get-VM | Get-VMSnapshot | Where-Object { $_.creationTime -le (Get-Date).AddDays(-$X) -and $_.IsDeleted -eq $false } | Select-Object -Property VMName, Name, ParentSnapshotName, SnapshotType, CreationTime | Format-List\\\"' as `DataOut`,\r\n'16' as `Comparor`,\r\n'10|((^((OK){0,}(//r//n){0,}[//r//n]{0,}//s{0,})$)%7C(^$))|11|((^((OK){0,}(//r//n){0,}[//r//n]{0,}//s{0,})$)%7C(^$))%7C(^((//r//n){0,}[//r//n]{0,}//s{0,})VMName)|10|^((//r//n){0,}[//r//n]{0,}//s{0,})VMName' as `DataIn`,\r\n'' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'16' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid = (SELECT MIN(groupid) FROM mastergroups WHERE `FullName` = 'Service Plans.Windows Servers.Server Roles.Windows Servers Core Services.Windows HyperV Host')\r\nAND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - HyperV - Snapshot Age > 3 Days')\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Locate your remote monitor by opening the group(s) remote monitors tab, then apply the appropriate alert template."})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Group Path:"})," ",(0,r.jsx)(n.code,{children:"Service Plans/Windows Servers/Server Roles/Windows Servers Core Services/Windows Hyper-V Host Group."})]}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var a=t(296540);const r={},o=a.createContext(r);function s(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);