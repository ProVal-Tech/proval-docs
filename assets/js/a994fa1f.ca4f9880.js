"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[95044],{622617:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>i,contentTitle:()=>d,default:()=>l,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"cwa/monitors/adc49b4c-24dc-4bb5-bd88-abddae4a4739","title":"Import - Remote Monitor - Reset Local User Password Age","description":"This document provides a detailed guide on how to set up a remote monitor using SQL queries. It includes steps to obtain group IDs, run SQL queries to create and configure the remote monitor, and apply alert templates for monitoring local user password age settings.","source":"@site/docs/cwa/monitors/Import - Remote Monitor - Reset Local User Password Age.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/adc49b4c-24dc-4bb5-bd88-abddae4a4739","permalink":"/docs/cwa/monitors/adc49b4c-24dc-4bb5-bd88-abddae4a4739","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/Import - Remote Monitor - Reset Local User Password Age.md","tags":[{"inline":false,"label":"Database","permalink":"/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Setup","permalink":"/docs/tags/setup","description":"Documents on setting up software and hardware configurations"}],"version":"current","frontMatter":{"id":"adc49b4c-24dc-4bb5-bd88-abddae4a4739","title":"Import - Remote Monitor - Reset Local User Password Age","title_meta":"Import - Remote Monitor - Reset Local User Password Age","keywords":["setup","remote","monitor","sql","query","groupid"],"description":"This document provides a detailed guide on how to set up a remote monitor using SQL queries. It includes steps to obtain group IDs, run SQL queries to create and configure the remote monitor, and apply alert templates for monitoring local user password age settings.","tags":["database","setup"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Import - Remote Monitor - Reset AD Users Password Age","permalink":"/docs/cwa/monitors/da1f5a89-eab2-4fae-8e49-e98c269cf103"},"next":{"title":"Import - Remote Monitor - SMB Signing Detection","permalink":"/docs/cwa/monitors/8283d8a6-8866-47c2-a6a3-a5bf288664f2"}}');var n=t(474848),a=t(28453);const s={id:"adc49b4c-24dc-4bb5-bd88-abddae4a4739",title:"Import - Remote Monitor - Reset Local User Password Age",title_meta:"Import - Remote Monitor - Reset Local User Password Age",keywords:["setup","remote","monitor","sql","query","groupid"],description:"This document provides a detailed guide on how to set up a remote monitor using SQL queries. It includes steps to obtain group IDs, run SQL queries to create and configure the remote monitor, and apply alert templates for monitoring local user password age settings.",tags:["database","setup"],draft:!1,unlisted:!1},d=void 0,i={},c=[{value:"Steps to Set Up Remote Monitor",id:"steps-to-set-up-remote-monitor",level:2},{value:"1. Obtain Group IDs",id:"1-obtain-group-ids",level:3},{value:"2. Run SQL Query",id:"2-run-sql-query",level:3},{value:"3. Set Up Remote Monitor",id:"3-set-up-remote-monitor",level:3},{value:"4. Example of Monitor Query",id:"4-example-of-monitor-query",level:3},{value:"5. Execute Your Query",id:"5-execute-your-query",level:3},{value:"6. Locate Your Remote Monitor",id:"6-locate-your-remote-monitor",level:3}];function R(e){const r={code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h2,{id:"steps-to-set-up-remote-monitor",children:"Steps to Set Up Remote Monitor"}),"\n",(0,n.jsx)(r.h3,{id:"1-obtain-group-ids",children:"1. Obtain Group IDs"}),"\n",(0,n.jsx)(r.p,{children:"Obtain the group ID(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"2-run-sql-query",children:"2. Run SQL Query"}),"\n",(0,n.jsx)(r.p,{children:"Run this SQL query from a RAWSQL monitor set to import the required search:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"INSERT INTO `sensorchecks`\r\nSELECT\r\n'' AS `SensID`,\r\n'Windows Computers excluding Infrastructure Master' AS `Name`,\r\n'SSELECT computers.computerid as `Computer Id`,computers.name as `Computer Name`,clients.name as `Client Name`,computers.domain as `Computer Domain`,computers.username as `Computer User`, IF(INSTR(IFNULL(inv_operatingsystem.Name, Computers.OS), /'windows/')>0, 1, IF(INSTR(IFNULL(inv_operatingsystem.Name, Computers.OS), /'darwin/') >0, 2, 3)) as `Computer.OS.Type`,IFNULL(crd1.RoleDefinitionId,0) as `AD Infrastructure Master-1` FROM Computers LEFT JOIN inv_operatingsystem ON (Computers.ComputerId=inv_operatingsystem.ComputerId) LEFT JOIN Clients ON (Computers.ClientId=Clients.ClientId) LEFT JOIN Locations ON (Computers.LocationId=Locations.LocationID) LEFT JOIN ComputerRoleDefinitions crd1 ON(crd1.ComputerId=Computers.ComputerId And crd1.RoleDefinitionId=(Select RoleDefinitionId From RoleDefinitions Where Rolename = /'AD Infrastructure Master/') And (crd1.Type=1 OR (crd1.CurrentlyDetected=1 and crd1.Type<>2))) WHERE ((((IF(INSTR(IFNULL(inv_operatingsystem.Name, Computers.OS), /'windows/')>0, 1, IF(INSTR(IFNULL(inv_operatingsystem.Name, Computers.OS), /'darwin/') >0, 2, 3)) = '1') AND (IFNULL(crd1.RoleDefinitionId,0) =0 ))))' AS `SQL`,\r\n'4' AS `QueryType`,\r\n'' AS `ListData`,\r\n'0' AS `FolderID`,\r\n'20e4fd06-535d-45a2-874e-b77315b50dd9' AS `GUID`,\r\n'' AS `SearchXML`,\r\n'' AS `UpdatedBy`,\r\n'' AS `UpdateDate`\r\nFROM (SELECT MIN(computerid) FROM computers) a\r\nWHERE (SELECT COUNT(*) FROM SensorChecks WHERE `GUID` = '20e4fd06-535d-45a2-874e-b77315b50dd9') = 0 ;\n"})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"3-set-up-remote-monitor",children:"3. Set Up Remote Monitor"}),"\n",(0,n.jsxs)(r.p,{children:["Copy the following query and replace ",(0,n.jsx)(r.strong,{children:"YOUR COMMA SEPARATED LIST OF GROUPID(S)"})," with the group ID(s) of the relevant groups to create and set up the remote monitor:"]}),"\n",(0,n.jsxs)(r.p,{children:["(The string to replace can be found at the very bottom of the query, right after ",(0,n.jsx)(r.strong,{children:"WHERE"}),")"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"SET @Searchid= (SELECT sensid FROM sensorchecks WHERE `GUID` = '20e4fd06-535d-45a2-874e-b77315b50dd9');\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"INSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n@Searchid as `SearchID`,\r\n'ProVal - Production - Reset Local User Password Age' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'Failed to Reset Local Users Password Age on %Computername% at %Clientname%~~~No users found with Password Age set to Not Expire.!!!Failed to Reset Local Users Password Age on %Computername% at %Clientname%~~~Failed to Reset Local Users Password Age on %Computername% at %Clientname%. Password is still set to Not Expire on below users:%RESULT%' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'900' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= /'SilentlyContinue/';net accounts /maxpwage:90 1>$Null ; $FailedUsers = @(); foreach ($user in (Get-LocalUser | Where-Object {$_.Enabled -eq $True -and ($_.PasswordExpires -ge (Get-Date).AddDays(90) -or $_.PasswordExpires -eq $Null)} | Select-Object -Expandproperty Name)) { try {set-localuser -Name $user -PasswordNeverExpires:$False -Erroraction Stop} catch {$FailedUsers += $User}}; $FailedUsers\\\"' as `DataOut`,\r\n'10' as `Comparor`,\r\n'^(//r//n)|(OK)|()|( )$' as `DataIn`,\r\n'0' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'0' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Reset Local User Password Age')\n"})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"4-example-of-monitor-query",children:"4. Example of Monitor Query"}),"\n",(0,n.jsx)(r.p,{children:"An example of a monitor query with a group ID:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"SET @Searchid= (SELECT sensid FROM sensorchecks WHERE `GUID` = '20e4fd06-535d-45a2-874e-b77315b50dd9');\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"INSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n@Searchid as `SearchID`,\r\n'ProVal - Production - Reset Local User Password Age' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'Failed to Reset Local Users Password Age on %Computername% at %Clientname%~~~No users found with Password Age set to Not Expire.!!!Failed to Reset Local Users Password Age on %Computername% at %Clientname%~~~Failed to Reset Local Users Password Age on %Computername% at %Clientname%. Password is still set to Not Expire on below users:%RESULT%' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'900' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= /'SilentlyContinue/';net accounts /maxpwage:90 1>$Null ; $FailedUsers = @(); foreach ($user in (Get-LocalUser | Where-Object {$_.Enabled -eq $True -and ($_.PasswordExpires -ge (Get-Date).AddDays(90) -or $_.PasswordExpires -eq $Null)} | Select-Object -Expandproperty Name)) { try {set-localuser -Name $user -PasswordNeverExpires:$False -Erroraction Stop} catch {$FailedUsers += $User}}; $FailedUsers\\\"' as `DataOut`,\r\n'10' as `Comparor`,\r\n'^(//r//n)|(OK)|()|( )$' as `DataIn`,\r\n'0' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'0' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (2,188)\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Reset Local User Password Age')\n"})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"5-execute-your-query",children:"5. Execute Your Query"}),"\n",(0,n.jsx)(r.p,{children:"Now execute your query from a RAWSQL monitor set."}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"6-locate-your-remote-monitor",children:"6. Locate Your Remote Monitor"}),"\n",(0,n.jsx)(r.p,{children:"Locate your remote monitor by opening the group(s) remote monitors tab, then apply the appropriate alert template."})]})}function l(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(R,{...e})}):R(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>s,x:()=>d});var o=t(296540);const n={},a=o.createContext(n);function s(e){const r=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),o.createElement(a.Provider,{value:r},e.children)}}}]);