"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[28294],{900945:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"cwa/scripts/ad0cedcb-352c-48d3-a1b6-a0ddb623b2b9","title":"SMB1 Traffic Detection Monitor Creation","description":"This document outlines the process for creating Remote Monitors for SMB1 Traffic Detection, detailing the necessary steps, dependencies, and configurations required for effective monitoring and alerting on SMB1 server status.","source":"@site/docs/cwa/scripts/SMB1 Traffic Detection Monitor Creation.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/ad0cedcb-352c-48d3-a1b6-a0ddb623b2b9","permalink":"/proval-docs/docs/cwa/scripts/ad0cedcb-352c-48d3-a1b6-a0ddb623b2b9","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/SMB1 Traffic Detection Monitor Creation.md","tags":[],"version":"current","frontMatter":{"id":"ad0cedcb-352c-48d3-a1b6-a0ddb623b2b9","title":"SMB1 Traffic Detection Monitor Creation","title_meta":"SMB1 Traffic Detection Monitor Creation","keywords":["smb1","monitor","traffic","detection","remote","properties","edf","alert","template","category"],"description":"This document outlines the process for creating Remote Monitors for SMB1 Traffic Detection, detailing the necessary steps, dependencies, and configurations required for effective monitoring and alerting on SMB1 server status.","tags":[],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"SFTP Server - Download Files","permalink":"/proval-docs/docs/cwa/scripts/f583b03a-3b9c-4630-b104-5f32fb5c55b9"},"next":{"title":"SMBv1 Enable Detection Ticketing - Per Client","permalink":"/proval-docs/docs/cwa/scripts/a518732d-b53b-4f7a-9aa1-1b478f68288f"}}');var n=r(474848),s=r(28453);const o={id:"ad0cedcb-352c-48d3-a1b6-a0ddb623b2b9",title:"SMB1 Traffic Detection Monitor Creation",title_meta:"SMB1 Traffic Detection Monitor Creation",keywords:["smb1","monitor","traffic","detection","remote","properties","edf","alert","template","category"],description:"This document outlines the process for creating Remote Monitors for SMB1 Traffic Detection, detailing the necessary steps, dependencies, and configurations required for effective monitoring and alerting on SMB1 server status.",tags:[],draft:!1,unlisted:!1},a=void 0,d={},c=[{value:"Summary",id:"summary",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"User Parameters",id:"user-parameters",level:2},{value:"System Properties",id:"system-properties",level:2},{value:"Computer-Level EDF",id:"computer-level-edf",level:2},{value:"Remote Monitor Example",id:"remote-monitor-example",level:2},{value:"Output",id:"output",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,n.jsx)(t.p,{children:"This document outlines the process for creating Remote Monitors for SMB1 Traffic Detection. The creation of these remote monitors is governed by system properties and computer-level Extra Data Fields (EDFs). These elements are further detailed within this document."}),"\n",(0,n.jsxs)(t.p,{children:["Remote monitors will be set up on computers where the ",(0,n.jsx)(t.a,{href:"/proval-docs/docs/cwa/monitors/de67816f-e6ff-4fed-92e1-26fd5ae5359d",children:"SMB1 Detection"})," remote monitor identifies the SMB1 Server Status as ",(0,n.jsx)(t.code,{children:"Enabled"}),". In the ",(0,n.jsx)(t.a,{href:"/proval-docs/docs/cwa/dataviews/da0254e3-0958-4ab4-9950-7e35feb12345",children:"SMB1 Status [Remote Monitor]"})," dataview, the ",(0,n.jsx)(t.code,{children:"SMB1 Server Status"})," column will display ",(0,n.jsx)(t.code,{children:"Enabled"})," for these machines."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Note of Caution"}),": The remote monitors created by this script utilize PowerShell for monitoring. Therefore, their functionality is not guaranteed on any computer running a version of PowerShell older than 5. Please ensure your systems are updated to at least PowerShell version 5 for optimal performance."]}),"\n",(0,n.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Gather existing ticket category and alert template ID:"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Look for the ",(0,n.jsx)(t.code,{children:"SMB1 Server Enabled [Remote Monitor]"})," group. Skip this step if the group does not exist.\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(911631).A+"",width:"511",height:"218"})]}),"\n",(0,n.jsxs)(t.li,{children:["Double-click to open the group.\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(472820).A+"",width:"848",height:"327"})]}),"\n",(0,n.jsxs)(t.li,{children:["Navigate to ",(0,n.jsx)(t.code,{children:"Computers"})," > ",(0,n.jsx)(t.code,{children:"Remote Monitors"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Select the ",(0,n.jsx)(t.code,{children:"SMB1 Traffic Detection"})," remote monitor."]}),"\n",(0,n.jsxs)(t.li,{children:["Take note of the Alert Template and Ticket Category applied to it.\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(210301).A+"",width:"1000",height:"667"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Import the"})," ",(0,n.jsx)(t.a,{href:"https://proval.itglue.com/5078775/docs/17454586#version=draft&documentMode=edit",children:(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.code,{children:"SMB1 Traffic Detection Monitor Creation"})})})," ",(0,n.jsx)(t.strong,{children:"script from the"})," ",(0,n.jsx)(t.code,{children:"ProSync"})," ",(0,n.jsx)(t.strong,{children:"plugin."})]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Run/Debug the Script"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Execute or debug the script against a single client, with the ",(0,n.jsx)(t.code,{children:"Set_Environment"})," parameter set to ",(0,n.jsx)(t.code,{children:"1"}),". This action will generate the necessary system properties and Extra Data Fields (EDFs) for managing the remote monitors.\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(1154).A+"",width:"509",height:"546"}),"\r\nAdditionally, it will remove the following:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Group Remote Monitor: ",(0,n.jsx)(t.code,{children:"SMB1 Traffic Detection"})]}),"\n",(0,n.jsxs)(t.li,{children:["Search: ",(0,n.jsx)(t.code,{children:"SMB1 Server Enabled [Remote Monitor]"})]}),"\n",(0,n.jsxs)(t.li,{children:["Group: ",(0,n.jsx)(t.code,{children:"SMB1 Server Enabled [Remote Monitor]"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Reload System Cache"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Refresh the system cache to ensure all changes are updated.\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(764811).A+"",width:"187",height:"177"})]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Configure System Properties and EDFs"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Navigate to the ",(0,n.jsx)(t.strong,{children:"System Dashboard --\x3e Config --\x3e Configurations --\x3e Properties"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Set the appropriate alert template and ticket category in their respective system properties for the monitor set.\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(799408).A+"",width:"697",height:"253"})]}),"\n",(0,n.jsx)(t.li,{children:"Please read through the detailed System Properties and EDF explanations to understand how to configure any customizations."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Schedule the Script"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Schedule the script to run once per day, preferably around midnight, from the dashboard for optimal results.\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(515161).A+"",width:"903",height:"481"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/proval-docs/docs/cwa/monitors/de67816f-e6ff-4fed-92e1-26fd5ae5359d",children:"EPM - Windows Configuration - Remote Monitor - SMB1 Detection"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/proval-docs/docs/cwa/monitors/8b1cd8a8-6684-4896-ae30-a39b3bdb485e",children:"CWA - Remote Monitor - SMB1 Detection"})}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"user-parameters",children:"User Parameters"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Example"}),(0,n.jsx)(t.th,{children:"Required"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsx)(t.tbody,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Set_Environment"}),(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"True (for first run only)"}),(0,n.jsx)(t.td,{children:"Set it to 1 during the first run of the script to generate the necessary system properties and EDFs for managing the generated remote monitors."})]})})]}),"\n",(0,n.jsx)(t.h2,{id:"system-properties",children:"System Properties"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Example"}),(0,n.jsx)(t.th,{children:"Required"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"SMB1_Traffic_Detection_AlertTemplate"}),(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"True"}),(0,n.jsxs)(t.td,{children:["This system property stores the ID of the ",(0,n.jsx)(t.code,{children:"Alert Template"})," to apply to the remote monitors created for the servers. The default value is '0', i.e., ",(0,n.jsx)(t.code,{children:"\\\\<Not Selected>"}),". Navigate to the ",(0,n.jsx)(t.strong,{children:"System Dashboard --\x3e Management --\x3e Alert Templates"})," to find the ID of the required alert template. It is suggested to use the ",(0,n.jsx)(t.code,{children:"\u25b3 Custom - Ticket Creation - Computer - Failures Only"})," alert for better alerting. The alert template should not be running the very same script for the Warning action as well unless you want to create a ticket for the PowerShell errors too."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"SMB1_Traffic_Detection_TicketCategory"}),(0,n.jsx)(t.td,{children:"124"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsxs)(t.td,{children:["This system property stores the ID of the ",(0,n.jsx)(t.code,{children:"Ticket Category"})," to apply to the remote monitors created. The default value is '0', i.e., ",(0,n.jsx)(t.code,{children:"\\\\<Not Specified>"}),". Ticket Categories are used to control the CW Manage service board of the tickets generated by Automate. Navigate to the ",(0,n.jsx)(t.strong,{children:"System Dashboard --\x3e Config--\x3e Information Base Categories"})," to find the ID of the required ticket category."]})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"computer-level-edf",children:"Computer-Level EDF"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Type"}),(0,n.jsx)(t.th,{children:"Section"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsx)(t.tbody,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"SMB1_Traffic_Detection_Exclusion"}),(0,n.jsx)(t.td,{children:"Check Box"}),(0,n.jsx)(t.td,{children:"Exclusions"}),(0,n.jsx)(t.td,{children:"Selecting this Extra Data Field (EDF) will exclude the computer from the SMB1 Traffic Detection monitoring. As a result, the script will not create any remote monitor for this computer. Furthermore, upon marking this EDF, the script will also remove any previously created remote monitor for this computer."})]})})]}),"\n",(0,n.jsx)(t.h2,{id:"remote-monitor-example",children:"Remote Monitor Example"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Name:"})," ",(0,n.jsx)(t.code,{children:"ProVal - Production - Memory Threshold Violation Monitor"})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Ticket Subject:"})," ",(0,n.jsx)(t.code,{children:"SMB1 Traffic Detected on %COMPUTERNAME%"})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Alert Message on Failure:"})," ",(0,n.jsx)(t.code,{children:"SMB1 Traffic detected on %CLIENTNAME%/%COMPUTERNAME% in the past 1 hour. Details: %RESULT%"})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Sample Remote Monitor:"}),"\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(699598).A+"",width:"646",height:"570"}),"\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(173239).A+"",width:"652",height:"570"}),"\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(405247).A+"",width:"650",height:"566"}),"\r\n",(0,n.jsx)(t.img,{alt:"Image",src:r(627158).A+"",width:"645",height:"561"})]}),"\n",(0,n.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Remote Monitors"}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},911631:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_1-ac3fe818e9ebab8e84d61ccd8f8bf6d7.png"},405247:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_10-daba56a2a89d1077be9f5a38f9c24b65.png"},627158:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_11-25e40f8b3123a352ed2836c9221ee1fe.png"},472820:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_2-d8b2cf1ea6319be56359f7dbb39eb288.png"},210301:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_3-05117ea11364a19643bd35a0d5a38a05.png"},1154:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_4-08cf6fcc77ad3e8a213e7747b3b87b33.png"},764811:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_5-e2435e9a3c6a1eb254214832a52a9e0c.png"},799408:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_6-e65686d24a30deb4786597a9ba90e265.png"},515161:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_7-43d7ed9bdd07281cb3031046f080be00.png"},699598:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_8-637d3d710a8a321d768d6863d09203fc.png"},173239:(e,t,r)=>{r.d(t,{A:()=>i});const i=r.p+"assets/images/image_9-2fb8df3242050801a2a129996543fa59.png"},28453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>a});var i=r(296540);const n={},s=i.createContext(n);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);