"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[72398],{453980:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>i,contentTitle:()=>d,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"cwa/monitors/da1f5a89-eab2-4fae-8e49-e98c269cf103","title":"Import - Remote Monitor - Reset AD Users Password Age","description":"This document provides a step-by-step guide on how to set up a remote monitor in ConnectWise Automate to reset the password age for Active Directory users. It includes SQL queries for creating and managing the monitor, as well as examples for implementation.","source":"@site/docs/cwa/monitors/Import - Remote Monitor - Reset AD Users Password Age.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/da1f5a89-eab2-4fae-8e49-e98c269cf103","permalink":"/proval-docs/docs/cwa/monitors/da1f5a89-eab2-4fae-8e49-e98c269cf103","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/Import - Remote Monitor - Reset AD Users Password Age.md","tags":[{"inline":false,"label":"Active Directory","permalink":"/proval-docs/docs/tags/active-directory","description":"Documents related to Active Directory services and management"},{"inline":false,"label":"SQL","permalink":"/proval-docs/docs/tags/sql","description":"Documents discussing Structured Query Language and database interactions"}],"version":"current","frontMatter":{"id":"da1f5a89-eab2-4fae-8e49-e98c269cf103","title":"Import - Remote Monitor - Reset AD Users Password Age","title_meta":"Import - Remote Monitor - Reset AD Users Password Age","keywords":["ad","users","password","reset","monitor"],"description":"This document provides a step-by-step guide on how to set up a remote monitor in ConnectWise Automate to reset the password age for Active Directory users. It includes SQL queries for creating and managing the monitor, as well as examples for implementation.","tags":["active-directory","sql"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Import - Remote Monitor - RemoteAccess Service Check","permalink":"/proval-docs/docs/cwa/monitors/dd99f8a5-83f7-48a5-b8a9-ac68224e543a"},"next":{"title":"Import - Remote Monitor - Reset Local User Password Age","permalink":"/proval-docs/docs/cwa/monitors/adc49b4c-24dc-4bb5-bd88-abddae4a4739"}}');var s=t(474848),n=t(28453);const o={id:"da1f5a89-eab2-4fae-8e49-e98c269cf103",title:"Import - Remote Monitor - Reset AD Users Password Age",title_meta:"Import - Remote Monitor - Reset AD Users Password Age",keywords:["ad","users","password","reset","monitor"],description:"This document provides a step-by-step guide on how to set up a remote monitor in ConnectWise Automate to reset the password age for Active Directory users. It includes SQL queries for creating and managing the monitor, as well as examples for implementation.",tags:["active-directory","sql"],draft:!1,unlisted:!1},d=void 0,i={},c=[{value:"Step 1",id:"step-1",level:2},{value:"Step 2",id:"step-2",level:2},{value:"Step 3",id:"step-3",level:2},{value:"Step 4",id:"step-4",level:2},{value:"Step 5",id:"step-5",level:2},{value:"Step 6",id:"step-6",level:2}];function R(e){const r={code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"step-1",children:"Step 1"}),"\n",(0,s.jsx)(r.p,{children:"Obtain the group ID(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"step-2",children:"Step 2"}),"\n",(0,s.jsx)(r.p,{children:"Run this SQL query from a RAWSQL monitor set to import the required search:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"INSERT INTO `sensorchecks`\r\nSELECT\r\n'' AS `SensID`,\r\n'Server Role - AD - Infrastructure Master' AS `Name`,\r\n'SSELECT computers.computerid as `Computer Id`, computers.name as `Computer Name`, clients.name as `Client Name`, computers.domain as `Computer Domain`, computers.username as `Computer User`, IFNULL(IFNULL(edfAssigned1.Value,edfDefault1.value),//'0//') as `Computer - Extra Data Field - Default - Under MSP Contract`, IFNULL(crd2.RoleDefinitionId,0) as `AD Infrastructure Master-2`, IFNULL(IFNULL(edfAssigned3.Value,edfDefault3.value),//'0//') as `Computer - Extra Data Field - Default - Exclude MSP Contract`, IF(INSTR(computers.os, //'server//')>0, 1, 0) as `Computer.OS.IsServer` FROM Computers LEFT JOIN inv_operatingsystem ON (Computers.ComputerId=inv_operatingsystem.ComputerId) LEFT JOIN Clients ON (Computers.ClientId=Clients.ClientId) LEFT JOIN Locations ON (Computers.LocationId=Locations.LocationID) LEFT JOIN ExtraFieldData edfAssigned1 ON (edfAssigned1.id=Computers.ComputerId AND edfAssigned1.ExtraFieldId =(SELECT ExtraField.id FROM ExtraField WHERE `name`=//'Under MSP Contract//')) LEFT JOIN ExtraFieldData edfDefault1 ON (edfDefault1.id=0 AND edfDefault1.ExtraFieldId =(SELECT ExtraField.id FROM ExtraField WHERE `name`=//'Under MSP Contract//')) LEFT JOIN ComputerRoleDefinitions crd2 ON (crd2.ComputerId=Computers.ComputerId AND crd2.RoleDefinitionId=(SELECT RoleDefinitionId FROM RoleDefinitions WHERE `RoleName`=//'AD Infrastructure Master//') AND (crd2.Type=1 OR (crd2.CurrentlyDetected=1 AND crd2.Type<>2))) LEFT JOIN ExtraFieldData edfAssigned3 ON (edfAssigned3.id=Computers.ComputerId AND edfAssigned3.ExtraFieldId =(SELECT ExtraField.id FROM ExtraField WHERE `name`=//'Exclude MSP Contract//')) LEFT JOIN ExtraFieldData edfDefault3 ON (edfDefault3.id=0 AND edfDefault3.ExtraFieldId =(SELECT ExtraField.id FROM ExtraField WHERE `name`=//'Exclude MSP Contract//')) WHERE ((((IFNULL(IFNULL(edfAssigned1.Value,edfDefault1.value),//'0//')<>0) AND (IFNULL(crd2.RoleDefinitionId,0) >0 ) AND (NOT ((IFNULL(IFNULL(edfAssigned3.Value,edfDefault3.value),//'0//')<>0))) AND (IF(INSTR(computers.os, //'server//')>0, 1, 0)<>0))))\r\n' AS `SQL`,\r\n'4' AS `QueryType`,\r\n'' AS `ListData`,\r\n'0' AS `FolderID`,\r\n'430a4640-9c97-4344-bfe8-7a786b110729' AS `GUID`,\r\n'' AS `SearchXML`,\r\n'' AS `UpdatedBy`,\r\n'' AS `UpdateDate`\r\nFROM (SELECT MIN(computerid) FROM computers) a\r\nWHERE (SELECT COUNT(*) FROM SensorChecks WHERE `GUID` = '430a4640-9c97-4344-bfe8-7a786b110729') = 0;\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"step-3",children:"Step 3"}),"\n",(0,s.jsxs)(r.p,{children:["Copy the following query and replace ",(0,s.jsx)(r.strong,{children:"YOUR COMMA SEPARATED LIST OF GROUPID(S)"})," with the Group ID(s) of the relevant groups to create and set up the remote monitor:\r\n(The string to replace can be found at the very bottom of the query, right after ",(0,s.jsx)(r.strong,{children:"WHERE"}),")"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"INSERT INTO groupagents\r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n'648' as `SearchID`,\r\n'ProVal - Production - Reset AD Users Password Age' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'Failed to Reset AD Users Password Age on %Computername% at %Clientname%~~~No users found with Password Age set to Not Expire.!!!Failed to Reset AD Users Password Age on %Computername% at %Clientname%~~~Failed to Reset AD Users Password Age on %Computername% at %Clientname%. Password is still set to Not Expire on below users:%RESULT%' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'86400' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C:////Windows////System32////WindowsPowerShell////v1.0////powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= //'SilentlyContinue//';net accounts /maxpwage:90 /domain;$FailedUsers = @();foreach ($user in (Get-ADUser -filter {Enabled -eq $True -and PasswordNeverExpires -eq $True} | Select-Object -Expandproperty Name )){ try { Set-ADUser -Identity $user -PasswordNeverExpires $false -Erroraction Stop} catch {$FailedUsers += $User}}; $FailedUsers\\\"' as `DataOut`,\r\n'10' as `Comparor`,\r\n'^((////r////n)|(OK)|()|( ))$' as `DataIn`,\r\n'0' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'0' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Reset AD Users Password Age')\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"step-4",children:"Step 4"}),"\n",(0,s.jsx)(r.p,{children:"An example of a monitor query with a group ID:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"INSERT INTO groupagents\r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n'648' as `SearchID`,\r\n'ProVal - Production - Reset AD Users Password Age' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'Failed to Reset AD Users Password Age on %Computername% at %Clientname%~~~No users found with Password Age set to Not Expire.!!!Failed to Reset AD Users Password Age on %Computername% at %Clientname%~~~Failed to Reset AD Users Password Age on %Computername% at %Clientname%. Password is still set to Not Expire on below users:%RESULT%' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'86400' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C:////Windows////System32////WindowsPowerShell////v1.0////powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= //'SilentlyContinue//';net accounts /maxpwage:90 /domain;$FailedUsers = @();foreach ($user in (Get-ADUser -filter {Enabled -eq $True -and PasswordNeverExpires -eq $True} | Select-Object -Expandproperty Name )){ try { Set-ADUser -Identity $user -PasswordNeverExpires $false -Erroraction Stop} catch {$FailedUsers += $User}}; $FailedUsers\\\"' as `DataOut`,\r\n'10' as `Comparor`,\r\n'^((////r////n)|(OK)|()|( ))$' as `DataIn`,\r\n'0' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'0' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (2,188)\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Reset AD Users Password Age')\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"step-5",children:"Step 5"}),"\n",(0,s.jsx)(r.p,{children:"Now execute your query from a RAWSQL monitor set."}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"step-6",children:"Step 6"}),"\n",(0,s.jsx)(r.p,{children:"Locate your remote monitor by opening the group(s) remote monitors tab, then apply the appropriate alert template."})]})}function l(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(R,{...e})}):R(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>d});var a=t(296540);const s={},n=a.createContext(s);function o(e){const r=a.useContext(n);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(n.Provider,{value:r},e.children)}}}]);