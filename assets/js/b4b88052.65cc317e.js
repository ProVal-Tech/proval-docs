"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[58158],{241593:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"cwa/monitors/2cfde48c-aa83-4990-83bd-cb768c882081","title":"DHCP Scope(s) 25 Percent IP Addresses Available","description":"This document provides detailed steps on how to apply a remote monitor for DHCP scopes with insufficient IP addresses. It includes SQL query examples and instructions for executing the queries within a RAWSQL monitor set, ensuring effective monitoring and alerting for network connectivity issues.","source":"@site/docs/cwa/monitors/DHCP Scope(s) 25 Percent IP Addresses Available.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/2cfde48c-aa83-4990-83bd-cb768c882081","permalink":"/docs/cwa/monitors/2cfde48c-aa83-4990-83bd-cb768c882081","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/DHCP Scope(s) 25 Percent IP Addresses Available.md","tags":[{"inline":false,"label":"DHCP","permalink":"/docs/tags/dhcp","description":"Documents discussing Dynamic Host Configuration Protocol and its configuration"},{"inline":false,"label":"Networking","permalink":"/docs/tags/networking","description":"Documents related to network infrastructure and management practices"}],"version":"current","frontMatter":{"id":"2cfde48c-aa83-4990-83bd-cb768c882081","title":"DHCP Scope(s) 25 Percent IP Addresses Available","title_meta":"DHCP Scope(s) 25 Percent IP Addresses Available","keywords":["remote","monitor","dhcp","groupid","alert","configuration"],"description":"This document provides detailed steps on how to apply a remote monitor for DHCP scopes with insufficient IP addresses. It includes SQL query examples and instructions for executing the queries within a RAWSQL monitor set, ensuring effective monitoring and alerting for network connectivity issues.","tags":["dhcp","networking"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"DHCP Scope(s)  5 IP Addresses Available","permalink":"/docs/cwa/monitors/90ad5d20-a081-4027-b8e2-238cbdbe64d3"},"next":{"title":"DHCP Scope(s) 25 and 20 Percent IP Addresses Available","permalink":"/docs/cwa/monitors/ce8d5706-137b-4a55-8a8b-5041e35421de"}}');var n=t(474848),a=t(28453);const o={id:"2cfde48c-aa83-4990-83bd-cb768c882081",title:"DHCP Scope(s) 25 Percent IP Addresses Available",title_meta:"DHCP Scope(s) 25 Percent IP Addresses Available",keywords:["remote","monitor","dhcp","groupid","alert","configuration"],description:"This document provides detailed steps on how to apply a remote monitor for DHCP scopes with insufficient IP addresses. It includes SQL query examples and instructions for executing the queries within a RAWSQL monitor set, ensuring effective monitoring and alerting for network connectivity issues.",tags:["dhcp","networking"],draft:!1,unlisted:!1},c=void 0,i={},d=[{value:"Steps to Apply Remote Monitor",id:"steps-to-apply-remote-monitor",level:2},{value:"1. Obtain the Group ID(s)",id:"1-obtain-the-group-ids",level:3},{value:"2. Copy and Modify the SQL Query",id:"2-copy-and-modify-the-sql-query",level:3},{value:"3. Example Query with a Group ID",id:"3-example-query-with-a-group-id",level:3},{value:"4. Execute Your Query",id:"4-execute-your-query",level:3},{value:"5. Locate and Apply the Alert Template",id:"5-locate-and-apply-the-alert-template",level:3}];function R(e){const r={code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h2,{id:"steps-to-apply-remote-monitor",children:"Steps to Apply Remote Monitor"}),"\n",(0,n.jsx)(r.h3,{id:"1-obtain-the-group-ids",children:"1. Obtain the Group ID(s)"}),"\n",(0,n.jsx)(r.p,{children:"Obtain the group ID(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"2-copy-and-modify-the-sql-query",children:"2. Copy and Modify the SQL Query"}),"\n",(0,n.jsxs)(r.p,{children:["Copy the following query and replace ",(0,n.jsx)(r.strong,{children:"YOUR COMMA SEPARATED LIST OF GROUPID(S)"})," with the Group ID(s) of the relevant groups. The string to replace can be found at the very bottom of the query, right after ",(0,n.jsx)(r.strong,{children:"WHERE"}),"."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sql",children:"INSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n'0' as `SearchID`,\r\n'ProVal - Production - DHCP Scope(s) < 25% IP Addresses Available' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'DHCP Scope(s) with Insufficient IP Addresses Detected on %computername%~~~The problem is fixed.!!!DHCP Scope(s) with Insufficient IP Addresses Detected on %computername%~~~Active DHCP scope(s) with less than 25% available IP addresses detected on %ClientName%/%ComputerName% at %LocationName%. \\r\\n\\r\\nThis could potentially lead to IP address allocation problems and network connectivity issues for users. Immediate action should be taken to ensure sufficient IP addresses are available within the DHCP scopes to prevent any network disruptions. Please investigate the DHCP server configuration and take the necessary steps to address this issue. Potential solutions could include expanding IP address ranges, optimizing IP address allocation, or adding additional DHCP servers.\\r\\n\\r\\nAffected Scope(s) details: \\r\\n%RESULT%' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'3600' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= 'SilentlyContinue'; $t = 25; $ss =  try {Get-DhcpServerv4Failover -erroraction stop | Where-Object {$_.ServerRole -eq 'Active' -and $_.ScopeId -match './'}} catch {$null}; if ($ss.ServerRole -eq 'Standby') {return}; $scopes = Get-DhcpServerv4Scope | Where-Object {$_.State -eq 'Active'}; $DhcpScopes = foreach($scope in $scopes) {$scopeStats = $scope | Get-DhcpServerv4ScopeStatistics; [pscustomobject]@{scopeid = $scope.scopeid; startrange = $scope.startrange; endrange = $scope.endrange; free = $(if ($ss.ReservePercent -gt 0) {[Math]::Max(0, $($scopestats.free - [Math]::Round((($scopestats.free + $scopestats.InUse ) * $ss.ReservePercent)/100)))} else {$scopestats.free}); inuse = $scopestats.inuse; Reserved = $scopestats.Reserved; Percentagefree = $(if ($ss.ReservePercent -gt 0) {[Math]::Max(0, $([Math]::Round((100 - $scopestats.PercentageInUse - $ss.ReservePercent),2)))} else {[Math]::Round((100 - $scopestats.PercentageInUse),2)})}}; $DhcpScopes | Where-Object {$_.Percentagefree -le $t}\\\"' as `DataOut`,\r\n'16' as `Comparor`,\r\n'10|(^(//r//n%7COK%7C[//s//S])$)%7C(^$)|11|(^(//r//n%7COK%7C[//s//S])$)%7C(^$)%7C(scopeid.*?:.*?[//r//n]{0,}.*?startrange)|10|(scopeid.*?:.*?[//r//n]{0,}.*?startrange)' as `DataIn`,\r\n'' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'21' as `Category`,\r\n'0' as `TicketCategory`,\r\n'0' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - DHCP Scope(s) < 25% IP Addresses Available')\n"})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"3-example-query-with-a-group-id",children:"3. Example Query with a Group ID"}),"\n",(0,n.jsx)(r.p,{children:"An example of a query with a group ID:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sql",children:"INSERT INTO groupagents \r\nSELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n'0' as `SearchID`,\r\n'ProVal - Production - DHCP Scope(s) < 25% IP Addresses Available' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'DHCP Scope(s) with Insufficient IP Addresses Detected on %computername%~~~The problem is fixed.!!!DHCP Scope(s) with Insufficient IP Addresses Detected on %computername%~~~Active DHCP scope(s) with less than 25% available IP addresses detected on %ClientName%/%ComputerName% at %LocationName%. \\r\\n\\r\\nThis could potentially lead to IP address allocation problems and network connectivity issues for users. Immediate action should be taken to ensure sufficient IP addresses are available within the DHCP scopes to prevent any network disruptions. Please investigate the DHCP server configuration and take the necessary steps to address this issue. Potential solutions could include expanding IP address ranges, optimizing IP address allocation, or adding additional DHCP servers.\\r\\n\\r\\nAffected Scope(s) details: \\r\\n%RESULT%' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'3600' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= 'SilentlyContinue'; $t = 25; $ss =  try {Get-DhcpServerv4Failover -erroraction stop | Where-Object {$_.ServerRole -eq 'Active' -and $_.ScopeId -match './'}} catch {$null}; if ($ss.ServerRole -eq 'Standby') {return}; $scopes = Get-DhcpServerv4Scope | Where-Object {$_.State -eq 'Active'}; $DhcpScopes = foreach($scope in $scopes) {$scopeStats = $scope | Get-DhcpServerv4ScopeStatistics; [pscustomobject]@{scopeid = $scope.scopeid; startrange = $scope.startrange; endrange = $scope.endrange; free = $(if ($ss.ReservePercent -gt 0) {[Math]::Max(0, $($scopestats.free - [Math]::Round((($scopestats.free + $scopestats.InUse ) * $ss.ReservePercent)/100)))} else {$scopestats.free}); inuse = $scopestats.inuse; Reserved = $scopestats.Reserved; Percentagefree = $(if ($ss.ReservePercent -gt 0) {[Math]::Max(0, $([Math]::Round((100 - $scopestats.PercentageInUse - $ss.ReservePercent),2)))} else {[Math]::Round((100 - $scopestats.PercentageInUse),2)})}}; $DhcpScopes | Where-Object {$_.Percentagefree -le $t}\\\"' as `DataOut`,\r\n'16' as `Comparor`,\r\n'10|(^(//r//n%7COK%7C[//s//S])$)%7C(^$)|11|(^(//r//n%7COK%7C[//s//S])$)%7C(^$)%7C(scopeid.*?:.*?[//r//n]{0,}.*?startrange)|10|(scopeid.*?:.*?[//r//n]{0,}.*?startrange)' as `DataIn`,\r\n'' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'21' as `Category`,\r\n'0' as `TicketCategory`,\r\n'0' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (1674)\r\nAND m.groupid NOT IN (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - DHCP Scope(s) < 25% IP Addresses Available')\n"})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"4-execute-your-query",children:"4. Execute Your Query"}),"\n",(0,n.jsx)(r.p,{children:"Now execute your query from a RAWSQL monitor set."}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"5-locate-and-apply-the-alert-template",children:"5. Locate and Apply the Alert Template"}),"\n",(0,n.jsx)(r.p,{children:"Locate your remote monitor by opening the group(s) remote monitors tab, then apply the appropriate alert template."})]})}function p(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(R,{...e})}):R(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>c});var s=t(296540);const n={},a=s.createContext(n);function o(e){const r=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(a.Provider,{value:r},e.children)}}}]);