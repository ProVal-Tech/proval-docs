"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[30069],{544224:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>m,frontMatter:()=>a,metadata:()=>o,toc:()=>i});const o=JSON.parse('{"id":"vsa/procedures/9a19342e-1fd7-4e68-b54a-6831f8eef5b8","title":"Endpoint VPN Configuration","description":"This document details the configuration of a VPN on endpoints using Managed Variable data, addressing various use cases such as additional connection gateways, Split Tunneling, and credential memory. It also outlines the creation of a desktop shortcut for user convenience.","source":"@site/docs/vsa/procedures/Endpoint VPN Configuration.md","sourceDirName":"vsa/procedures","slug":"/vsa/procedures/9a19342e-1fd7-4e68-b54a-6831f8eef5b8","permalink":"/proval-docs/docs/vsa/procedures/9a19342e-1fd7-4e68-b54a-6831f8eef5b8","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/vsa/procedures/Endpoint VPN Configuration.md","tags":[{"inline":false,"label":"Networking","permalink":"/proval-docs/docs/tags/networking","description":"Documents related to network infrastructure and management practices"},{"inline":false,"label":"Security","permalink":"/proval-docs/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Setup","permalink":"/proval-docs/docs/tags/setup","description":"Documents on setting up software and hardware configurations"},{"inline":false,"label":"VPN","permalink":"/proval-docs/docs/tags/vpn","description":"Documents concerning Virtual Private Network configurations and security"}],"version":"current","frontMatter":{"id":"9a19342e-1fd7-4e68-b54a-6831f8eef5b8","title":"Endpoint VPN Configuration","title_meta":"Endpoint VPN Configuration","keywords":["vpn","configuration","shortcut","gateway","tunneling","credentials","network"],"description":"This document details the configuration of a VPN on endpoints using Managed Variable data, addressing various use cases such as additional connection gateways, Split Tunneling, and credential memory. It also outlines the creation of a desktop shortcut for user convenience.","tags":["networking","security","setup","vpn"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Enable Bitlocker","permalink":"/proval-docs/docs/vsa/procedures/afd016fa-315e-4822-8278-0f33863e3fc0"},"next":{"title":"Eshare Install","permalink":"/proval-docs/docs/vsa/procedures/64f26a73-5577-4bfd-b0f0-e8f90ed2904b"}}');var s=t(474848),r=t(28453);const a={id:"9a19342e-1fd7-4e68-b54a-6831f8eef5b8",title:"Endpoint VPN Configuration",title_meta:"Endpoint VPN Configuration",keywords:["vpn","configuration","shortcut","gateway","tunneling","credentials","network"],description:"This document details the configuration of a VPN on endpoints using Managed Variable data, addressing various use cases such as additional connection gateways, Split Tunneling, and credential memory. It also outlines the creation of a desktop shortcut for user convenience.",tags:["networking","security","setup","vpn"],draft:!1,unlisted:!1},c=void 0,l={},i=[{value:"Summary",id:"summary",level:2},{value:"Example Agent Procedure Log",id:"example-agent-procedure-log",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Process",id:"process",level:2},{value:"Output",id:"output",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"This document configures a VPN on the endpoint based on Managed Variable data. It handles several use cases such as additional connection gateways, Split Tunneling, credential memory, etc. A shortcut is created on the endpoint desktop for all users to easily connect to the VPN."}),"\n",(0,s.jsx)(n.h2,{id:"example-agent-procedure-log",children:"Example Agent Procedure Log"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'2:17:29 pm 13-Jan-23   Endpoint VPN Configuration   Success THEN   provaltech.com/dan.hicks\r\n2:17:29 pm 13-Jan-23   Endpoint VPN Configuration       provaltech.com/dan.hicks\r\n2:17:29 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)   Success THEN   provaltech.com/dan.hicks\r\n2:17:29 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Powershell command complete. Results returned to global variable #global:psresult# and saved in Agent\'s Documents tab of server.   provaltech.com/dan.hicks\r\n2:17:29 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Informational: GetFile command overwrote the server file C://Kaseya//UserProfiles//229175768944442//GetFiles//..//docs//psoutput.txt with the new contents from c://provaltech//psoutput.txt in THEN step 3.   provaltech.com/dan.hicks\r\n2:17:22 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0011   Executing 64-bit Powershell command as System: "" -command "$shortcutArgs = \'""""GNW VPN1""""\'; $WshShell = New-Object -comObject WScript.Shell; $Shortcut = $WshShell.CreateShortcut(""$env:SystemDrive//Users//Public//Desktop//GNW VPN1.lnk""); $Shortcut.TargetPath = ""$env:SystemDrive//Windows//system32//Rasdial.exe""; $Shortcut.Arguments = $shortcutArgs; $Shortcut.IconLocation = ""$env:ProgramData//_automation//AgentProcedure//VpnSetup//vpnIcon.ico""; $Shortcut.Save()" >"c://provaltech//psoutputtmp.txt"   provaltech.com/dan.hicks\r\n2:17:22 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0013   Sending output to global variable.   provaltech.com/dan.hicks\r\n2:17:21 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0008   Custom commands detected as $shortcutArgs = \'""""GNW VPN1""""\'; $WshShell = New-Object -comObject WScript.Shell; $Shortcut = $WshShell.CreateShortcut(""$env:SystemDrive//Users//Public//Desktop//GNW VPN1.lnk""); $Shortcut.TargetPath = ""$env:SystemDrive//Windows//system32//Rasdial.exe""; $Shortcut.Arguments = $shortcutArgs; $Shortcut.IconLocation = ""$env:ProgramData//_automation//AgentProcedure//VpnSetup//vpnIcon.ico""; $Shortcut.Save()   provaltech.com/dan.hicks\r\n2:17:21 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0003   No powershell file variable detected.   provaltech.com/dan.hicks\r\n2:17:14 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0002   Powershell is present.   provaltech.com/dan.hicks\r\n2:17:11 pm 13-Jan-23   Endpoint VPN Configuration-0003       provaltech.com/dan.hicks\r\n2:17:11 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)   Success THEN   provaltech.com/dan.hicks\r\n2:17:10 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Powershell command complete. Results returned to global variable #global:psresult# and saved in Agent\'s Documents tab of server.   provaltech.com/dan.hicks\r\n2:17:10 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Informational: GetFile command overwrote the server file C://Kaseya//UserProfiles//229175768944442//GetFiles//..//docs//psoutput.txt with the new contents from c://provaltech//psoutput.txt in THEN step 3.   provaltech.com/dan.hicks\r\n2:16:59 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0011   Executing 64-bit Powershell command as System: "" -command "Add-VPNConnectionRoute -ConnectionName \'GNW VPN1\' -DestinationPrefix \'10.10.5.0/24\' -AllUserConnection" >"c://provaltech//psoutputtmp.txt"   provaltech.com/dan.hicks\r\n2:16:59 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0013   Sending output to global variable.   provaltech.com/dan.hicks\r\n2:16:59 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0008   Custom commands detected as Add-VPNConnectionRoute -ConnectionName \'GNW VPN1\' -DestinationPrefix \'10.10.5.0/24\' -AllUserConnection   provaltech.com/dan.hicks\r\n2:16:59 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0003   No powershell file variable detected.   provaltech.com/dan.hicks\r\n2:16:52 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0002   Powershell is present.   provaltech.com/dan.hicks\r\n2:16:48 pm 13-Jan-23   Endpoint VPN Configuration-0001   WARNING: The currently selected encryption level requires EAP or MS-CHAPv2 logon security methods. Data encryption will not occur for PAP or CHAP.   provaltech.com/dan.hicks\r\n2:16:48 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)   Success THEN   provaltech.com/dan.hicks\r\n2:16:47 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Powershell command complete. Results returned to global variable #global:psresult# and saved in Agent\'s Documents tab of server.   provaltech.com/dan.hicks\r\n2:16:35 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0011   Executing 64-bit Powershell command as System: "" -command "Set-VPNConnection -Name \'GNW VPN1\' -SplitTunneling $true -AllUserConnection" >"c://provaltech//psoutputtmp.txt"   provaltech.com/dan.hicks\r\n2:16:35 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0013   Sending output to global variable.   provaltech.com/dan.hicks\r\n2:16:35 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0008   Custom commands detected as Set-VPNConnection -Name \'GNW VPN1\' -SplitTunneling $true -AllUserConnection   provaltech.com/dan.hicks\r\n2:16:35 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0003   No powershell file variable detected.   provaltech.com/dan.hicks\r\n2:16:26 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0002   Powershell is present.   provaltech.com/dan.hicks\r\n2:16:23 pm 13-Jan-23   Endpoint VPN Configuration   WARNING: The currently selected encryption level requires EAP or MS-CHAPv2 logon security methods. Data encryption will not occur for PAP or CHAP.   provaltech.com/dan.hicks\r\n2:16:23 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)   Success THEN   provaltech.com/dan.hicks\r\n2:16:22 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Powershell command complete. Results returned to global variable #global:psresult# and saved in Agent\'s Documents tab of server.   provaltech.com/dan.hicks\r\n2:16:22 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Informational: GetFile command overwrote the server file C://Kaseya//UserProfiles//229175768944442//GetFiles//..//docs//psoutput.txt with the new contents from c://provaltech//psoutput.txt in THEN step 3.   provaltech.com/dan.hicks\r\n2:16:10 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0011   Executing 64-bit Powershell command as System: "" -command "Set-VPNConnection -Name \'GNW VPN1\' -ServerAddress \'vpn.groffnetworks.com\' -TunnelType \'L2TP\' -L2tpPsk \'9rbXUXxf3b6rjed\' -DnsSuffix \'groffnetworks.local\' -AuthenticationMethod \'PAP\' -EncryptionLevel \'Optional\' -AllUserConnection -Force" >"c://provaltech//psoutputtmp.txt"   provaltech.com/dan.hicks\r\n2:16:07 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0013   Sending output to global variable.   provaltech.com/dan.hicks\r\n2:16:07 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0008   Custom commands detected as Set-VPNConnection -Name \'GNW VPN1\' -ServerAddress \'vpn.groffnetworks.com\' -TunnelType \'L2TP\' -L2tpPsk \'9rbXUXxf3b6rjed\' -DnsSuffix \'groffnetworks.local\' -AuthenticationMethod \'PAP\' -EncryptionLevel \'Optional\' -AllUserConnection -Force   provaltech.com/dan.hicks\r\n2:16:07 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0003   No powershell file variable detected.   provaltech.com/dan.hicks\r\n2:16:01 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0002   Powershell is present.   provaltech.com/dan.hicks\r\n2:15:59 pm 13-Jan-23   Endpoint VPN Configuration       provaltech.com/dan.hicks\r\n2:15:59 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)   Success THEN   provaltech.com/dan.hicks\r\n2:15:57 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Powershell command complete. Results returned to global variable #global:psresult# and saved in Agent\'s Documents tab of server.   provaltech.com/dan.hicks\r\n2:15:56 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0016   Informational: GetFile command overwrote the server file C://Kaseya//UserProfiles//229175768944442//GetFiles//..//docs//psoutput.txt with the new contents from c://provaltech//psoutput.txt in THEN step 3.   provaltech.com/dan.hicks\r\n2:15:40 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0011   Executing 64-bit Powershell command as System: "" -command "Add-VPNConnection -Name \'GNW VPN1\' -ServerAddress \'vpn.groffnetworks.com\' -AllUserConnection -Force" >"c://provaltech//psoutputtmp.txt"   provaltech.com/dan.hicks\r\n2:15:40 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0013   Sending output to global variable.   provaltech.com/dan.hicks\r\n2:15:40 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0008   Custom commands detected as Add-VPNConnection -Name \'GNW VPN1\' -ServerAddress \'vpn.groffnetworks.com\' -AllUserConnection -Force   provaltech.com/dan.hicks\r\n2:15:40 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0003   No powershell file variable detected.   provaltech.com/dan.hicks\r\n2:15:33 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0002   Powershell is present.   provaltech.com/dan.hicks\r\n2:15:31 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)   Success THEN   provaltech.com/dan.hicks\r\n2:15:30 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0014   Powershell command completed!   provaltech.com/dan.hicks\r\n2:15:18 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0011   Executing 64-bit Powershell command as System: "" -command "Remove-VpnConnection -Name \'GNW VPN1\' -force -erroraction silentlycontinue" ""   provaltech.com/dan.hicks\r\n2:15:18 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0013   Not sending output to variable.   provaltech.com/dan.hicks\r\n2:15:18 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0008   Custom commands detected as Remove-VpnConnection -Name \'GNW VPN1\' -force -erroraction silentlycontinue   provaltech.com/dan.hicks\r\n2:15:18 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0003   No powershell file variable detected.   provaltech.com/dan.hicks\r\n2:15:11 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0002   Powershell is present.   provaltech.com/dan.hicks\r\n2:15:09 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)   Success THEN   provaltech.com/dan.hicks\r\n2:15:09 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0014   Powershell command completed!   provaltech.com/dan.hicks\r\n2:15:03 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0011   Executing 64-bit Powershell command as System: "" -command "New-Item -Type Directory -Path %ProgramData%//_automation//AgentProcedure -Name VpnSetup" ""   provaltech.com/dan.hicks\r\n2:15:03 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0013   Not sending output to variable.   provaltech.com/dan.hicks\r\n2:15:03 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0008   Custom commands detected as New-Item -Type Directory -Path %ProgramData%//_automation//AgentProcedure -Name VpnSetup   provaltech.com/dan.hicks\r\n2:15:03 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0003   No powershell file variable detected.   provaltech.com/dan.hicks\r\n2:14:52 pm 13-Jan-23   Execute Powershell Command (64-bit, Run As System)-0002   Powershell is present.   provaltech.com/dan.hicks\r\n2:14:39 pm 13-Jan-23   Run Now - Endpoint VPN Configuration   Admin provaltech.com/dan.hicks scheduled procedure Run Now - Endpoint VPN Configuration to run at Jan 13 2023 2:14PM  \n'})}),"\n",(0,s.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"vpnIcon.ico"})," saved to the environment's Managed Files directory"]}),"\n",(0,s.jsxs)(n.li,{children:["VPN Connection data from the client saved to Managed Variables:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_NAME"})," (string)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_SERVER_ADDRESS"})," (string: URI or IP address)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_SPLIT_TUNNEL_ENABLE"})," (1 or 0)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_L2TPPSK"})," (string: PSK)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_DNS_SUFFIX"})," (string: URI)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_REMEMBERCREDENTIAL"})," (1 or 0)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_CONNECTION_ROUTE_1"})," (string: IP address)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_CONNECTION_ROUTE_2"})," (string: IP address)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"VPN_CONNECTION_ROUTE_3"})," (string: IP address)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"process",children:"Process"}),"\n",(0,s.jsx)(n.p,{children:"Data must be manually populated in the Managed Variables for the endpoint's group before this procedure will be successful."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The agent procedure creates the directory to contain the shortcut icon."}),"\n",(0,s.jsx)(n.li,{children:"The agent procedure removes any currently existing AllUser scoped VPNs of the same name."}),"\n",(0,s.jsx)(n.li,{children:"The agent procedure creates the basic VPN object."}),"\n",(0,s.jsxs)(n.li,{children:["The agent procedure uses ",(0,s.jsx)(n.code,{children:"Set-VpnConnection"})," to set the properties of the connection, including any optional parameters flagged in the associated managed variables."]}),"\n",(0,s.jsxs)(n.li,{children:["The agent procedure sets the desktop shortcut using ",(0,s.jsx)(n.code,{children:"rasphone -d <VPN_NAME>"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"output",children:"Output"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"$env:SystemDrive//Users//Public//Desktop//<VPN_NAME>.lnk"})}),"\n",(0,s.jsx)(n.li,{children:"Agent Procedure log"}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var o=t(296540);const s={},r=o.createContext(s);function a(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);