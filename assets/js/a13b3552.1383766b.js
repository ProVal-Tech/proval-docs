"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[38167],{603255:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"cwa/monitors/18fd9d3f-f0cd-4040-b89f-ec059c405609","title":"RDS Hosts - Allow New Connections Status","description":"This document outlines the implementation steps for creating an alert template for Windows RDS Session Host using SQL queries. It includes detailed instructions on inserting roles, searches, groups, and remote monitors to effectively manage RDS servers.","source":"@site/docs/cwa/monitors/RDS Hosts - Allow New Connections Status.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/18fd9d3f-f0cd-4040-b89f-ec059c405609","permalink":"/docs/cwa/monitors/18fd9d3f-f0cd-4040-b89f-ec059c405609","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/RDS Hosts - Allow New Connections Status.md","tags":[{"inline":false,"label":"Database","permalink":"/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Windows","permalink":"/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"18fd9d3f-f0cd-4040-b89f-ec059c405609","title":"RDS Hosts - Allow New Connections Status","title_meta":"RDS Hosts - Allow New Connections Status","keywords":["sql","rds","monitor","alert","template","servers","group","connections"],"description":"This document outlines the implementation steps for creating an alert template for Windows RDS Session Host using SQL queries. It includes detailed instructions on inserting roles, searches, groups, and remote monitors to effectively manage RDS servers.","tags":["database","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Probe Detected Devices Missing Automate Agents","permalink":"/docs/cwa/monitors/02f3c288-d5e4-4b45-9020-e47f41a254af"},"next":{"title":"RSM - Active Directory- AD Account Lockout Detection","permalink":"/docs/cwa/monitors/de574ff4-5a24-4ccd-83d3-499b1b274893"}}');var s=o(474848),r=o(28453);const i={id:"18fd9d3f-f0cd-4040-b89f-ec059c405609",title:"RDS Hosts - Allow New Connections Status",title_meta:"RDS Hosts - Allow New Connections Status",keywords:["sql","rds","monitor","alert","template","servers","group","connections"],description:"This document outlines the implementation steps for creating an alert template for Windows RDS Session Host using SQL queries. It includes detailed instructions on inserting roles, searches, groups, and remote monitors to effectively manage RDS servers.",tags:["database","windows"],draft:!1,unlisted:!1},a=void 0,c={},l=[{value:"Implementation Steps",id:"implementation-steps",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"implementation-steps",children:"Implementation Steps"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Run this SQL query from a RAWSQL monitor to create the alert template."}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"# Insert Role\r\nINSERT IGNORE INTO `roledefinitions` (`RoleName`, `RoleType`, `RoleSubType`, `DetectionString`, `ComparisonOperator`, `ComparisonResult`, `SerialKeyString`, `ProductKeyString`, `RoleDetectionGuid`, `IsRemote`, `SearchId`, `IsSupport`, `ParentRoleDefinitionGuid`, `OsType`) VALUES ('Windows RDS Session Host', 'Remote Desktop Services', 'Role', '{%@powershell \\\"(Get-WindowsFeature RDS-RD-Server).Installed\\\"@%}', 'eq', 'True', '', '', '51b2cad8-14a3-11eb-bceb-0e924934e3ef', 1, 0, 0, '', 1);\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"# Insert Search\r\nINSERT IGNORE INTO `sensorchecks` (`SensID`, `Name`, `SQL`, `QueryType`, `ListDATA`, `FolderID`, `GUID`, `SearchXML`, `UpdatedBy`, `UpdateDate`) VALUES (1406, 'Windows RDS Session Host Servers', 'SELECT \\\\r\\\\n   computers.computerid as `Computer Id`,\\\\r\\\\n   [computers.name](http://computers.name) as `Computer Name`,\\\\r\\\\n   [clients.name](http://clients.name) as `Client Name`,\\\\r\\\\n   computers.domain as `Computer Domain`,\\\\r\\\\n   computers.username as `Computer User`,\\\\r\\\\n   IFNULL(crd1.RoleDefinitionId,0) as `Windows RDS Session Host-1`\\\\r\\\\nFROM Computers \\\\r\\\\nLEFT JOIN inv_operatingsystem ON (Computers.ComputerId=inv_operatingsystem.ComputerId)\\\\r\\\\nLEFT JOIN Clients ON (Computers.ClientId=Clients.ClientId)\\\\r\\\\nLEFT JOIN Locations ON (Computers.LocationId=Locations.LocationID)\\\\r\\\\nLEFT JOIN ComputerRoleDefinitions crd1 ON (crd1.ComputerId=Computers.ComputerId And crd1.RoleDefinitionId=(Select RoleDefinitionId From RoleDefinitions Where RoleDetectionGuid='51b2cad8-14a3-11eb-bceb-0e924934e3ef') And (crd1.Type=1 OR (crd1.CurrentlyDetected=1 and crd1.Type<>2)))\\\\r\\\\n WHERE \\\\r\\\\n((IFNULL(crd1.RoleDefinitionId,0) >0 ))\\\\r\\\\n', 4, 'Select||=||=||=|^Select|||||||^', 0, '33b86301-043d-4268-90cd-cd91965d3b56', '<LabTechAbstractSearch><asn><st>AndNode</st><cn><asn><st>ComparisonNode</st><lon>Computer.LabTech.Roles</lon><lok>Computer.LabTech.Roles</lok><lmo>HasRole</lmo><dv>Windows RDS Session Host</dv><dk>51b2cad8-14a3-11eb-bceb-0e924934e3ef</dk></asn></cn></asn></LabTechAbstractSearch>', NULL, NULL);\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"# Insert Group\r\nSET @Searchid = (SELECT sensid FROM sensorchecks WHERE `GUID` = '33b86301-043d-4268-90cd-cd91965d3b56');\r\nSET @Parentid = (SELECT MIN(groupid) FROM mastergroups WHERE `Name` = '_System Automation');\r\nSET @Parents = (SELECT CONCAT(',', MIN(groupid), ',') FROM mastergroups WHERE `Name` = '_System Automation');\r\nINSERT IGNORE INTO `mastergroups` (`GroupID`, `ParentID`, `Parents`, `Children`, `depth`, `Name`, `FullName`, `Permissions`, `Template`, `AutoJoinScript`, `Master`, `LimitToParent`, `Control`, `ControlID`, `Notes`, `MaintenanceID`, `MaintWindowApplied`, `GroupType`, `Priority`, `GUID`, `assetID`, `NetworkPermissions`, `NetworkJoin`, `NetworkJoinOptions`, `ContactPermissions`, `ContactJoin`, `ContactJoinOptions`) VALUES ('', @Parentid, '@Parents', ',', 1, 'Windows RDS Session Host Servers', '_System [Automation.Windows](http://automation.Windows) RDS Session Host Servers', 0, 0, @Searchid, 2, 1, 0, 0, '', 0, (NOW()), 4, 5, '86d05b2b-4bd2-11ee-955e-000c295e5f21', NULL, NULL, 0, 0, NULL, 0, 0);\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"# Insert Remote Monitor\r\nSET @Groupid = (SELECT Groupid FROM MasterGroups WHERE `GUID` = '86d05b2b-4bd2-11ee-955e-000c295e5f21');\r\nSET @Alertaction = (SELECT alertactionid FROM alerttemplate WHERE `GUID` = 'b69f8015-501e-4781-9e42-e23e0058bcd4');\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"INSERT IGNORE INTO `groupagents` (`AgentID`, `GroupID`, `SearchID`, `Name`, `CheckAction`, `AlertAction`, `AlertMessage`, `ContactID`, `interval`, `Where`, `What`, `DataOut`, `Comparor`, `DataIn`, `IDField`, `AlertStyle`, `ScriptID`, `datacollector`, `Category`, `TicketCategory`, `ScriptTarget`, `GUID`, `UpdatedBy`, `UpdateDate`) VALUES ('', @Groupid, 0, 'RDS Hosts - Allow New Connections Status', 6, 1, 'Allow New Connections is set to FALSE on RDS Server \\\"%computername%\\\" of Client: %clientname%~~~%NAME% %STATUS% on %CLIENTNAME%\\\\\\\\%COMPUTERNAME% at %LOCATIONNAME% for %FIELDNAME% result %RESULT%.!!!Allow New Connections is set to FALSE on RDS Server \\\"%computername%\\\" of Client: %clientname%~~~%NAME% %STATUS% on %CLIENTNAME%\\\\\\\\%COMPUTERNAME% at %LOCATIONNAME% for %FIELDNAME% result %RESULT%.', 0, 600, '127.0.0.1', '7', 'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -ExecutionPolicy Bypass -Command \\\"$rdshSettings = Get-CimInstance -Namespace \\'root\\\\CIMv2\\\\TerminalServices\\' -Class Win32_TerminalServiceSetting -ComputerName \\\"$env:computername\\\";$allowNewConnections = $rdshSettings.AllowTSConnections;$allowNewConnections;if ($allowNewConnections -eq $false) {Write-Output \\'Allow new connections is set to FALSE on $env:computername\\'} else {Write-Output \\'Allow new connections is NOT set to FALSE on $env:computername\\'}\"', 5, 'Allow new connections is NOT set to FALSE', '', 1, 0, '', 16, 0, 1, '52107a52-7a5b-4cc6-84ff-47ed9b68043c', 'root', (NOW());\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Note: This implementation step will create a role ",(0,s.jsx)(t.a,{href:"/docs/cwa/roles/2383fd5a-aee3-4644-8bea-c05af3f3d320",children:"RSM - Remote Desktop Services - Role - Windows RDS Session Host"}),', a search "Windows RDS Session Host Servers" bound with the above role, a group named "Windows RDS Session Host Servers" limited to the above search, and lastly, the remote monitor ',(0,s.jsx)(t.a,{href:"https://proval.itglue.com/DOC-5078775-13810738",children:"RDS Hosts - Allow New Connections Status"}),' will be created on the group with the alert template "Default - Do Nothing".']}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Image",src:o(905026).A+"",width:"1000",height:"383"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:'This needs to be changed to the "Default - Create Automate Ticket" or any other template that the client needs, such as emailing or ticket creation.'}),"\n"]})]})}function m(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},905026:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/image_1-22fa6203e47e72e7b3ad810ecd10afca.png"},28453:(e,t,o)=>{o.d(t,{R:()=>i,x:()=>a});var n=o(296540);const s={},r=n.createContext(s);function i(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);