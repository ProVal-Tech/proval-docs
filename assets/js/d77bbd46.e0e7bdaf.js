"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[14159],{482667:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"cwa/scripts/6344993b-3e75-4bfe-9e28-a7548a14243e","title":"AD - Update Users Email from Automate Contacts User Centric","description":"This document details a script designed to update Active Directory users\' email addresses by matching them with contacts in Automate, facilitating user-centric billing and ensuring accurate email synchronization. The script operates specifically on Domain Controllers and includes a SQL query to retrieve necessary contact information.","source":"@site/docs/cwa/scripts/AD - Update Users Email from Automate Contacts User Centric.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/6344993b-3e75-4bfe-9e28-a7548a14243e","permalink":"/docs/cwa/scripts/6344993b-3e75-4bfe-9e28-a7548a14243e","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/AD - Update Users Email from Automate Contacts User Centric.md","tags":[{"inline":false,"label":"Active Directory","permalink":"/docs/tags/active-directory","description":"Documents related to Active Directory services and management"},{"inline":false,"label":"Database","permalink":"/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Security","permalink":"/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Setup","permalink":"/docs/tags/setup","description":"Documents on setting up software and hardware configurations"}],"version":"current","frontMatter":{"id":"6344993b-3e75-4bfe-9e28-a7548a14243e","title":"AD - Update Users Email from Automate Contacts User Centric","title_meta":"AD - Update Users Email from Automate Contacts User Centric","keywords":["ad","email","automate","billing","sync"],"description":"This document details a script designed to update Active Directory users\' email addresses by matching them with contacts in Automate, facilitating user-centric billing and ensuring accurate email synchronization. The script operates specifically on Domain Controllers and includes a SQL query to retrieve necessary contact information.","tags":["active-directory","database","security","setup"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"AD - Set DNS Aging and Scavenging","permalink":"/docs/cwa/scripts/90969a29-db33-4332-babb-c2f5be128a3e"},"next":{"title":"AD Email User about Password Expiration","permalink":"/docs/cwa/scripts/8ed6ff40-38c6-4e23-b6ea-2627ed9d49a8"}}');var a=i(474848),n=i(28453);const r={id:"6344993b-3e75-4bfe-9e28-a7548a14243e",title:"AD - Update Users Email from Automate Contacts User Centric",title_meta:"AD - Update Users Email from Automate Contacts User Centric",keywords:["ad","email","automate","billing","sync"],description:"This document details a script designed to update Active Directory users' email addresses by matching them with contacts in Automate, facilitating user-centric billing and ensuring accurate email synchronization. The script operates specifically on Domain Controllers and includes a SQL query to retrieve necessary contact information.",tags:["active-directory","database","security","setup"],draft:!1,unlisted:!1},c=void 0,o={},l=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Variables",id:"variables",level:2},{value:"Process",id:"process",level:2},{value:"Output",id:"output",level:2}];function d(e){const t={br:"br",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(t.p,{children:["This script is designed to update AD users whose email addresses have not been entered to match, by name, with contacts in Automate. The purpose is related to user-centric billing so that email addresses can be used to sync users based on the email field.",(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.strong,{children:"Time Saved by Automation:"})," 5 Minutes"]}),"\n",(0,a.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Target:"})," Domain Controllers",(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.img,{alt:"Sample Run",src:i(749465).A+"",width:"481",height:"347"})]}),"\n",(0,a.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,a.jsx)(t.p,{children:"If billing in CW Manage is not being performed via user-centric methods, this script may not provide any benefits."}),"\n",(0,a.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"@LoopCounter@"})," - This variable is used as part of the SQL data loop that will gather the data by user so it can be inserted into AD."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"@SQLName@"})," - This variable is determined by the SQL query in the scripting loop and is the first and last name of the target user account that will have its email address updated."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"@sqlemail@"})," - This variable is determined by the SQL query in the scripting loop and is the email address that will be pushed into the user's AD account."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"process",children:"Process"}),"\n",(0,a.jsx)(t.p,{children:"This script is targeted for Domain Controllers only! The initial check will cause the script to fail if it is not run against a Domain Controller."}),"\n",(0,a.jsx)(t.p,{children:"The script will first start a SQL scripting loop and gather data by running the SQL query:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"SELECT contactid, CONCAT(firstname, ' ', lastname) AS name, email FROM contacts WHERE email != '' AND clientid = %clientid%\n"})}),"\n",(0,a.jsx)(t.p,{children:"This query will grab the ContactID, the first and last name, and the email address of contacts in Automate, provided the contact isn't missing an email address and the client ID of the contact matches the client ID of the domain controller in Automate."}),"\n",(0,a.jsx)(t.p,{children:"From there, the script will go user account by user account and fill out the email address field in AD. The script then runs the following PowerShell:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'Import-Module ActiveDirectory; Get-ADUser -Filter \'Name -like "@sqlname@"\' | Set-ADUser -EmailAddress "@sqlemail@"\n'})}),"\n",(0,a.jsx)(t.p,{children:"This PowerShell command will import the AD module if it is not already present, retrieve the user's first and last name, and then set the user's email address based on the earlier SQL query."}),"\n",(0,a.jsxs)(t.p,{children:["The script will then verify if there were any errors during the PowerShell run; it will log the information in the error log or exit with success.",(0,a.jsx)(t.br,{}),"\n",(0,a.jsx)(t.strong,{children:"NOTE:"})," The script will continue after an error and attempt to update the next record in the SQL loop."]}),"\n",(0,a.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,a.jsx)(t.p,{children:"Script log messages only."})]})}function m(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},749465:(e,t,i)=>{i.d(t,{A:()=>s});const s=i.p+"assets/images/image_1-5d7f52e029151262d944ff8964d0201c.png"},28453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>c});var s=i(296540);const a={},n=s.createContext(a);function r(e){const t=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);