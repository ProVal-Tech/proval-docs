"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[33683],{181469:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"cwa/monitors/Unresponsive Huntress Agents-implementation","title":"Unresponsive Huntress Agents-implementation","description":"1. Import the Alert Template \'\u25b3 Custom - Ticket Creation - Computer [Failures Only]\'.","source":"@site/docs/cwa/monitors/Unresponsive Huntress Agents-implementation.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/Unresponsive Huntress Agents-implementation","permalink":"/docs/cwa/monitors/Unresponsive Huntress Agents-implementation","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/Unresponsive Huntress Agents-implementation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"contentSidebar","previous":{"title":"Unquoted Service Paths Detection","permalink":"/docs/cwa/monitors/ab811d99-365c-4ad7-84dd-3ff8575d5b15"},"next":{"title":"Unresponsive Huntress Agents","permalink":"/docs/cwa/monitors/3c75f8e7-6237-4349-97bb-462fe8d70b54"}}');var s=t(474848),a=t(28453);const o={},i=void 0,c={},d=[];function R(e){const n={code:"code",li:"li",ol:"ol",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Import the Alert Template '\u25b3 Custom - Ticket Creation - Computer [Failures Only]'."}),"\n",(0,s.jsx)(n.li,{children:"Run this SQL query from a RAWSQL monitor set to import the required search"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"INSERT INTO `sensorchecks` \r\nSELECT \r\n'' AS `SensID`,\r\n'ProVal - Machines with Huntress Agent' AS `Name`, \r\n'SELECT \\n   computers.computerid as `Computer Id`,\\n   computers.name as `Computer Name`,\\n   clients.name as `Client Name`,\\n   computers.domain as `Computer Domain`,\\n   computers.username as `Computer User`,\\n   Software.Name as `Computer.Applications.Name`,\\n   inv_operatingsystem.name as `Computer.OS.Name`\\nFROM Computers \\nLEFT JOIN inv_operatingsystem ON (Computers.ComputerId=inv_operatingsystem.ComputerId)\\nLEFT JOIN Clients ON (Computers.ClientId=Clients.ClientId)\\nLEFT JOIN Locations ON (Computers.LocationId=Locations.LocationID)\\nLEFT JOIN Software ON (Software.ComputerId = Computers.ComputerId)\\n WHERE \\n((((Software.Name = \\'Huntress Agent\\') AND (Instr(inv_operatingsystem.name,\\'Windows\\') > 0))))\\n' AS `SQL`,\r\n'4' AS `QueryType`,\r\n'Select||=||=||=|^Select|||||||^' AS `ListData`,\r\n'0' AS `FolderID`,\r\n'f7b8ea5a-235d-11ef-9836-8600008a66b7' AS `GUID`,\r\n'<LabTechAbstractSearch><asn><st>AndNode</st><cn><asn><st>AndNode</st><cn><asn><st>ComparisonNode</st><lon>Computer.Applications.Name</lon><lok>Computer.Applications.Name</lok><lmo>Equals</lmo><dv>Huntress Agent</dv><dk>Huntress Agent</dk></asn><asn><st>ComparisonNode</st><lon>Computer.OS.Name</lon><lok>Computer.OS.Name</lok><lmo>Contains</lmo><dv>Windows</dv><dk>Windows</dk></asn></cn></asn></cn></asn></LabTechAbstractSearch>' AS `SearchXML`,\r\n(NULL) AS `UpdatedBy`,\r\n(NULL) AS `UpdateDate`\r\nFROM  (SELECT MIN(computerid) FROM computers) a\r\nWHERE (SELECT COUNT(*) FROM SensorChecks WHERE `GUID` = 'f7b8ea5a-235d-11ef-9836-8600008a66b7') = 0 ;\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Obtain the groupid(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,s.jsxs)(n.li,{children:["Copy the following query and replace 'YOUR COMMA SEPARATED LIST OF GROUPID(S)' with the Groupid(s) of the relevant groups: (The string to replace can be found at the very bottom of the query, right after ",(0,s.jsx)(n.code,{children:"WHERE"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SET @searchid = (SELECT sensid FROM sensorchecks WHERE `GUID` = 'f7b8ea5a-235d-11ef-9836-8600008a66b7');\r\n\r\nINSERT INTO groupagents \r\n SELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n@searchid as `SearchID`,\r\n'ProVal - Production - Unresponsive Huntress Agents' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'Unresponsive Huntress Agent Detected on %COMPUTERNAME%~~~Huntress Agent is not orphaned anymore.!!!Unresponsive Huntress Agent Detected on %COMPUTERNAME%~~~The machine %computername% located at %clientname%\\\\%locationname% is currently reporting its huntress agent has been orphaned. This means the agent has not been able to communicate with Huntress for over 30 days and its license key has been revoked by huntress and may no longer be performing security functions on the machine. Please validate the agent is communicating with Huntress and if it is not, re-install the application to resolve the issue.' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'86400' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -ExecutionPolicy ByPass -Command \"$ErroractionPreference= \\'SilentlyContinue\\'; if (Test-Path \\'C:\\\\Program Files\\\\Huntress\\\\HuntressAgent.log\\') {$Path = \\'C:\\\\Program Files\\\\Huntress\\\\HuntressAgent.log\\'} elseif (Test-Path \\'C:\\\\Program Files (x86)\\\\Huntress\\\\HuntressAgent.log\\') {$Path = \\'C:\\\\Program Files (x86)\\\\Huntress\\\\HuntressAgent.log\\'} else {$Path = \\'Huntress Log File Missing\\'}; if ($Path -notmatch \\'HuntressAgent.log\\') {Write-Output $Path} else {$Log = Get-Content $Path | ForEach-Object { if ($_ -match \\'(?<time>\\\\d+-\\\\d+-\\\\d+T\\\\d+:\\\\d+:\\\\d+-\\\\d+:\\\\d+).+(?<level>(?<=level=)\\\\w+).+(?<msg>(?<=msg=).*)\\') {$Matches.Remove(0); [PSCustomObject]$Matches}} | Where-Object {$_.level -match \\'error\\' -and $_.msg -match \\'status code:401\\'}; if ($Log.count -ge 1) {Write-Output \\'Huntress Agent is orphaned. Please uninstall and reinstall\\'} else {Write-Output \\'Huntress Agent is not Orphaned\\'}}\"' as `DataOut`,\r\n'16' as `Comparor`,\r\n'10|Huntress Agent is not Orphaned%7C^$|11|Huntress Log File Missing%7CHuntress Agent is orphaned%7CHuntress Agent is not Orphaned|10|Huntress Log File Missing%7CHuntress Agent is orphaned' as `DataIn`,\r\n'' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'21' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))\r\nAND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Unresponsive Huntress Agents')\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"An example of the query with groupids and modified thresholds."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SET @searchid = (SELECT sensid FROM sensorchecks WHERE `GUID` = 'f7b8ea5a-235d-11ef-9836-8600008a66b7');\r\n\r\nINSERT INTO groupagents \r\n SELECT '' as `AgentID`,\r\n`groupid` as `GroupID`,\r\n@searchid as `SearchID`,\r\n'ProVal - Production - Unresponsive Huntress Agents' as `Name`,\r\n'6' as `CheckAction`,\r\n'1' as `AlertAction`,\r\n'Unresponsive Huntress Agent Detected on %COMPUTERNAME%~~~Huntress Agent is not orphaned anymore.!!!Unresponsive Huntress Agent Detected on %COMPUTERNAME%~~~The machine %computername% located at %clientname%\\\\%locationname% is currently reporting its huntress agent has been orphaned. This means the agent has not been able to communicate with Huntress for over 30 days and its license key has been revoked by huntress and may no longer be performing security functions on the machine. Please validate the agent is communicating with Huntress and if it is not, re-install the application to resolve the issue.' as `AlertMessage`,\r\n'0' as `ContactID`,\r\n'86400' as `interval`,\r\n'127.0.0.1' as `Where`,\r\n'7' as `What`,\r\n'C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -ExecutionPolicy ByPass -Command \"$ErroractionPreference= \\'SilentlyContinue\\'; if (Test-Path \\'C:\\\\Program Files\\\\Huntress\\\\HuntressAgent.log\\') {$Path = \\'C:\\\\Program Files\\\\Huntress\\\\HuntressAgent.log\\'} elseif (Test-Path \\'C:\\\\Program Files (x86)\\\\Huntress\\\\HuntressAgent.log\\') {$Path = \\'C:\\\\Program Files (x86)\\\\Huntress\\\\HuntressAgent.log\\'} else {$Path = \\'Huntress Log File Missing\\'}; if ($Path -notmatch \\'HuntressAgent.log\\') {Write-Output $Path} else {$Log = Get-Content $Path | ForEach-Object { if ($_ -match \\'(?<time>\\\\d+-\\\\d+-\\\\d+T\\\\d+:\\\\d+:\\\\d+-\\\\d+:\\\\d+).+(?<level>(?<=level=)\\\\w+).+(?<msg>(?<=msg=).*)\\') {$Matches.Remove(0); [PSCustomObject]$Matches}} | Where-Object {$_.level -match \\'error\\' -and $_.msg -match \\'status code:401\\'}; if ($Log.count -ge 1) {Write-Output \\'Huntress Agent is orphaned. Please uninstall and reinstall\\'} else {Write-Output \\'Huntress Agent is not Orphaned\\'}}\"' as `DataOut`,\r\n'16' as `Comparor`,\r\n'10|Huntress Agent is not Orphaned%7C^$|11|Huntress Log File Missing%7CHuntress Agent is orphaned%7CHuntress Agent is not Orphaned|10|Huntress Log File Missing%7CHuntress Agent is orphaned' as `DataIn`,\r\n'' as `IDField`,\r\n'1' as `AlertStyle`,\r\n'0' as `ScriptID`,\r\n'' as `datacollector`,\r\n'21' as `Category`,\r\n'0' as `TicketCategory`,\r\n'1' as `ScriptTarget`,\r\nCONCAT(\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n'-',\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\nSUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n'root' as `UpdatedBy`,\r\n(NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (536.421)\r\nAND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Unresponsive Huntress Agents')\n"})})]})}function l(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(R,{...e})}):R(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var r=t(296540);const s={},a=r.createContext(s);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);