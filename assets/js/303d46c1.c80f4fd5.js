"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[44241],{289517:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>c,default:()=>R,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"cwa/monitors/5e1d98fb-913a-4384-9674-653c57bf610b","title":"Import- Security event logs cleareddeleted","description":"This document provides a step-by-step guide to setting up a remote monitor for security event logs in ConnectWise Automate. It includes obtaining group IDs, constructing SQL queries, and applying alert templates for effective monitoring.","source":"@site/docs/cwa/monitors/Import- Security event logs cleareddeleted.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/5e1d98fb-913a-4384-9674-653c57bf610b","permalink":"/proval-docs/docs/cwa/monitors/5e1d98fb-913a-4384-9674-653c57bf610b","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/Import- Security event logs cleareddeleted.md","tags":[{"inline":false,"label":"Database","permalink":"/proval-docs/docs/tags/database","description":"Documents related to database management systems and operations"},{"inline":false,"label":"Security","permalink":"/proval-docs/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Setup","permalink":"/proval-docs/docs/tags/setup","description":"Documents on setting up software and hardware configurations"}],"version":"current","frontMatter":{"id":"5e1d98fb-913a-4384-9674-653c57bf610b","title":"Import- Security event logs cleareddeleted","title_meta":"Import- Security event logs cleareddeleted","keywords":["remote","monitor","security","event","logs","setup"],"description":"This document provides a step-by-step guide to setting up a remote monitor for security event logs in ConnectWise Automate. It includes obtaining group IDs, constructing SQL queries, and applying alert templates for effective monitoring.","tags":["database","security","setup"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Import- NTLMv1.1 Detection","permalink":"/proval-docs/docs/cwa/monitors/92ad2db8-528e-4bce-8011-ed0e3563e335"},"next":{"title":"Import- TLS Version Check - Client","permalink":"/proval-docs/docs/cwa/monitors/a2436d9b-83e4-4405-a3e1-dc4019438d3a"}}');var a=r(474848),s=r(28453);const o={id:"5e1d98fb-913a-4384-9674-653c57bf610b",title:"Import- Security event logs cleareddeleted",title_meta:"Import- Security event logs cleareddeleted",keywords:["remote","monitor","security","event","logs","setup"],description:"This document provides a step-by-step guide to setting up a remote monitor for security event logs in ConnectWise Automate. It includes obtaining group IDs, constructing SQL queries, and applying alert templates for effective monitoring.",tags:["database","security","setup"],draft:!1,unlisted:!1},c=void 0,i={},d=[{value:"Step 1",id:"step-1",level:2},{value:"Step 2",id:"step-2",level:2},{value:"Step 3",id:"step-3",level:2},{value:"Step 4",id:"step-4",level:2},{value:"Step 5",id:"step-5",level:2},{value:"Step 6",id:"step-6",level:2},{value:"Step 7",id:"step-7",level:2}];function l(e){const t={br:"br",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"step-1",children:"Step 1"}),"\n",(0,a.jsx)(t.p,{children:"Obtain the group ID(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,a.jsx)(t.h2,{id:"step-2",children:"Step 2"}),"\n",(0,a.jsxs)(t.p,{children:["Copy the following query and replace ",(0,a.jsx)(t.strong,{children:"YOUR COMMA SEPARATED LIST OF GROUPID(S)"})," with the group ID(s) of the relevant groups:",(0,a.jsx)(t.br,{}),"\n","(The string to replace can be found at the very bottom of the query, right after ",(0,a.jsx)(t.strong,{children:"WHERE"}),")"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"INSERT INTO groupagents \r\n SELECT '' as `AgentID`,\r\n `groupid` as `GroupID`,\r\n '0' as `SearchID`,\r\n 'Proval - Production - Security event logs cleared/deleted' as `Name`,\r\n '6' as `CheckAction`,\r\n '1' as `AlertAction`,\r\n 'Security Event Log Cleared on %CLIENTNAME%//%COMPUTERNAME%~~~Security Event logs cleared/deleted for %CLIENTNAME%//%COMPUTERNAME%: %Result%!!!Security Event Log Cleared on %CLIENTNAME%//%COMPUTERNAME%~~~Security Event logs cleared/deleted for %CLIENTNAME%//%COMPUTERNAME%: %Result%' as `AlertMessage`,\r\n '0' as `ContactID`,\r\n '900' as `interval`,\r\n '127.0.0.1' as `Where`,\r\n '7' as `What`,\r\n 'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$op = @(); $op = ((Get-Eventlog security -erroraction silentlycontinue -After (Get-Date).AddMinutes(-15) -InstanceId 1102 | select-object timewritten,message)|foreach-object{$_.timewritten;($_.message -split /'Additional Information:/'|select -first 1)-split /'Account Name:/'|select-object -last 1}); if ($op) { write-output /\\\"`nEventid 1102 detected in the last 15 Minutes:`n/\\\"; $op}\\\"' as `DataOut`,\r\n '16' as `Comparor`,\r\n '10|((^((OK){0,}(//r//n){0,}[//r//n]{0,}//s{0,})$)%7C(^$))|11|((^((OK){0,}(//r//n){0,}[//r//n]{0,}//s{0,})$)%7C(^$))%7C(^((//r//n){0,}[//r//n]{0,}//s{0,})Eventid 1102 detected in the last 15 Minutes:)|10|^((//r//n){0,}[//r//n]{0,}//s{0,})Eventid 1102 detected in the last 15 Minutes:' as `DataIn`,\r\n '' as `IDField`,\r\n '0' as `AlertStyle`,\r\n '0' as `ScriptID`,\r\n '' as `datacollector`,\r\n '21' as `Category`,\r\n '0' as `TicketCategory`,\r\n '1' as `ScriptTarget`,\r\n CONCAT(\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n 'root' as `UpdatedBy`,\r\n (NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (**YOUR COMMA SEPARATED LIST OF GROUPID(S)**)\r\nAND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'Proval - Production - Security event logs cleared/deleted')\n"})}),"\n",(0,a.jsx)(t.h2,{id:"step-3",children:"Step 3"}),"\n",(0,a.jsx)(t.p,{children:"An example of a query with group IDs:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"INSERT INTO groupagents \r\n SELECT '' as `AgentID`,\r\n `groupid` as `GroupID`,\r\n '0' as `SearchID`,\r\n 'Proval - Production - Security event logs cleared/deleted' as `Name`,\r\n '6' as `CheckAction`,\r\n '1' as `AlertAction`,\r\n 'Security Event Log Cleared on %CLIENTNAME%//%COMPUTERNAME%~~~Security Event logs cleared/deleted for %CLIENTNAME%//%COMPUTERNAME%: %Result%!!!Security Event Log Cleared on %CLIENTNAME%//%COMPUTERNAME%~~~Security Event logs cleared/deleted for %CLIENTNAME%//%COMPUTERNAME%: %Result%' as `AlertMessage`,\r\n '0' as `ContactID`,\r\n '900' as `interval`,\r\n '127.0.0.1' as `Where`,\r\n '7' as `What`,\r\n 'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$op = @(); $op = ((Get-Eventlog security -erroraction silentlycontinue -After (Get-Date).AddMinutes(-15) -InstanceId 1102 | select-object timewritten,message)|foreach-object{$_.timewritten;($_.message -split /'Additional Information:/'|select -first 1)-split /'Account Name:/'|select-object -last 1}); if ($op) { write-output /\\\"`nEventid 1102 detected in the last 15 Minutes:`n/\\\"; $op}\\\"' as `DataOut`,\r\n '16' as `Comparor`,\r\n '10|((^((OK){0,}(//r//n){0,}[//r//n]{0,}//s{0,})$)%7C(^$))|11|((^((OK){0,}(//r//n){0,}[//r//n]{0,}//s{0,})$)%7C(^$))%7C(^((//r//n){0,}[//r//n]{0,}//s{0,})Eventid 1102 detected in the last 15 Minutes:)|10|^((//r//n){0,}[//r//n]{0,}//s{0,})Eventid 1102 detected in the last 15 Minutes:' as `DataIn`,\r\n '' as `IDField`,\r\n '0' as `AlertStyle`,\r\n '0' as `ScriptID`,\r\n '' as `datacollector`,\r\n '21' as `Category`,\r\n '0' as `TicketCategory`,\r\n '1' as `ScriptTarget`,\r\n CONCAT(\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n '-',\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n) as `GUID`,\r\n 'root' as `UpdatedBy`,\r\n (NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (2,3,855,856)\r\nAND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'Proval - Production - Security event logs cleared/deleted')\n"})}),"\n",(0,a.jsx)(t.h2,{id:"step-4",children:"Step 4"}),"\n",(0,a.jsx)(t.p,{children:"Now execute your query from a RAWSQL monitor set."}),"\n",(0,a.jsx)(t.h2,{id:"step-5",children:"Step 5"}),"\n",(0,a.jsx)(t.p,{children:"Locate your remote monitor by opening the group(s) remote monitors tab."}),"\n",(0,a.jsx)(t.h2,{id:"step-6",children:"Step 6"}),"\n",(0,a.jsx)(t.p,{children:"Limit the remote monitor to a search, if necessary."}),"\n",(0,a.jsx)(t.h2,{id:"step-7",children:"Step 7"}),"\n",(0,a.jsx)(t.p,{children:"Apply the appropriate alert template to the remote monitors."})]})}function R(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},28453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>c});var n=r(296540);const a={},s=n.createContext(a);function o(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);