"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[33911],{348074:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>R,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"cwa/monitors/662b2faa-c7f5-4c96-bbbe-f1878ddb8aa3","title":"ProVal - Production - CPU Threshold Violation Monitor","description":"This document provides a step-by-step guide on how to apply a remote monitor for CPU threshold violations in ConnectWise Automate. It includes instructions on obtaining group IDs, constructing SQL queries, and executing them to set up alerts for high CPU usage.","source":"@site/docs/cwa/monitors/ProVal - Production - CPU Threshold Violation Monitor.md","sourceDirName":"cwa/monitors","slug":"/cwa/monitors/662b2faa-c7f5-4c96-bbbe-f1878ddb8aa3","permalink":"/proval-docs/docs/cwa/monitors/662b2faa-c7f5-4c96-bbbe-f1878ddb8aa3","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/monitors/ProVal - Production - CPU Threshold Violation Monitor.md","tags":[{"inline":false,"label":"ConnectWise","permalink":"/proval-docs/docs/tags/connectwise","description":"Documents on ConnectWise platforms for IT service management"},{"inline":false,"label":"CPU","permalink":"/proval-docs/docs/tags/cpu","description":"Documents related to central processing units and their performance"},{"inline":false,"label":"SQL","permalink":"/proval-docs/docs/tags/sql","description":"Documents discussing Structured Query Language and database interactions"}],"version":"current","frontMatter":{"id":"662b2faa-c7f5-4c96-bbbe-f1878ddb8aa3","title":"ProVal - Production - CPU Threshold Violation Monitor","title_meta":"ProVal - Production - CPU Threshold Violation Monitor","keywords":["remote","monitor","cpu","threshold","alert"],"description":"This document provides a step-by-step guide on how to apply a remote monitor for CPU threshold violations in ConnectWise Automate. It includes instructions on obtaining group IDs, constructing SQL queries, and executing them to set up alerts for high CPU usage.","tags":["connectwise","cpu","sql"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"ProVal - NonStack - Multiple Antivirus","permalink":"/proval-docs/docs/cwa/monitors/c9183b6d-95a8-409a-9d04-e85611bf04d2"},"next":{"title":"ProVal - Production - Disable AI Recall","permalink":"/proval-docs/docs/cwa/monitors/3a5d036a-dcc5-4e6e-9962-92309891a4ec"}}');var o=t(474848),a=t(28453);const s={id:"662b2faa-c7f5-4c96-bbbe-f1878ddb8aa3",title:"ProVal - Production - CPU Threshold Violation Monitor",title_meta:"ProVal - Production - CPU Threshold Violation Monitor",keywords:["remote","monitor","cpu","threshold","alert"],description:"This document provides a step-by-step guide on how to apply a remote monitor for CPU threshold violations in ConnectWise Automate. It includes instructions on obtaining group IDs, constructing SQL queries, and executing them to set up alerts for high CPU usage.",tags:["connectwise","cpu","sql"],draft:!1,unlisted:!1},i=void 0,c={},l=[{value:"Step 1",id:"step-1",level:2},{value:"Step 2",id:"step-2",level:2},{value:"Step 3",id:"step-3",level:2},{value:"Step 4",id:"step-4",level:2},{value:"Step 5",id:"step-5",level:2}];function d(e){const r={br:"br",code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.h2,{id:"step-1",children:"Step 1"}),"\n",(0,o.jsx)(r.p,{children:"Obtain the group ID(s) of the group(s) that the remote monitor should be applied to."}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"step-2",children:"Step 2"}),"\n",(0,o.jsxs)(r.p,{children:["Copy the following query and replace ",(0,o.jsx)(r.strong,{children:"YOUR COMMA SEPARATED LIST OF GROUPID(S)"})," with the Group ID(s) of the relevant groups:",(0,o.jsx)(r.br,{}),"\n","(The string to replace can be found at the very bottom of the query, right after ",(0,o.jsx)(r.strong,{children:"WHERE"}),")"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"INSERT INTO groupagents \r\n  SELECT '' as `AgentID`,\r\n  `groupid` as `GroupID`,\r\n  '0' as `SearchID`,\r\n  'ProVal - Production - CPU Threshold Violation Monitor' as `Name`,\r\n  '6' as `CheckAction`,\r\n  '1' as `AlertAction`,\r\n  'CPU Usage High on %Computername% at %locationname%~~~This is an automated update to inform you that the high CPU utilization issue reported earlier has now been resolved. The system has detected that the CPU usage has returned to normal and the performance has improved.\r\n  !!!CPU Usage High on %Computername% at %locationname%~~~The CPU usage on the machine %computername% located at %clientname%//%locationname% is currently reporting high CPU usage. Please investigate the issue and take appropriate actions to address the root cause. As per the severity of the issue, it is recommended to prioritize this ticket accordingly.\r\n  %RESULT%' as `AlertMessage`,\r\n  '0' as `ContactID`,\r\n  '600' as `interval`,\r\n  '127.0.0.1' as `Where`,\r\n  '7' as `What`,\r\n  'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= /'SilentlyContinue/';$tl = 70;$th = 85;$m = //\\\"$env:TEMP//cpu_over_t//\\\";$t = $( if (Test-Path $m) { $tl } else { $th } );sal gpc /'Get-Counter/';$c = gpc /'//Processor Information(_Total)//% Processor Time/' -SampleInterval 1 -MaxSamples 10;$cu = $c.CounterSamples.CookedValue | Measure -Average | Select -exp Average;if ($t -le $cu) {Write-Output //\\\"Total CPU Usage: $([Math]::Round($cu,2))%`n`nTop 5 Processes utilizing CPU://\\\";$null > $m; $Obj = @((gpc /'//Process(*)//% Processor Time/').CounterSamples |Where { $_.InstanceName -notin (/'_total/',/'idle/') } | Group InstanceName | % {[PSCustomObject]@{ InstanceName = $_.Name; CookedValue = ($_.Group | Measure -Property CookedValue -Sum).Sum } } | Sort -Property CookedValue -Descending | Select @{l = /'Process/'; e = { $_.InstanceName } }, @{l = /'CPUUsage/'; e = { [math]::Round(($_.CookedValue) / [System.Environment]::ProcessorCount, 2) } } -First 5); $obj; if($obj.process -match /'powershell/') {Write-Output //\\\"`nPowerShell Process Command Line:`n//\\\"; (Get-Ciminstance -Class Win32_Process -Filter //\\\"Name = /'powershell.exe/'//\\\" | Where-Object {$_.ProcessID -ne $pid}).Commandline}} else { Remove-Item $m }\\\"' as `DataOut`,\r\n  '16' as `Comparor`,\r\n  '10|(^(//r//n%7COK)$)%7C(^$)|11|(Total CPU Usage: [0-9.]{1,6}%25)%7C(^(//r//n%7COK)$)%7C(^$)|10|Total CPU Usage: [0-9.]{1,6}%25' as `DataIn`,\r\n  '0' as `IDField`,\r\n  '1' as `AlertStyle`,\r\n  '0' as `ScriptID`,\r\n  '' as `datacollector`,\r\n  '21' as `Category`,\r\n  '0' as `TicketCategory`,\r\n  '1' as `ScriptTarget`,\r\n  CONCAT(\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n  ) as `GUID`,\r\n  'root' as `UpdatedBy`,\r\n  (NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))\r\nAND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - CPU Threshold Violation Monitor')\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"step-3",children:"Step 3"}),"\n",(0,o.jsx)(r.p,{children:"An example of a query with a group ID:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"INSERT INTO groupagents \r\n  SELECT '' as `AgentID`,\r\n  `groupid` as `GroupID`,\r\n  '0' as `SearchID`,\r\n  'ProVal - Production - CPU Threshold Violation Monitor' as `Name`,\r\n  '6' as `CheckAction`,\r\n  '1' as `AlertAction`,\r\n  'CPU Usage High on %Computername% at %locationname%~~~This is an automated update to inform you that the high CPU utilization issue reported earlier has now been resolved. The system has detected that the CPU usage has returned to normal and the performance has improved.\r\n  !!!CPU Usage High on %Computername% at %locationname%~~~The CPU usage on the machine %computername% located at %clientname%//%locationname% is currently reporting high CPU usage. Please investigate the issue and take appropriate actions to address the root cause. As per the severity of the issue, it is recommended to prioritize this ticket accordingly.\r\n  %RESULT%' as `AlertMessage`,\r\n  '0' as `ContactID`,\r\n  '600' as `interval`,\r\n  '127.0.0.1' as `Where`,\r\n  '7' as `What`,\r\n  'C://Windows//System32//WindowsPowerShell//v1.0//powershell.exe -ExecutionPolicy Bypass -Command \\\"$ErroractionPreference= /'SilentlyContinue/';$tl = 70;$th = 85;$m = //\\\"$env:TEMP//cpu_over_t//\\\";$t = $( if (Test-Path $m) { $tl } else { $th } );sal gpc /'Get-Counter/';$c = gpc /'//Processor Information(_Total)//% Processor Time/' -SampleInterval 1 -MaxSamples 10;$cu = $c.CounterSamples.CookedValue | Measure -Average | Select -exp Average;if ($t -le $cu) {Write-Output //\\\"Total CPU Usage: $([Math]::Round($cu,2))%`n`nTop 5 Processes utilizing CPU://\\\";$null > $m; $Obj = @((gpc /'//Process(*)//% Processor Time/').CounterSamples |Where { $_.InstanceName -notin (/'_total/',/'idle/') } | Group InstanceName | % {[PSCustomObject]@{ InstanceName = $_.Name; CookedValue = ($_.Group | Measure -Property CookedValue -Sum).Sum } } | Sort -Property CookedValue -Descending | Select @{l = /'Process/'; e = { $_.InstanceName } }, @{l = /'CPUUsage/'; e = { [math]::Round(($_.CookedValue) / [System.Environment]::ProcessorCount, 2) } } -First 5); $obj; if($obj.process -match /'powershell/') {Write-Output //\\\"`nPowerShell Process Command Line:`n//\\\"; (Get-Ciminstance -Class Win32_Process -Filter //\\\"Name = /'powershell.exe/'//\\\" | Where-Object {$_.ProcessID -ne $pid}).Commandline}} else { Remove-Item $m }\\\"' as `DataOut`,\r\n  '16' as `Comparor`,\r\n  '10|(^(//r//n%7COK)$)%7C(^$)|11|(Total CPU Usage: [0-9.]{1,6}%25)%7C(^(//r//n%7COK)$)%7C(^$)|10|Total CPU Usage: [0-9.]{1,6}%25' as `DataIn`,\r\n  '0' as `IDField`,\r\n  '1' as `AlertStyle`,\r\n  '0' as `ScriptID`,\r\n  '' as `datacollector`,\r\n  '21' as `Category`,\r\n  '0' as `TicketCategory`,\r\n  '1' as `ScriptTarget`,\r\n  CONCAT(\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    '-',\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1),\r\n    SUBSTRING('abcdef0123456789', FLOOR(RAND()*16+1), 1)\r\n  ) as `GUID`,\r\n  'root' as `UpdatedBy`,\r\n  (NOW()) as `UpdateDate`\r\nFROM mastergroups m\r\nWHERE m.groupid IN (2,856)\r\nAND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - CPU Threshold Violation Monitor')\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"step-4",children:"Step 4"}),"\n",(0,o.jsx)(r.p,{children:"Now execute your query from a RAWSQL monitor set."}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"step-5",children:"Step 5"}),"\n",(0,o.jsx)(r.p,{children:"Locate your remote monitor by opening the group(s) remote monitors tab, then apply the appropriate alert template."})]})}function R(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>s,x:()=>i});var n=t(296540);const o={},a=n.createContext(o);function s(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);