"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[30072],{865412:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"cwa/scripts/f699ae53-3ba7-42bd-864d-a670aca7ab0b","title":"Exchange - Reset Scan Engine Version","description":"This document provides a detailed guide on resolving the stuck email issue in Microsoft Exchange. It outlines the necessary steps to verify the impacted version, remove existing engines, update to the latest engine, and verify the engine update information to ensure smooth email transport.","source":"@site/docs/cwa/scripts/Exchange - Reset Scan Engine Version.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/f699ae53-3ba7-42bd-864d-a670aca7ab0b","permalink":"/docs/cwa/scripts/f699ae53-3ba7-42bd-864d-a670aca7ab0b","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/Exchange - Reset Scan Engine Version.md","tags":[{"inline":false,"label":"Email","permalink":"/docs/tags/email","description":"Documents about email systems and their management"},{"inline":false,"label":"Exchange","permalink":"/docs/tags/exchange","description":"Documents concerning Microsoft Exchange Server and email service"},{"inline":false,"label":"Security","permalink":"/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Update","permalink":"/docs/tags/update","description":"Documents discussing software and system updates and their management"}],"version":"current","frontMatter":{"id":"f699ae53-3ba7-42bd-864d-a670aca7ab0b","title":"Exchange - Reset Scan Engine Version","title_meta":"Exchange - Reset Scan Engine Version","keywords":["exchange","email","transport","queues","vulnerability","update","service"],"description":"This document provides a detailed guide on resolving the stuck email issue in Microsoft Exchange. It outlines the necessary steps to verify the impacted version, remove existing engines, update to the latest engine, and verify the engine update information to ensure smooth email transport.","tags":["email","exchange","security","update"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Enhanced Disk Space Monitoring Process","permalink":"/docs/cwa/scripts/8efd9cc2-b054-4dda-a690-bbe1d4bd16b3"},"next":{"title":"Exchange Zero Day Patch Logging","permalink":"/docs/cwa/scripts/2cc1d72d-5d5b-4017-8114-ad5f722b10f5"}}');var i=t(474848),a=t(28453);const r={id:"f699ae53-3ba7-42bd-864d-a670aca7ab0b",title:"Exchange - Reset Scan Engine Version",title_meta:"Exchange - Reset Scan Engine Version",keywords:["exchange","email","transport","queues","vulnerability","update","service"],description:"This document provides a detailed guide on resolving the stuck email issue in Microsoft Exchange. It outlines the necessary steps to verify the impacted version, remove existing engines, update to the latest engine, and verify the engine update information to ensure smooth email transport.",tags:["email","exchange","security","update"],draft:!1,unlisted:!1},c=void 0,o={},l=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Variables",id:"variables",level:2},{value:"Script States",id:"script-states",level:3},{value:"Process",id:"process",level:2},{value:"Output",id:"output",level:2}];function d(e){const n={a:"a",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.p,{children:["This document resolves the stuck email issue in Microsoft Exchange based on the following article: ",(0,i.jsx)(n.a,{href:"https://techcommunity.microsoft.com/t5/exchange-team-blog/email-stuck-in-exchange-on-premises-transport-queues/ba-p/3049447",children:"Email Stuck in Exchange On-Premises Transport Queues"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Sample Run",src:t(370360).A+"",width:"481",height:"351"})}),"\n",(0,i.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/cwa/dataviews/cwa-email-impact-summary",children:"Email Stuck in Exchange On-prem Detection"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://techcommunity.microsoft.com/t5/exchange-team-blog/email-stuck-in-exchange-on-premises-transport-queues/ba-p/3049447",children:"Email Stuck in Exchange On-Premises Transport Queues"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"variables",children:"Variables"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ExchangeEmailCheck"}),(0,i.jsx)(n.td,{children:"This contains data of the scan engine version and installs the latest safest version to avoid the vulnerability."})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"script-states",children:"Script States"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"Example"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ExchangeEmailCheck_OnPrem"}),(0,i.jsx)(n.td,{children:"The server impacted"}),(0,i.jsx)(n.td,{children:"This informs whether a vulnerability was found and if it has been fixed."})]})})]}),"\n",(0,i.jsx)(n.h2,{id:"process",children:"Process"}),"\n",(0,i.jsx)(n.p,{children:"This script will run PowerShell to perform the following steps:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verify the impacted version is installed"}),(0,i.jsx)(n.br,{}),"\n","Run ",(0,i.jsx)(n.code,{children:"Get-EngineUpdateInformation"})," and check the ",(0,i.jsx)(n.code,{children:"UpdateVersion"}),' information. If it starts with "22...", then proceed. If the installed version starts with "21...", you do not need to take action.']}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Remove existing engine and metadata"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Stop the Microsoft Filtering Management service. When prompted to also stop the Microsoft Exchange Transport service, click Yes."}),"\n",(0,i.jsxs)(n.li,{children:["Use Task Manager to ensure that ",(0,i.jsx)(n.code,{children:"updateservice.exe"})," is not running."]}),"\n",(0,i.jsxs)(n.li,{children:["Delete the following folder: ",(0,i.jsx)(n.code,{children:"%ProgramFiles%/Microsoft/Exchange Server/V15/FIP-FS/Data/Engines/amd64/Microsoft."})]}),"\n",(0,i.jsxs)(n.li,{children:["Remove all files from the following folder: ",(0,i.jsx)(n.code,{children:"%ProgramFiles%/Microsoft/Exchange Server/V15/FIP-FS/Data/Engines/metadata."})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Update to latest engine"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Start the Microsoft Filtering Management service and the Microsoft Exchange Transport service."}),"\n",(0,i.jsxs)(n.li,{children:["Open the Exchange Management Shell, navigate to the Scripts folder (",(0,i.jsx)(n.code,{children:"%ProgramFiles%/Microsoft/Exchange Server/V15/Scripts"}),"), and run *Update-MalwareFilteringServer.ps1 <server FQDN>."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Verify engine update info"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["In the Exchange Management Shell, run ",(0,i.jsxs)(n.em,{children:["Add-PSSnapin ",(0,i.jsx)(n.a,{href:"http://microsoft.Forefront.Filtering.Management",children:"Microsoft.Forefront.Filtering.Management"}),".Powershell"]}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.em,{children:"Get-EngineUpdateInformation"})," and verify the ",(0,i.jsx)(n.code,{children:"UpdateVersion"})," information is 2112330001 (or higher)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"output",children:"Output"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Script log"}),"\n",(0,i.jsx)(n.li,{children:"Dataview"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},370360:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/image_1-7922029993c139a5e6505b5e5fb7a4cb.png"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var s=t(296540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);