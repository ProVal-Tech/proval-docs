"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[5201],{351028:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"cwa/scripts/8ace140f-74d7-49cb-b9aa-90cf098629fc","title":"PowerShell Environment Setup Verification","description":"This document outlines a script that checks for necessary environmental conditions before executing other scripts. It verifies Admin Approval Mode, UAC settings, environmental path variables, and PowerShell version to ensure that the target machine meets the required criteria for successful script execution.","source":"@site/docs/cwa/scripts/PowerShell Environment Setup Verification.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/8ace140f-74d7-49cb-b9aa-90cf098629fc","permalink":"/proval-docs/docs/cwa/scripts/8ace140f-74d7-49cb-b9aa-90cf098629fc","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/PowerShell Environment Setup Verification.md","tags":[{"inline":false,"label":"Performance","permalink":"/proval-docs/docs/tags/performance","description":"Documents related to enhancing system and application performance"},{"inline":false,"label":"Security","permalink":"/proval-docs/docs/tags/security","description":"Documents discussing security measures and practices for IT systems"},{"inline":false,"label":"Setup","permalink":"/proval-docs/docs/tags/setup","description":"Documents on setting up software and hardware configurations"},{"inline":false,"label":"Windows","permalink":"/proval-docs/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"8ace140f-74d7-49cb-b9aa-90cf098629fc","title":"PowerShell Environment Setup Verification","title_meta":"PowerShell Environment Setup Verification","keywords":["environment","verification","uac","admin","powershell","path","version"],"description":"This document outlines a script that checks for necessary environmental conditions before executing other scripts. It verifies Admin Approval Mode, UAC settings, environmental path variables, and PowerShell version to ensure that the target machine meets the required criteria for successful script execution.","tags":["performance","security","setup","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"Power Plan - SetCreate","permalink":"/proval-docs/docs/cwa/scripts/8d2a9b84-38b6-460f-9e9e-3992ea6fd448"},"next":{"title":"PowerShell Response - All Errors - Check","permalink":"/proval-docs/docs/cwa/scripts/89346170-6657-4784-93cf-c0aa024b4386"}}');var n=i(474848),s=i(28453);const a={id:"8ace140f-74d7-49cb-b9aa-90cf098629fc",title:"PowerShell Environment Setup Verification",title_meta:"PowerShell Environment Setup Verification",keywords:["environment","verification","uac","admin","powershell","path","version"],description:"This document outlines a script that checks for necessary environmental conditions before executing other scripts. It verifies Admin Approval Mode, UAC settings, environmental path variables, and PowerShell version to ensure that the target machine meets the required criteria for successful script execution.",tags:["performance","security","setup","windows"],draft:!1,unlisted:!1},l=void 0,o={},d=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Variables",id:"variables",level:2},{value:"Global Parameters",id:"global-parameters",level:4},{value:"Output",id:"output",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,n.jsx)(t.p,{children:"This script will return a failed state if certain environmental conditions are not present. This script handles:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Admin Approval Mode being set to a level where an administrator account would need to supply credentials when running elevated commands."}),"\n",(0,n.jsx)(t.li,{children:"UAC being set to enabled."}),"\n",(0,n.jsx)(t.li,{children:"The addition of the supplied required path (defaulted to the PowerShell folder in Windows, as this is the most common required location) to the target machine."}),"\n",(0,n.jsx)(t.li,{children:"If the PowerShell version does not meet the required PowerShell version set in the global variable (defaulted to 5.1)."}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,n.jsx)(t.p,{children:"Although this script can be run to determine minimum requirements or environmental path variable settings, it is intended to be called by a parent script as a pre-check for script requirements."}),"\n",(0,n.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/proval-docs/docs/powershell/ps-set-pathvariable",children:"EPM - Windows Configuration - Agnostic - Set-PathVariable"})}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Log Var"}),(0,n.jsx)(t.td,{children:"A running log of what is being checked and its state."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Violation"}),(0,n.jsx)(t.td,{children:"The result of the question: does the target machine's current state satisfy the necessary requirement of the calling script?"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Violations"}),(0,n.jsx)(t.td,{children:"A running list of anything found with a violation of true."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"AdminApprovalModeViolations"}),(0,n.jsx)(t.td,{children:"Will be true if the local security policy object 'MACHINE/Software/Microsoft/Windows/CurrentVersion/Policies/System/ConsentPromptBehaviorAdmin' is set to either 1 or 3. These settings mean that an admin account, when running an elevated command, will be prompted for credentials to continue."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"LUA Enabled"}),(0,n.jsx)(t.td,{children:"Will be 1 or 0; 1 for enabled, 0 for disabled, reflecting the UAC setting on the computer. A failure here may not always prevent a script from running but could if the command requires elevation, and the Admin Approval Mode is set to a high enough level. Depending on the script, we may want to verify this, so it is added and will reflect a failure if UAC is turned on."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Scope"}),(0,n.jsxs)(t.td,{children:["This is a required variable for the ",(0,n.jsx)(t.a,{href:"/proval-docs/docs/cwa/scripts/838d8f61-038e-4569-aaf1-c72a1072670a",children:"EPM - Windows Configuration - Script - Set-Environmental Path Variable"})," script and is used to add any required path variables to the target. Note: this script will not fail if the required path variable is not present; it will add it if it's not present."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Path"}),(0,n.jsxs)(t.td,{children:["This is a required variable for the ",(0,n.jsx)(t.a,{href:"/proval-docs/docs/cwa/scripts/838d8f61-038e-4569-aaf1-c72a1072670a",children:"EPM - Windows Configuration - Script - Set-Environmental Path Variable"})," script and is used to add any required path variables to the target. It is equal to the global parameter RequiredPathVar, which can be set in this global parameter or in any parent script calling this script."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"SatisfiesPsVersion"}),(0,n.jsx)(t.td,{children:"Will be true if the target machine's PowerShell version is equal to or greater than the global parameter PsMinimumVersion, which can be set globally on this script or set in a parent script if a different value is desired."})]})]})]}),"\n",(0,n.jsx)(t.h4,{id:"global-parameters",children:"Global Parameters"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Example"}),(0,n.jsx)(t.th,{children:"Required"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"PsMinimumVersion"}),(0,n.jsx)(t.td,{children:"5.0"}),(0,n.jsx)(t.td,{children:"True"}),(0,n.jsx)(t.td,{children:"This is a global PowerShell minimum version that this script will default to. Currently, it is set to 5.0; however, as time goes on and we move to newer versions, we can change this to match the minimum PowerShell version we require moving forward. When calling this script, if you set a script variable as PsMinimumVersion with a value other than the default, the calling script's variable will take precedence over the global variable."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"RequiredPathVar"}),(0,n.jsx)(t.td,{children:"C:/Windows/System32/WindowsPowerShell/v1.0"}),(0,n.jsx)(t.td,{children:"True"}),(0,n.jsx)(t.td,{children:"This is a global environmental path variable; it is defaulted to 'C:/Windows/System32/WindowsPowerShell/v1.0' as the most common issue when calling powershell.exe is that this particular path is not present in the system's environmental path variable. When calling this script, if you set a script variable as RequiredPathVar with a value other than the default, the calling script's variable will take precedence over the global variable."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Skip AAM"}),(0,n.jsx)(t.td,{children:"1, 0"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"Setting this to 1 will skip the Admin Approval Mode check."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Skip UAC"}),(0,n.jsx)(t.td,{children:"1, 0"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"Setting this to 1 will skip the UAC check."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Skip EPV"}),(0,n.jsx)(t.td,{children:"1, 0"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"Setting this to 1 will skip the setting of the Environmental Path variable."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Skip PSVC"}),(0,n.jsx)(t.td,{children:"1, 0"}),(0,n.jsx)(t.td,{children:"False"}),(0,n.jsx)(t.td,{children:"Setting this to 1 will skip the PowerShell version check."})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,n.jsx)(t.p,{children:"In a parent script, we are looking for a variable to be created from this script. That variable is named 'FinishStatus'. If FinishStatus comes back as false, then this script has failed, and something required is not met."}),"\n",(0,n.jsx)(t.p,{children:"In the logs for the calling script, you should see the following log on failure:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"~~~~~~~~~~ Sub Script ~~~~~~~~~~~~~\r\n\r\nScript:  Environment Setup Verification\r\nRunTime : 1/27/2023 9:04:17 AM\r\nTarget: DESKTOP-CKSGDL7\r\n\r\n_______________________________________________\r\n\r\nChecking Admin approval mode : \r\nIf Admin approval mode is enabled, you may receive an error where required privileges are not held.\r\nAdmin Approval Mode violation is : False\r\n\r\n_____________________________________________\r\n\r\nChecking UAC settings : \r\nIf UAC is enabled, you may receive an error where required privileges are not held.\r\nUAC state is: 1\r\n\r\nUAC state is considered a violation as it is active.\r\n_______________________________________________\r\n\r\nEnvironmental Path check for Path : C:/Windows/System32/WindowsPowerShell/v1.0\r\nIf the path does not exist, it will be added to the machine scope environmental variable.\r\nThe machine-wide environmental path variable is as follows:\r\n\r\nC:/Windows/system32;C:/Windows;C:/Windows/System32/Wbem;C:/Windows/System32/WindowsPowerShell/v1.0/;C:/Windows/System32/OpenSSH/;C:/Program Files/dotnet/;\r\nC:/Windows/System32/WindowsPowerShell/v1.0\r\n\r\n_______________________________________________\r\n\r\nPowerShell Minimum Version is set to 5.1\r\nDESKTOP-CKSGDL7's PowerShell version satisfies the requirements of the developed script:  True\r\n\r\n_______________________________________________\r\n\r\nEnvironmental tests failed for the following issues - \r\n\r\nUAC Status\n"})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>l});var r=i(296540);const n={},s=r.createContext(n);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);