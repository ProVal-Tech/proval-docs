"use strict";(self.webpackChunkproval_docs=self.webpackChunkproval_docs||[]).push([[49656],{558461:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"cwa/scripts/d533538b-8b00-425e-849f-434518296b2d","title":"Bitlocker - AD Key Protector - Audit","description":"This document provides a detailed guide on auditing existing backup BitLocker key protectors from an Active Directory server. It includes sample runs, dependencies, process explanations, and a step-by-step guide to configuring Group Policy for automatic backup of BitLocker recovery keys to Active Directory.","source":"@site/docs/cwa/scripts/Bitlocker - AD Key Protector - Audit.md","sourceDirName":"cwa/scripts","slug":"/cwa/scripts/d533538b-8b00-425e-849f-434518296b2d","permalink":"/proval-docs/docs/cwa/scripts/d533538b-8b00-425e-849f-434518296b2d","draft":false,"unlisted":false,"editUrl":"https://github.com/proval-tech/proval-docs/tree/main/docs/cwa/scripts/Bitlocker - AD Key Protector - Audit.md","tags":[{"inline":false,"label":"Active Directory","permalink":"/proval-docs/docs/tags/active-directory","description":"Documents related to Active Directory services and management"},{"inline":false,"label":"Backup","permalink":"/proval-docs/docs/tags/backup","description":"Documents detailing backup solutions and data protection strategies"},{"inline":false,"label":"Encryption","permalink":"/proval-docs/docs/tags/encryption","description":"Documents discussing encryption technologies for data protection"},{"inline":false,"label":"GPO","permalink":"/proval-docs/docs/tags/gpo","description":"Documents covering Group Policy Objects management and deployment"},{"inline":false,"label":"Windows","permalink":"/proval-docs/docs/tags/windows","description":"Documents related to Microsoft Windows operating system and its functionalities"}],"version":"current","frontMatter":{"id":"d533538b-8b00-425e-849f-434518296b2d","title":"Bitlocker - AD Key Protector - Audit","title_meta":"Bitlocker - AD Key Protector - Audit","keywords":["audit","bitlocker","key","protectors","active","directory"],"description":"This document provides a detailed guide on auditing existing backup BitLocker key protectors from an Active Directory server. It includes sample runs, dependencies, process explanations, and a step-by-step guide to configuring Group Policy for automatic backup of BitLocker recovery keys to Active Directory.","tags":["active-directory","backup","encryption","gpo","windows"],"draft":false,"unlisted":false},"sidebar":"contentSidebar","previous":{"title":"BitLocker Status and Recovery Key Audit","permalink":"/proval-docs/docs/cwa/scripts/58ddde1a-dfdd-4eb8-9024-608e7c57ad4f"},"next":{"title":"Bitlocker - Audit","permalink":"/proval-docs/docs/cwa/scripts/d7d933e3-9668-4de9-9f44-7452198ab85a"}}');var s=i(474848),n=i(28453);const o={id:"d533538b-8b00-425e-849f-434518296b2d",title:"Bitlocker - AD Key Protector - Audit",title_meta:"Bitlocker - AD Key Protector - Audit",keywords:["audit","bitlocker","key","protectors","active","directory"],description:"This document provides a detailed guide on auditing existing backup BitLocker key protectors from an Active Directory server. It includes sample runs, dependencies, process explanations, and a step-by-step guide to configuring Group Policy for automatic backup of BitLocker recovery keys to Active Directory.",tags:["active-directory","backup","encryption","gpo","windows"],draft:!1,unlisted:!1},c=void 0,a={},d=[{value:"Summary",id:"summary",level:2},{value:"Sample Run",id:"sample-run",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Variables",id:"variables",level:2},{value:"Process",id:"process",level:2},{value:"Output",id:"output",level:2},{value:"GPO to Automatically Save BitLocker Recovery Key to AD",id:"gpo-to-automatically-save-bitlocker-recovery-key-to-ad",level:2}];function l(e){const t={a:"a",br:"br",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(t.p,{children:"This document audits the existing backup BitLocker key protectors from an Active Directory server."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Note:"})," The ",(0,s.jsx)(t.strong,{children:"Store BitLocker recovery information in Active Directory Domain Services"})," policy must be enabled on the domain controller to save the recovery keys."]}),"\n",(0,s.jsx)(t.h2,{id:"sample-run",children:"Sample Run"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Sample Run",src:i(792353).A+"",width:"478",height:"345"})}),"\n",(0,s.jsx)(t.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsx)(t.p,{children:"This must be run against an Active Directory server."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://proval.itglue.com/DOC-5078775-9038164",children:"SEC - Encryption - Agnostic - Get-ADBitlockerStores"})}),"\n",(0,s.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,s.jsx)(t.p,{children:"Document the various variables in the script. Delete any section that is not relevant to your script."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"maxstores"}),(0,s.jsx)(t.td,{children:"The number of key protector entries to process in one loop. This is used as a workaround for the Automate variable size limitation of 65,000 characters."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"InsertValues"}),(0,s.jsx)(t.td,{children:"The values to be inserted into the database. This variable will change with each iteration of the loop."})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"process",children:"Process"}),"\n",(0,s.jsxs)(t.p,{children:["The script implements a looping mechanism to compensate for the character limit of Automate's variables. As such, the ",(0,s.jsx)(t.code,{children:"@maxstores@"})," variable should never be set above 70 to prevent overflow of the variable ",(0,s.jsx)(t.code,{children:"@InsertValues@"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Example:"}),(0,s.jsx)(t.br,{}),"\n","The script runs and finds 250 key protectors backed up by Active Directory. The ",(0,s.jsx)(t.code,{children:"@maxstores@"})," variable is set to 70. The following occurs:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"Loop Iteration 1:\r\nThe first 70 records are processed. [0..69]\r\n\r\nLoop Iteration 2:\r\nThe second 70 records are processed. [70..139]\r\n\r\nLoop Iteration 3:\r\nThe third 70 records are processed. [140..209]\r\n\r\nLoop Iteration 4:\r\nThe final 40 records are processed. [210..249]\r\nNo additional records are found, so another loop iteration is not processed.\n"})}),"\n",(0,s.jsx)(t.p,{children:"This causes the underlying PowerShell to be run as many loop iterations as necessary to process all records. The overhead of running this is minimal, as the underlying script's average execution time is less than 5 seconds."}),"\n",(0,s.jsxs)(t.p,{children:["For additional information about the underlying logic, please see ",(0,s.jsx)(t.a,{href:"https://proval.itglue.com/DOC-5078775-9038164",children:"SEC - Encryption - Agnostic - Get-ADBitlockerStores"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"output",children:"Output"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"/proval-docs/docs/cwa/tables/23777e5f-2cdd-414c-9938-2293223df3ac",children:"SEC - Encryption - Custom Table - plugin_proval_ad_bitlocker_keyprotectors"})}),"\n",(0,s.jsx)(t.li,{children:"Dataview"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"gpo-to-automatically-save-bitlocker-recovery-key-to-ad",children:"GPO to Automatically Save BitLocker Recovery Key to AD"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Click the Search icon in the taskbar and type \u201c",(0,s.jsx)(t.strong,{children:"group policy"}),".\u201d You can then click ",(0,s.jsx)(t.strong,{children:"Group Policy Management"})," to launch it.",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 1",src:i(843370).A+"",width:"712",height:"873"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["In the left pane of Group Policy Management, right-click your AD domain and select \u201c",(0,s.jsx)(t.strong,{children:"Create a GPO in this domain, and Link it here\u2026"}),"\u201d from the menu.",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 2",src:i(482227).A+"",width:"1000",height:"851"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["In the New GPO dialog, give the GPO a name and click ",(0,s.jsx)(t.strong,{children:"OK"}),".",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 3",src:i(298620).A+"",width:"964",height:"447"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Right-click the newly created GPO in the left pane, and select ",(0,s.jsx)(t.strong,{children:"Edit"}),".",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 4",src:i(828037).A+"",width:"1000",height:"726"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Browse to ",(0,s.jsx)(t.code,{children:"Computer Configuration -> Policies -> Administrative Templates -> Windows Components -> BitLocker Drive Encryption"}),", and then double-click the policy \u201c",(0,s.jsx)(t.strong,{children:"Store BitLocker recovery information in Active Directory Domain Services"}),".\u201d",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 5",src:i(439886).A+"",width:"1000",height:"612"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Set the policy to ",(0,s.jsx)(t.strong,{children:"Enabled"}),". Make sure the \u201c",(0,s.jsx)(t.strong,{children:"Require BitLocker backup to AD DS"}),"\u201d option is checked, and select to store both recovery passwords and key packages.",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 6",src:i(582903).A+"",width:"1000",height:"914"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Next, expand ",(0,s.jsx)(t.strong,{children:"BitLocker Drive Encryption"})," in the left pane. You\u2019ll see three nodes: Fixed Data Drives, Operating System Drives, and Removable Data Drives. Select ",(0,s.jsx)(t.strong,{children:"Fixed Data Drives"})," and double-click the policy \u201c",(0,s.jsx)(t.strong,{children:"Choose how BitLocker-protected fixed drives can be recovered"}),".\u201d",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 7",src:i(632368).A+"",width:"1000",height:"620"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Set it to ",(0,s.jsx)(t.strong,{children:"Enabled"}),". Check the options \u201cSave BitLocker recovery information to AD DS for fixed drives\u201d and then click ",(0,s.jsx)(t.strong,{children:"OK"}),".",(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.img,{alt:"Step 8",src:i(229273).A+"",width:"1000",height:"984"})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Go to the \u201cOperating System Drives\u201d node and enable the similar policy \u201c",(0,s.jsx)(t.strong,{children:"Choose how BitLocker-protected operating system drives can be recovered"}),".\u201d Then, go to the \u201cRemovable Data Drives\u201d node and enable the policy \u201c",(0,s.jsx)(t.strong,{children:"Choose how BitLocker-protected removable drives can be recovered"}),".\u201d"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"When any client PC retrieves the policy changes, BitLocker recovery information will be automatically and silently backed up to AD DS when BitLocker is turned on for fixed drives, OS drives, or removable drives."}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},792353:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_1-e3cd86d7a9ec28756be5a362c31a3f59.png"},843370:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_2-688a6f510aeeb14ebdfa4bde074c07d7.png"},482227:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_3-7fb6c5c05381c8d333d090e15a61c808.png"},298620:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_4-8ad97cbbd8ac020d5e3c48a17d4c7a48.png"},828037:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_5-8e650c20ae2a6b0068f36c7c3a494110.png"},439886:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_6-8edf7eee59b9e9e67aa7d7892fb5c56e.png"},582903:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_7-0fc83fd2336390b21a03fb5c264d81b0.png"},632368:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_8-a842c15ccb7faad38469d8055dd8d742.png"},229273:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/image_9-32e4a4b83a5ee6e116cab723b3a00cb9.png"},28453:(e,t,i)=>{i.d(t,{R:()=>o,x:()=>c});var r=i(296540);const s={},n=r.createContext(s);function o(e){const t=r.useContext(n);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(n.Provider,{value:t},e.children)}}}]);