---
id: 'e3be5c3e-c492-4ea5-8dbe-1d1c7b546c52'
title: 'Automating WinRE Image Updates for CVE-2024-20666'
title_meta: 'Automating WinRE Image Updates for CVE-2024-20666'
keywords: ['winre', 'update', 'security', 'cve', 'windows', 'automation']
description: 'This document describes a script that automates the updating of WinRE images on supported Windows operating systems to address security vulnerabilities identified in CVE-2024-20666. It provides an overview of the process, dependencies, global parameters, and expected output.'
tags: ['backup', 'security', 'update', 'windows']
draft: false
unlisted: false
---

## Summary

This script automates the updating of WinRE images on supported Windows operating systems. It updates the WinRE partition on deployed devices to address security vulnerabilities in CVE-2024-20666.

Refer to the article:  
[Updating the WinRE Partition on Deployed Devices to Address Security Vulnerabilities in CVE-2024-20666](https://support.microsoft.com/en-us/topic/kb5034957-updating-the-winre-partition-on-deployed-devices-to-address-security-vulnerabilities-in-cve-2024-20666-0190331b-1ca3-42d8-8a55-7fc406910c10)

### Supported OS:

![Supported OS](../../../static/img/KB5034957---CVE-2024-20666---Updating-the-WinRE-partition/image_1.png)

## Sample Run

![Sample Run](../../../static/img/KB5034957---CVE-2024-20666---Updating-the-WinRE-partition/image_2.png)

## Dependencies

[SWM - Agnostic - KB5034957 - CVE-2024-20666 - Updating the WinRE partition](<./KB5034957 - CVE-2024-20666 - Updating the WinRE partition.md>)

### Global Parameters

| Name               | Default | Required | Description                                                                                                           |
|--------------------|---------|----------|-----------------------------------------------------------------------------------------------------------------------|
| EnableTicketing    | 1       | False    | 1/0 to toggle between ticket creation for failures while being used as an autofix.                                   |
| FailureEmail       | 0       | False    | 1/0 to Opt-In/Opt-Out Emails for failures while being used as an autofix.                                          |
| SuccessEmail       | 0       | False    | 1 to receive the success emails as well, and 0 to ignore. Only usable when FailureEmail is set to 1.                |
| EmailAddresses     |         | True     | (Only if FailureEmail = 1) Email Address(es) to send the failures. Multiple emails must be separated by a semicolon. e.g., [abc@def.com](mailto:abc@def.com); [ghi@jkl.com](mailto:ghi@jkl.com); [mno@pqr.com](mailto:mno@pqr.com) |

## EDF

| Name                               | Level      | Type  | Required | Description                                                                                          |
|------------------------------------|------------|-------|----------|------------------------------------------------------------------------------------------------------|
| Update WinRE Partition KB5034957   | Computer   | Text  | True     | It stores the updated result once the script runs successfully on the computer                     |

## Process

1. Import the script.
2. Execute the script.
3. With the device started up into the running version of Windows installed on the device, the script will perform the following steps:
   - Mount the existing WinRE image (WINRE.WIM).
   - Update the WinRE image with the specified Safe OS Dynamic Update (Compatibility Update) package available from the [Windows Update Catalog](https://www.catalog.update.microsoft.com/Search.aspx?q=Safe%20OS). We recommend that you use the latest Safe OS Dynamic Update available for the version of Windows installed on the device.
   - Unmount the WinRE image.
   - If the BitLocker TPM protector is present, reconfigure WinRE for BitLocker service.

## Output

- Script Log
- Dataview
