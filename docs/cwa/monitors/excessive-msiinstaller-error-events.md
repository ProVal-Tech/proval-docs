---
id: '2c4a1019-af57-4215-9b92-bcf132bdd1ce'
slug: /2c4a1019-af57-4215-9b92-bcf132bdd1ce
title: 'Excessive MsiInstaller Error Events'
title_meta: 'Excessive MsiInstaller Error Events'
keywords: ['msi', 'msiexec', 'msiinstaller', 'excessive', 'event-logs', '11704']
description: 'Reports recent error events from the "MsiInstaller" event source and lists any active Msiexec processes.'
tags: ['windows', 'eventlogs', 'application']
draft: false
unlisted: false
---

## Summary

Reports recent error events from the 'MsiInstaller' event source and lists any active Msiexec processes.

This remote monitor analyzes the Windows Application event log for error and critical events (levels 1 and 2) generated by the 'MsiInstaller' source within a specified time window (example: last 15 minutes). It summarizes these events, grouping them by event properties, and displays the most recent occurrence and message for each group. If the total number of detected events meets or exceeds a defined threshold (example: 20), the script also enumerates all currently running Msiexec processes and outputs their details.

The script is useful for troubleshooting MSI installation issues, identifying patterns of installer failures, and correlating them with active installer processes.

**Note:** Both the time window and threshold must be defined when creating the monitor set. These values can be configured using the `@intervalMinutes` and `@threshold` variables in the Insert SQL query.

## Details

**Suggested "Limit to"**: `All`  
**Suggested Alert Style**: `Continuous`  
**Suggested Alert Template**: `â–³ Custom - Ticket Creation - Computer`  

| Check Action | Server Address | Check Type | Comparator  | Interval | Result |
| ------------ | -------------- | ---------- | ----------- | -------- | ------ |
| System       |  127.0.0.1     |  Run File  | State Based | 900      | <ul><li>**Normal State (Regex Match):** `((^((OK){0,}(\r\n){0,}[\r\n]{0,}\s{0,})$)\|(^$))`</li><li>**Warning State: (Does Not Regex Match)** `((^((OK){0,}(\r\n){0,}[\r\n]{0,}\s{0,})$)\|(^$))\|(^((\r\n){0,}[\r\n]{0,}\s{0,})Detected)`</li><li>**Error State (Regex Match):** `^((\r\n){0,}[\r\n]{0,}\s{0,})Detected`</li></ul> |

## Target

- Managed Windows Machines

## Ticketing

**Subject:** `Multiple MSI Installer Errors Detected for <ComputerName>`  
**Ticket Body:** `<PowerShellResult>`  
**Sample Result:**

```Shell
Detected 40 error event(s) from the 'MsiInstaller' event source within the past 15 minutes. Event log details:


Count             : 40
Eventid           : 11714
Level             : Error
Source            : MsiInstaller
LogName           : Application
MostRecentDate    : 9/22/2025 7:01:09 AM
MostRecentMessage : Product: Huntress Rio -- Error 1714. The older version of Huntress Rio cannot be removed.  Contact your
                    technical support group.  System Error 1612.




Active Msiexec process(es) currently running on this system:


Name           : msiexec.exe
ProcessId      : 1508
CommandlIne    : C:\WINDOWS\system32\msiexec.exe /V
ExecutablePath : C:\WINDOWS\system32\msiexec.exe
CreationDate   : 9/22/2025 7:20:26 AM
```

## Implementation

### Step 1

Obtain the group ID(s) of the group(s) that the remote monitor should be applied to.

### Step 2

Copy the following query and replace **YOUR COMMA SEPARATED LIST OF GROUPID(S)** with the group ID(s) for your target groups. Set the desired values for the `@intervalMinutes` and `@threshold` variables as needed.  
(The section to replace is at the very end of the query, immediately after **WHERE**.)

```sql
SET @intervalMinutes = '<Time interval in minutes to look back in the event log>';
SET @threshold = '<Threshold for the minimum number of error events to trigger alerting>';

SET @intervalSeconds = @intervalMinutes * 60;
INSERT INTO groupagents 
 SELECT '' as `AgentID`,
`groupid` as `GroupID`,
'0' as `SearchID`,
'ProVal - Production - Excessive MsiInstaller Error Events' as `Name`,
'6' as `CheckAction`,
'172' as `AlertAction`,
'Multiple MSI Installer Errors Detected for %COMPUTERNAME%~~~No error events from the MsiInstaller source have been detected since the last check.!!!Multiple MSI Installer Errors Detected for %COMPUTERNAME%~~~%RESULT%\r\n\r\nPlease review the event log errors and investigate any ongoing or failed MSI installations. If any Msiexec processes are stuck or unexpected, further troubleshooting may be required.' as `AlertMessage`,
'0' as `ContactID`,
@intervalSeconds as `interval`,
'127.0.0.1' as `Where`,
'7' as `What`,
CONCAT('C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Bypass -Command "$ErrorActionPreference = \'SilentlyContinue\'; $ProgressPreference = \'SilentlyContinue\'; $InformationPreference = \'Continue\'; $im = ',@intervalMinutes,'; $th = ',@intervalMinutes,'; $tr = (Get-Date).AddMinutes(-$im); $ln = \'Application\'; $pn = \'MsiInstaller\'; $del = Get-WinEvent -FilterHashtable @{ LogName = $ln; Level = 1,2; StartTime = $tr; ProviderName = $pn } -ErrorAction SilentlyContinue; if ($del) { $del = $del | Group-Object -Property Level, ProviderName, Id, LogName | Sort-Object -Property Count -Descending | Select-Object -Property Count,Name,Group; foreach($group in $del) { $mrge = $group.Group | Sort-Object -Property TimeCreated -Descending | Select-Object -First 1; $group | Add-Member -MemberType NoteProperty -Name MostRecentDate -Value $mrge.TimeCreated; $group | Add-Member -MemberType NoteProperty -Name MostRecentMessage -Value $mrge.Message; $group | Add-Member -MemberType NoteProperty -Name Eventid -Value $mrge.Id; $group | Add-Member -MemberType NoteProperty -Name Level -Value $mrge.LevelDisplayName; $group | Add-Member -MemberType NoteProperty -Name Source -Value $mrge.ProviderName; $group | Add-Member -MemberType NoteProperty -Name LogName -Value $mrge.LogName } }; $del = $del | Select-Object -Property Count, EventId, Level, Source, LogName, MostRecentDate, MostRecentMessage; $dec = ($del | Select-Object -Property Count | Measure-Object -Property Count -Sum).Sum; if ($dec -ge $th) { $mpi = Get-CimInstance -ClassName Win32_Process | Where-Object { $_.Name -match \'Msiexec\' } | Select-Object -Property Name, ProcessId, CommandlIne, ExecutablePath, CreationDate; Write-Information ("Detected {0} error event(s) from the \'MsiInstaller\' event source within the past {1} minutes. Event log details:" -f $dec, $im); Write-Information (\'{0}\' -f ($del | Format-List | Out-String)); if ($mpi) { Write-Information (\'Active Msiexec process(es) currently running on this system:\'); Write-Information (\'{0}\' -f ($mpi | Format-List | Out-String)) } }"') as `DataOut`,
'16' as `Comparor`,
'10|((^((OK){0,}(\\r\\n){0,}[\\r\\n]{0,}\\s{0,})$)%7C(^$))|11|((^((OK){0,}(\\r\\n){0,}[\\r\\n]{0,}\\s{0,})$)%7C(^$))%7C(^((\\r\\n){0,}[\\r\\n]{0,}\\s{0,})Detected)|10|^((\\r\\n){0,}[\\r\\n]{0,}\\s{0,})Detected' as `DataIn`,
'' as `IDField`,
'0' as `AlertStyle`,
'0' as `ScriptID`,
'' as `datacollector`,
'21' as `Category`,
'0' as `TicketCategory`,
'1' as `ScriptTarget`,
(UUID()) as `GUID`,
'root' as `UpdatedBy`,
(NOW()) as `UpdateDate`
FROM mastergroups m
WHERE m.groupid IN (YOUR COMMA SEPARATED LIST OF GROUPID(S))
AND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Excessive MsiInstaller Error Events')
```

### Step 3

Here is an example showing how to use a specific group ID and set the variables:

```sql
SET @intervalMinutes = '15';
SET @threshold = '20';

SET @intervalSeconds = @intervalMinutes * 60;
INSERT INTO groupagents 
 SELECT '' as `AgentID`,
`groupid` as `GroupID`,
'0' as `SearchID`,
'ProVal - Production - Excessive MsiInstaller Error Events' as `Name`,
'6' as `CheckAction`,
'172' as `AlertAction`,
'Multiple MSI Installer Errors Detected for %COMPUTERNAME%~~~No error events from the MsiInstaller source have been detected since the last check.!!!Multiple MSI Installer Errors Detected for %COMPUTERNAME%~~~%RESULT%\r\n\r\nPlease review the event log errors and investigate any ongoing or failed MSI installations. If any Msiexec processes are stuck or unexpected, further troubleshooting may be required.' as `AlertMessage`,
'0' as `ContactID`,
@intervalSeconds as `interval`,
'127.0.0.1' as `Where`,
'7' as `What`,
CONCAT('C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Bypass -Command "$ErrorActionPreference = \'SilentlyContinue\'; $ProgressPreference = \'SilentlyContinue\'; $InformationPreference = \'Continue\'; $im = ',@intervalMinutes,'; $th = ',@intervalMinutes,'; $tr = (Get-Date).AddMinutes(-$im); $ln = \'Application\'; $pn = \'MsiInstaller\'; $del = Get-WinEvent -FilterHashtable @{ LogName = $ln; Level = 1,2; StartTime = $tr; ProviderName = $pn } -ErrorAction SilentlyContinue; if ($del) { $del = $del | Group-Object -Property Level, ProviderName, Id, LogName | Sort-Object -Property Count -Descending | Select-Object -Property Count,Name,Group; foreach($group in $del) { $mrge = $group.Group | Sort-Object -Property TimeCreated -Descending | Select-Object -First 1; $group | Add-Member -MemberType NoteProperty -Name MostRecentDate -Value $mrge.TimeCreated; $group | Add-Member -MemberType NoteProperty -Name MostRecentMessage -Value $mrge.Message; $group | Add-Member -MemberType NoteProperty -Name Eventid -Value $mrge.Id; $group | Add-Member -MemberType NoteProperty -Name Level -Value $mrge.LevelDisplayName; $group | Add-Member -MemberType NoteProperty -Name Source -Value $mrge.ProviderName; $group | Add-Member -MemberType NoteProperty -Name LogName -Value $mrge.LogName } }; $del = $del | Select-Object -Property Count, EventId, Level, Source, LogName, MostRecentDate, MostRecentMessage; $dec = ($del | Select-Object -Property Count | Measure-Object -Property Count -Sum).Sum; if ($dec -ge $th) { $mpi = Get-CimInstance -ClassName Win32_Process | Where-Object { $_.Name -match \'Msiexec\' } | Select-Object -Property Name, ProcessId, CommandlIne, ExecutablePath, CreationDate; Write-Information ("Detected {0} error event(s) from the \'MsiInstaller\' event source within the past {1} minutes. Event log details:" -f $dec, $im); Write-Information (\'{0}\' -f ($del | Format-List | Out-String)); if ($mpi) { Write-Information (\'Active Msiexec process(es) currently running on this system:\'); Write-Information (\'{0}\' -f ($mpi | Format-List | Out-String)) } }"') as `DataOut`,
'16' as `Comparor`,
'10|((^((OK){0,}(\\r\\n){0,}[\\r\\n]{0,}\\s{0,})$)%7C(^$))|11|((^((OK){0,}(\\r\\n){0,}[\\r\\n]{0,}\\s{0,})$)%7C(^$))%7C(^((\\r\\n){0,}[\\r\\n]{0,}\\s{0,})Detected)|10|^((\\r\\n){0,}[\\r\\n]{0,}\\s{0,})Detected' as `DataIn`,
'' as `IDField`,
'0' as `AlertStyle`,
'0' as `ScriptID`,
'' as `datacollector`,
'21' as `Category`,
'0' as `TicketCategory`,
'1' as `ScriptTarget`,
(UUID()) as `GUID`,
'root' as `UpdatedBy`,
(NOW()) as `UpdateDate`
FROM mastergroups m
WHERE m.groupid IN (2,3,855,856)
AND m.groupid NOT IN  (SELECT DISTINCT groupid FROM groupagents WHERE `Name` = 'ProVal - Production - Excessive MsiInstaller Error Events')
```

### Step 4

Now execute your query from a `RAWSQL` monitor set.

### Step 5

Locate your remote monitor by opening the group(s) remote monitors tab, then apply the appropriate alert template.  
While assigning the alert template, ensure that it is not performing any actions for WARNINGS unless you want to be notified for the PowerShell errors as well.
