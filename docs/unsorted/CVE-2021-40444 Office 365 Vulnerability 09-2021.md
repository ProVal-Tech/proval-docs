---
id: '65b16233-a267-41b7-8183-d714dab3bc4e'
title: 'Mitigation Script for Office 365 Zero-Day Attacks'
title_meta: 'Mitigation Script for Office 365 Zero-Day Attacks'
keywords: ['mitigation', 'office365', 'cve2021', 'registry', 'script']
description: 'This document outlines a script designed to mitigate vulnerabilities related to Office 365 zero-day attacks by importing a specific registry file. The process includes user interaction for reboots and logging of script actions for reporting purposes.'
tags: ['cve', 'registry', 'security', 'windows']
draft: true
unlisted: false
---
## Summary

This script will perform mitigation on the agent to import the provided registry in the below article.

[https://www.bleepingcomputer.com/news/security/microsoft-shares-temp-fix-for-ongoing-office-365-zero-day-attacks/amp/?__twitter_impression=true](https://www.bleepingcomputer.com/news/security/microsoft-shares-temp-fix-for-ongoing-office-365-zero-day-attacks/amp/?__twitter_impression=true)

Time Saved by Automation: 10 Minutes

## Sample Run

![Sample Run](../../static/img/CVE-2021-40444-Office-365-Vulnerability-09-2021/image_1.png)

## Dependencies

- [CVE-2021-40444 Office 365 Detection](<./CVE-2021-40444 Office 365 Detection.md>)
- [CVE-2021-40444 Office 365 Vulnerability Report](<./CVE-2021-40444 Office 365 Vulnerability Report.md>)

## Variables

| Variable         | Description                                            |
|------------------|--------------------------------------------------------|
| scriptcount      | It tracks record of how many attempts script made to reboot the agent |
| MitigationStatus  | It tracks record of Mitigation Applied or not          |
| ScriptRanDate    | It tracks the last script execution date               |
| ApprovedStatus    | It stores the reboot approved status                   |

#### Global Parameters

| Name   | Example | Required | Description                                                                                                                                         |
|--------|---------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| Reboot | 0       | True     | This decides whether the script will perform a forced reboot, no reboot or a user interactive reboot (0 = user interactive reboot | 1= Forced reboot | 2 = No Reboot) |

#### Script States

| Name                        | Example                                      | Description                                          |
|-----------------------------|----------------------------------------------|------------------------------------------------------|
| CVE-2021-40444_Office365   | 0 -- 12/09/2021 -- No User -- Mitigation Applied | This keeps record of script result                    |
| CVE-2021-40444             | @scriptcount@                               | The number of times the script has notified the end user to reboot the machine. |

## Process

- This script will download the .reg registry from the following link: [https://download.bleepingcomputer.com/reg/disable-activex.reg](https://download.bleepingcomputer.com/reg/disable-activex.reg)
- After downloading the registry file, it will import the registry to the endpoint.
- The reboot is based on the global param value; if 1, then the machine will be force rebooted. If the global parameter is 0, the script will proceed with the user interactive reboot. If reboot = 2, then no reboot will happen via script.
- During the No Reboot case, Mitigation will be assumed as applied, as it will be implemented as soon as the system is rebooted.
- If no user is detected online, then the force reboot will automatically trigger. If a user is found, it will ask for the reboot 5 times within a 10-hour window.
- After five continuous deny responses from the user, the machine will be rebooted forcefully.
- The user will get 5 minutes before the force reboot to save their work.
- There is one more option to not reboot and let the reboot handle by the user or during the patch cycle. For this, set Reboot = 2 and done.
- Everything will be written to a script state and will be displayed in the dependent dataview for reporting.

## Output

- Script log
- Script state
- Dataview














